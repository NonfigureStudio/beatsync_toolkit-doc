<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>BeatSyncToolkit - Documentation</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&amp;family=Outfit:wght@300;400;500;600&amp;family=JetBrains+Mono:wght@400;500&amp;display=swap" rel="stylesheet"/>
<style>
:root {
  --bg-primary: #080c18;
  --bg-secondary: #0e1220;
  --bg-tertiary: #141a2e;
  --bg-code: #0d1120;
  --border: #1e2a45;
  --border-hover: #2d3f5f;
  --text-primary: #c5cad6;
  --text-secondary: #a8b0c4;
  --text-tertiary: #6b7385;
  --accent: #6366f1;
  --accent-glow: rgba(99,102,241,0.15);
  --accent-hover: #7c7ff5;
  --accent-muted: rgba(99,102,241,0.08);
  --green: #34d399;
  --amber: #fbbf24;
  --red: #f87171;
  --blue: #60a5fa;
  --font-heading: 'Syne', sans-serif;
  --font-body: 'Outfit', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --sidebar-width: 272px;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:auto; }

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height:100vh;
  display:flex;
  font-size:18px;
  line-height:1.95;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-bar {
  position:fixed; top:0; left:0; height:2px;
  background: linear-gradient(90deg, var(--accent), #a78bfa, var(--accent));
  width:0%; z-index:200;
  transition: width 0.15s linear;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width:var(--sidebar-width);
  min-height:100vh;
  background:var(--bg-secondary);
  border-right:1px solid var(--border);
  position:fixed; top:0; left:0;
  height:100vh; overflow-y:auto; z-index:100;
  display:flex; flex-direction:column;
}

.sidebar-header {
  padding:28px 22px 18px;
  border-bottom:1px solid var(--border);
  position:sticky; top:0;
  background:var(--bg-secondary); z-index:1;
}

.sidebar-logo {
  display:flex; align-items:center; gap:12px;
  text-decoration:none;
}

.logo-icon {
  width:38px; height:38px;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  border-radius:9px;
  display:flex; align-items:center; justify-content:center;
  box-shadow: 0 2px 12px rgba(99,102,241,0.3);
}

.logo-icon svg { width:20px; height:20px; stroke:#fff; fill:none; stroke-width:1.8; }

.logo-text {
  font-family:var(--font-heading);
  font-weight:700; font-size:17px;
  color:var(--text-primary); letter-spacing:-0.5px;
}

.logo-sub {
  font-size:10.5px; color:var(--text-tertiary);
  font-weight:400; font-family:var(--font-body); margin-top:1px;
}

.sidebar-version {
  margin-top:14px; display:inline-flex;
  align-items:center; gap:6px;
  background:var(--accent-muted);
  border:1px solid rgba(99,102,241,0.2);
  border-radius:20px; padding:3px 10px;
  font-size:10.5px; color:var(--accent);
  font-family:var(--font-mono); font-weight:500;
}

.ver-dot {
  width:6px; height:6px; background:var(--green);
  border-radius:50%; animation:pulse 2.2s infinite;
}

@keyframes pulse {
  0%,100%{opacity:1} 50%{opacity:0.35}
}

/* Nav */
.sidebar-nav { flex:1; padding:14px 10px; }

.nav-section-label {
  font-size:9.5px; text-transform:uppercase;
  letter-spacing:1.4px; color:var(--text-tertiary);
  padding:18px 12px 5px; font-weight:600;
  font-family:var(--font-mono);
}

.nav-item {
  display:flex; align-items:center;
  padding:6px 12px; border-radius:6px;
  text-decoration:none; color:var(--text-secondary);
  font-size:13px; font-weight:400;
  transition:all 0.18s; position:relative;
  white-space:nowrap; overflow:hidden;
  text-overflow:ellipsis; gap:8px;
}

.nav-item:hover { background:var(--bg-tertiary); color:var(--text-primary); }

.nav-item.active {
  background:var(--accent-muted);
  color:var(--accent); font-weight:500;
}

.nav-item.active::before {
  content:''; position:absolute; left:0; top:50%;
  transform:translateY(-50%);
  width:2.5px; height:16px;
  background:var(--accent); border-radius:0 2px 2px 0;
}

.nav-num {
  color:var(--text-tertiary); font-size:10.5px;
  font-family:var(--font-mono); min-width:20px;
  text-align:right; flex-shrink:0;
}

.nav-sub { padding-left:10px; }
.nav-sub .nav-item { font-size:12.5px; padding:4.5px 12px; color:var(--text-tertiary); }
.nav-sub .nav-item:hover { color:var(--text-secondary); }
.nav-sub .nav-item.active { color:var(--accent); background:var(--accent-muted); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN CONTAINER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.content-wrapper {
  margin-left:var(--sidebar-width);
  display:flex;
  max-width:1600px;
  width:100%;
  gap:120px;
  padding-right:0;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  flex:1;
  max-width:850px;
  padding:64px 64px 140px;
  position:relative; z-index:1;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RIGHT SIDEBAR (TOC) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.right-sidebar {
  width:280px;
  flex-shrink:0;
  padding-top:80px;
  margin-right:60px;
}

.toc {
  position:sticky;
  top:80px;
  max-height:calc(100vh - 420px);
  overflow-y:auto;
  margin-bottom:24px;
}

.toc-title {
  font-size:11px;
  font-weight:600;
  text-transform:uppercase;
  letter-spacing:0.08em;
  color:var(--text-tertiary);
  margin-bottom:16px;
  font-family:var(--font-mono);
}

.toc-list {
  list-style:none;
  padding:0;
  margin:0;
}

.toc-item {
  margin-bottom:8px;
}

.toc-link {
  display:block;
  font-size:13px;
  line-height:1.5;
  color:var(--text-secondary);
  text-decoration:none;
  padding:6px 0;
  padding-left:12px;
  border-left:2px solid transparent;
  transition:all 0.2s;
}

.toc-link:hover {
  color:var(--text-primary);
  border-left-color:var(--border-hover);
}

.toc-link.active {
  color:var(--accent);
  border-left-color:var(--accent);
  font-weight:500;
}

.toc-empty {
  font-size:12px;
  color:var(--text-tertiary);
  font-style:italic;
  padding-left:12px;
}

/* Hide TOC on smaller screens */
@media (max-width: 1400px) {
  .right-sidebar {
    display:none;
  }
  .content-wrapper {
    padding-right:0;
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RIGHT SIDEBAR WIDGETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar-widget {
  background: var(--bg-secondary);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
}

.widget-title {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-primary);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.widget-icon {
  font-size: 18px;
}

/* Quick Actions Widget */
.quick-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.quick-action-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  background: var(--bg-tertiary);
  border: 1px solid var(--border);
  border-radius: 8px;
  text-decoration: none;
  color: var(--text-secondary);
  font-size: 13px;
  transition: all 0.2s;
  cursor: pointer;
}

.quick-action-btn:hover {
  background: var(--bg-hover);
  border-color: var(--accent);
  color: var(--text-primary);
  transform: translateX(2px);
}

.quick-action-btn .icon {
  font-size: 16px;
  flex-shrink: 0;
}

/* Stats Card */
.stats-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.stat-item {
  text-align: center;
  padding: 12px;
  background: var(--bg-tertiary);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.stat-value {
  display: block;
  font-size: 24px;
  font-weight: 700;
  color: var(--accent);
  font-family: var(--font-heading);
  margin-bottom: 4px;
}

.stat-label {
  display: block;
  font-size: 11px;
  color: var(--text-tertiary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

/* Help Card */
.help-card {
  background: linear-gradient(135deg, rgba(99,102,241,0.08) 0%, rgba(139,92,246,0.08) 100%);
  border-color: rgba(99,102,241,0.2);
}

.help-text {
  font-size: 13px;
  line-height: 1.6;
  color: var(--text-secondary);
  margin-bottom: 12px;
}

.help-email {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  color: var(--accent);
  text-decoration: none;
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s;
}

.help-email:hover {
  color: var(--accent-hover);
  transform: translateX(2px);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero { margin-bottom:68px; position:relative; }

.hero-glow {
  position:absolute; top:-80px; left:-120px;
  width:520px; height:340px;
  background:radial-gradient(ellipse, rgba(99,102,241,0.07) 0%, transparent 68%);
  pointer-events:none;
}

.hero-badge {
  display:inline-flex; align-items:center; gap:6px;
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:20px; padding:4px 12px;
  font-size:11px; color:var(--text-secondary);
  margin-bottom:22px; font-family:var(--font-mono);
}

.hero-badge .dot {
  width:6px; height:6px; background:var(--green);
  border-radius:50%; animation:pulse 2.2s infinite;
}

.hero h1 {
  font-family:var(--font-heading); font-size:56px;
  font-weight:800; letter-spacing:-2.2px;
  line-height:1.08; color:#fff; margin-bottom:14px;
}

.hero h1 .grad {
  background:linear-gradient(135deg, #818cf8 0%, #a78bfa 50%, #6366f1 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text;
}

.hero-subtitle {
  font-size:18px; color:var(--text-secondary);
  font-weight:300; max-width:560px; line-height:1.65;
}

.hero-meta {
  margin-top:24px; display:flex; gap:24px; flex-wrap:wrap;
}

.hero-meta-item {
  display:flex; align-items:center; gap:5px;
  font-size:11.5px; color:var(--text-tertiary);
  font-family:var(--font-mono);
}

.hero-meta-item .val { color:var(--text-secondary); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { margin-bottom:52px; }

.section-divider {
  height:1px;
  background:linear-gradient(90deg, transparent 0%, var(--border) 30%, var(--border) 50%, transparent 100%);
  background-size:200% 100%;
  margin:56px 0;
  animation:shimmer 4s ease-in-out infinite;
}

h2 {
  font-family:var(--font-heading); font-size:30px;
  font-weight:700; color:#e8ecf2; letter-spacing:-0.8px;
  margin-bottom:14px; margin-top:8px;
  display:flex; align-items:center; gap:10px;
  position:relative;
}

h2 .anchor {
  color:var(--text-tertiary); font-size:17px;
  text-decoration:none; opacity:0; transition:opacity 0.2s;
  font-family:var(--font-mono);
}
h2:hover .anchor { opacity:0.6; }

h3 {
  font-family:var(--font-heading); font-size:22px;
  font-weight:600; color:#d8dde8;
  letter-spacing:-0.4px; margin:32px 0 12px;
}

h4 {
  font-family:var(--font-heading); font-size:17.5px;
  font-weight:600; color:#d8dde8;
  margin:22px 0 10px;
}

p { color:var(--text-secondary); margin-bottom:22px; font-weight:300; letter-spacing:0.01em; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CONTENT LINKS (Always Visible) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
p a,
li a,
.callout a,
.section a:not(.anchor) {
  color: var(--accent);
  text-decoration: none;
  border-bottom: 1px solid rgba(99,102,241,0.3);
  transition: all 0.2s;
  font-weight: 400;
}

p a:hover,
li a:hover,
.callout a:hover,
.section a:not(.anchor):hover {
  color: var(--accent-hover);
  border-bottom-color: var(--accent);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ci {
  font-family:var(--font-mono); font-size:13px;
  background:var(--bg-code); border:1px solid var(--border);
  color:var(--accent-hover); padding:2px 6px;
  border-radius:4px; white-space:nowrap;
}

.code-block {
  background:var(--bg-code); border:1px solid var(--border);
  border-radius:10px; margin:14px 0 18px; overflow:hidden;
  transition:border-color 0.25s, box-shadow 0.25s;
}
.code-block:hover {
  border-color:rgba(99,102,241,0.35);
  box-shadow:0 0 18px rgba(99,102,241,0.08);
}

.cb-head {
  display:flex; align-items:center; padding:9px 14px;
  background:var(--bg-tertiary);
  border-bottom:1px solid var(--border); gap:5px;
}

.cd { width:11px; height:11px; border-radius:50%; }
.cd.r{background:#f87171} .cd.y{background:#fbbf24} .cd.g{background:#34d399}

.cb-label {
  font-family:var(--font-mono); font-size:10.5px;
  color:var(--text-tertiary); margin-left:auto;
}

.code-block pre {
  padding:20px 24px; font-family:var(--font-mono);
  font-size:14px; line-height:2; color:var(--text-secondary);
  overflow-x:auto; white-space:pre;
}

.kw{color:#c084fc} .fn{color:#60a5fa} .str{color:#34d399}
.cmt{color:#3d4a66;font-style:italic} .val{color:#fb923c} .cls{color:#f472b6}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CALLOUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.callout {
  border-radius:9px; padding:18px 20px; margin:20px 0;
  border-left:3px solid; position:relative;
  transition:border-color 0.22s, background 0.22s;
}

.callout-title {
  font-weight:600; font-size:13.5px; margin-bottom:5px;
  font-family:var(--font-body);
}

.callout p { font-size:15px; margin-bottom:0; }

.callout.tip { border-color:var(--green); background:rgba(52,211,153,0.06); }
.callout.tip .callout-title { color:var(--green); }

.callout.warning { border-color:var(--amber); background:rgba(251,191,36,0.06); }
.callout.warning .callout-title { color:var(--amber); }

.callout.info { border-color:var(--blue); background:rgba(96,165,250,0.06); }
.callout.info .callout-title { color:var(--blue); }

.callout.note { border-color:var(--accent); background:var(--accent-muted); }
.callout.note .callout-title { color:var(--accent); }

.callout.tip:hover { background:rgba(52,211,153,0.1); border-color:rgba(52,211,153,0.45); }
.callout.warning:hover { background:rgba(251,191,36,0.1); border-color:rgba(251,191,36,0.45); }
.callout.info:hover { background:rgba(96,165,250,0.1); border-color:rgba(96,165,250,0.45); }
.callout.note:hover { background:rgba(99,102,241,0.14); border-color:rgba(99,102,241,0.4); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tw {
  overflow-x:auto; margin:18px 0;
  border-radius:9px; border:1px solid var(--border);
  position:relative;
}

table { width:100%; border-collapse:collapse; font-size:14.5px; }

thead { background:var(--bg-tertiary); }

thead th {
  text-align:left; padding:11px 17px;
  color:var(--text-tertiary); font-weight:600;
  font-size:10.5px; text-transform:uppercase;
  letter-spacing:0.7px; border-bottom:1px solid var(--border);
  white-space:nowrap; font-family:var(--font-mono);
}

tbody tr {
  border-bottom:1px solid var(--border);
  transition:background 0.2s;
}
tbody tr:last-child { border-bottom:none; }
tbody tr:hover { background:rgba(99,102,241,0.07); }

tbody td {
  padding:11px 17px; color:var(--text-secondary);
  vertical-align:top; font-weight:300;
}
tbody td:first-child { color:var(--text-primary); font-weight:500; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps { margin:18px 0; }

.step { display:flex; gap:16px; margin-bottom:18px; align-items:flex-start; }

.step-num {
  min-width:28px; height:28px;
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:6px; display:flex; align-items:center; justify-content:center;
  font-family:var(--font-mono); font-size:12px;
  color:var(--accent); font-weight:500; flex-shrink:0;
  transition:all 0.22s;
}
.step:hover .step-num {
  background:var(--accent-muted);
  border-color:var(--accent);
  box-shadow:0 0 10px rgba(99,102,241,0.2);
}

.step-content h4 { margin-top:2px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FEATURE LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
ul.fl { list-style:none; margin:14px 0; }

ul.fl li {
  padding:9px 0 9px 18px; color:var(--text-secondary);
  font-size:16px; font-weight:300; line-height:1.85;
  position:relative;
}

ul.fl li::before {
  content:''; width:5px; height:5px;
  background:var(--accent); border-radius:50%;
  position:absolute; left:0;
  top:calc(7px + (1.75em - 5px) / 2);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CHECKLIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
ul.cl { list-style:none; margin:14px 0; }

ul.cl li {
  padding:8px 0; color:var(--text-secondary);
  font-size:16px; display:flex;
  align-items:flex-start; gap:9px;
}

.chk {
  width:17px; height:17px; min-width:17px;
  border:2px solid var(--green); border-radius:4px;
  display:flex; align-items:center; justify-content:center;
  margin-top:2px; flex-shrink:0;
}

.chk svg { width:9px; height:9px; stroke:var(--green); fill:none; stroke-width:3; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PRIORITY BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pri {
  display:inline-flex; align-items:center;
  font-size:10.5px; font-family:var(--font-mono);
  padding:2px 7px; border-radius:4px; font-weight:500;
}
.pri.hi { background:rgba(248,113,113,0.1); color:var(--red); border:1px solid rgba(248,113,113,0.2); }
.pri.md { background:rgba(251,191,36,0.1); color:var(--amber); border:1px solid rgba(251,191,36,0.2); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROADMAP CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rcard {
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:10px; padding:20px; margin:10px 0;
  transition:border-color 0.28s, box-shadow 0.28s, transform 0.28s;
}
.rcard:hover {
  border-color:rgba(99,102,241,0.45);
  box-shadow:0 4px 24px rgba(99,102,241,0.1);
  transform:translateY(-2px);
}

.rcard-head {
  display:flex; align-items:center;
  justify-content:space-between; margin-bottom:8px;
  flex-wrap:wrap; gap:8px;
}

.rcard h4 { margin:0; font-size:16px; }
.rcard p { font-size:14.5px; margin-bottom:0; }

.rbadge {
  font-size:10px; font-family:var(--font-mono);
  padding:3px 8px; border-radius:4px; font-weight:500;
}
.rbadge.up { background:rgba(99,102,241,0.12); color:var(--accent); border:1px solid rgba(99,102,241,0.2); }
.rbadge.lt { background:rgba(96,165,250,0.1); color:var(--blue); border:1px solid rgba(96,165,250,0.15); }
.rbadge.ct { background:rgba(52,211,153,0.1); color:var(--green); border:1px solid rgba(52,211,153,0.15); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--border-hover); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.b2t {
  position:fixed; bottom:28px; right:28px;
  width:38px; height:38px;
  background:var(--bg-secondary); border:1px solid var(--border);
  border-radius:8px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; opacity:0; transform:translateY(8px);
  transition:all 0.3s; z-index:50;
  text-decoration:none; color:var(--text-secondary);
}
.b2t.vis { opacity:1; transform:translateY(0); }
.b2t:hover { border-color:var(--accent); color:var(--accent); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer {
  border-top:1px solid var(--border);
  padding-top:28px; margin-top:32px;
}
.footer p { font-size:11.5px; color:var(--text-tertiary); margin:0; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:1050px){
  .sidebar{display:flex}
  .main{margin-left:0}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCROLL REVEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.reveal {
  opacity:0;
  transform:translateY(22px);
  transition:opacity 0.55s cubic-bezier(.22,.68,0,1.2), transform 0.55s cubic-bezier(.22,.68,0,1.2);
}
.reveal.visible {
  opacity:1;
  transform:translateY(0);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECTION DIVIDER SHIMMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes shimmer {
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FILES EDITED TABLE (advanced layer section) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.files-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin:14px 0 20px;
}
.file-pill {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:7px;
  padding:10px 14px;
  display:flex; align-items:center; gap:9px;
  transition:border-color 0.2s, background 0.2s;
}
.file-pill:hover {
  border-color:rgba(99,102,241,0.35);
  background:rgba(99,102,241,0.06);
}
.file-pill-icon {
  width:28px; height:28px; border-radius:5px;
  display:flex; align-items:center; justify-content:center;
  font-size:11px; font-family:var(--font-mono);
  font-weight:600; flex-shrink:0;
}
.fp-enum { background:rgba(244,114,182,0.12); color:#f472b6; }
.fp-struct { background:rgba(251,191,36,0.12); color:#fbbf24; }
.fp-bp { background:rgba(96,165,250,0.12); color:#60a5fa; }
.fp-da { background:rgba(52,211,153,0.12); color:#34d399; }
.file-pill-text { font-size:12.5px; color:var(--text-secondary); font-family:var(--font-mono); }
.file-pill-label { font-size:10px; color:var(--text-tertiary); display:block; margin-top:1px; font-family:var(--font-body); }

@media(max-width:680px){
  .files-grid { grid-template-columns:1fr; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* âœ¨  VISUAL POLISH                                   */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Background Orbs â”€â”€ */
.bg-orbs {
  position:fixed; inset:0;
  pointer-events:none; z-index:0;
  overflow:hidden;
}
.orb {
  position:absolute; border-radius:50%;
}
.orb-1 {
  width:680px; height:680px;
  top:-220px; right:-160px;
  background:radial-gradient(circle, rgba(99,102,241,0.065) 0%, transparent 60%);
  filter:blur(80px);
  animation:orbFloat1 22s ease-in-out infinite;
}
.orb-2 {
  width:500px; height:500px;
  bottom:-180px; left:10%;
  background:radial-gradient(circle, rgba(139,92,246,0.045) 0%, transparent 60%);
  filter:blur(70px);
  animation:orbFloat2 30s ease-in-out infinite;
}
.orb-3 {
  width:380px; height:380px;
  top:38%; left:58%;
  background:radial-gradient(circle, rgba(56,189,248,0.035) 0%, transparent 60%);
  filter:blur(60px);
  animation:orbFloat3 26s ease-in-out infinite;
}
@keyframes orbFloat1 {
  0%,100%{ transform:translate(0,0) scale(1); }
  35%{ transform:translate(-70px, 90px) scale(1.08); }
  70%{ transform:translate(50px, -50px) scale(0.96); }
}
@keyframes orbFloat2 {
  0%,100%{ transform:translate(0,0) scale(1); }
  50%{ transform:translate(80px, -70px) scale(1.1); }
}
@keyframes orbFloat3 {
  0%,100%{ transform:translate(0,0) scale(1); }
  40%{ transform:translate(-55px, -40px) scale(1.05); }
  70%{ transform:translate(40px, 50px) scale(0.95); }
}

/* â”€â”€ Hero Glow Pulse â”€â”€ */
.hero-glow {
  animation:heroGlowPulse 8s ease-in-out infinite alternate;
}
@keyframes heroGlowPulse {
  0%{ opacity:0.7; transform:scale(1) translate(0,0); }
  100%{ opacity:1; transform:scale(1.2) translate(-18px, 12px); }
}

/* â”€â”€ Hero Second Orb (right side) â”€â”€ */
.hero-glow-2 {
  position:absolute; top:-20px; right:-40px;
  width:280px; height:220px;
  background:radial-gradient(ellipse, rgba(139,92,246,0.065) 0%, transparent 65%);
  pointer-events:none;
  animation:heroGlow2Pulse 10s ease-in-out infinite alternate;
}
@keyframes heroGlow2Pulse {
  0%{ opacity:0.5; transform:scale(0.93) translate(0,0); }
  100%{ opacity:1; transform:scale(1.18) translate(12px, -10px); }
}

/* â”€â”€ h2 Animated Underline â”€â”€ */
h2::after {
  content:'';
  position:absolute; left:0; bottom:-5px;
  height:2px; width:0;
  background:linear-gradient(90deg, var(--accent), #a78bfa 55%, transparent);
  border-radius:1px;
  transition:width 0.7s cubic-bezier(.22,.68,0,1.2) 0.2s;
}
.section.reveal.visible h2::after { width:90px; }

/* â”€â”€ Traffic Light Dots Glow â”€â”€ */
.cd.r { box-shadow:0 0 5px rgba(248,113,113,0.55); }
.cd.y { box-shadow:0 0 5px rgba(251,191,36,0.5); }
.cd.g { box-shadow:0 0 5px rgba(52,211,153,0.55); }

/* â”€â”€ Active Nav Indicator Glow â”€â”€ */
.nav-item.active::before {
  box-shadow:0 0 8px 1px rgba(99,102,241,0.5);
}

/* â”€â”€ Table Top Gradient Accent â”€â”€ */
.tw::before {
  content:'';
  position:absolute; top:0; left:0; right:0; height:2px;
  background:linear-gradient(90deg, var(--accent), #a78bfa 50%, transparent);
  border-radius:9px 9px 0 0;
  opacity:0.55;
}

/* â”€â”€ Inline Code (.ci) Hover Glow â”€â”€ */
.ci { transition:border-color 0.2s, box-shadow 0.2s; }
.ci:hover {
  border-color:rgba(99,102,241,0.42);
  box-shadow:0 0 8px rgba(99,102,241,0.15);
}

/* â”€â”€ Callout Left Border Inner Glow â”€â”€ */
.callout::before {
  content:'';
  position:absolute; left:0; top:0; bottom:0; width:55px;
  border-radius:9px 0 0 9px;
  pointer-events:none;
  opacity:0.07;
  transition:opacity 0.22s;
}
.callout.tip::before    { background:linear-gradient(90deg, var(--green), transparent); }
.callout.warning::before { background:linear-gradient(90deg, var(--amber), transparent); }
.callout.info::before   { background:linear-gradient(90deg, var(--blue), transparent); }
.callout.note::before   { background:linear-gradient(90deg, var(--accent), transparent); }
.callout:hover::before  { opacity:0.15; }

/* â”€â”€ Step Number Gradient Background â”€â”€ */
.steps .step-num {
  background:linear-gradient(135deg, var(--bg-tertiary), rgba(99,102,241,0.14));
}

/* â”€â”€ Back to Top Glow â”€â”€ */
.b2t:hover {
  box-shadow:0 0 18px rgba(99,102,241,0.3);
}

/* â”€â”€ Sidebar Bottom Fade â”€â”€ */
.sidebar::after {
  content:'';
  position:absolute; bottom:0; left:0; right:0; height:70px;
  background:linear-gradient(to top, rgba(14,18,32,0.95), transparent);
  pointer-events:none; z-index:2;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ¨ SECTION 4.3 - LAYERS VISUAL REDESIGN             */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Mode Cards Grid */
.mode-cards {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  margin:20px 0 28px;
}
.mode-card {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:10px;
  padding:18px;
  transition:border-color 0.25s, transform 0.2s;
}
.mode-card:hover {
  border-color:rgba(99,102,241,0.4);
  transform:translateY(-2px);
}
.mode-card-title {
  font-family:var(--font-mono);
  font-size:13px;
  font-weight:600;
  color:var(--accent);
  margin-bottom:8px;
  display:flex;
  align-items:center;
  gap:6px;
}
.mode-card-icon {
  width:18px; height:18px;
  background:rgba(99,102,241,0.15);
  border-radius:4px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:10px;
}
.mode-card-desc {
  font-size:14.5px;
  color:var(--text-secondary);
  line-height:1.7;
}

/* Formula Highlight Box */
.formula-box {
  background:linear-gradient(135deg, rgba(99,102,241,0.08), rgba(139,92,246,0.06));
  border:1px solid rgba(99,102,241,0.25);
  border-radius:10px;
  padding:20px 24px;
  margin:24px 0;
  font-family:var(--font-mono);
  font-size:16px;
  text-align:center;
  color:#d8dde8;
  letter-spacing:0.02em;
}
.formula-box strong {
  color:var(--accent);
  font-size:17px;
}
.formula-keyword {
  color:#a78bfa;
  font-weight:600;
}

/* Node Badge (inline) */
.node-badge {
  display:inline-flex;
  align-items:center;
  background:rgba(99,102,241,0.12);
  border:1px solid rgba(99,102,241,0.25);
  border-radius:6px;
  padding:4px 10px;
  font-family:var(--font-mono);
  font-size:13px;
  color:var(--accent);
  font-weight:500;
  margin:0 2px;
}

/* Section 4.3 subsections - add top margin */
#s4-3 h4 {
  margin-top:36px;
  padding-top:20px;
  border-top:1px solid rgba(30,42,69,0.5);
}
#s4-3 h4:first-of-type {
  border-top:none;
  padding-top:0;
  margin-top:24px;
}

@media(max-width:768px){
  .mode-cards { grid-template-columns:1fr; }
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ”§ PROFESSIONAL DOCUMENTATION FEATURES              */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Search Box â”€â”€ */
.search-container {
  padding:16px 22px;
  border-bottom:1px solid var(--border);
  position:sticky; top:0;
  background:var(--bg-secondary); z-index:2;
}
.search-box {
  position:relative;
}
.search-input {
  width:100%;
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:8px;
  padding:10px 14px 10px 38px;
  color:var(--text-primary);
  font-family:var(--font-body);
  font-size:14px;
  outline:none;
  transition:border-color 0.2s, box-shadow 0.2s;
}
.search-input:focus {
  border-color:var(--accent);
  box-shadow:0 0 0 3px rgba(99,102,241,0.1);
}
.search-input::placeholder {
  color:var(--text-tertiary);
}
.search-icon {
  position:absolute;
  left:12px; top:50%;
  transform:translateY(-50%);
  color:var(--text-tertiary);
  font-size:14px;
  pointer-events:none;
}
.search-shortcut {
  position:absolute;
  right:12px; top:50%;
  transform:translateY(-50%);
  background:var(--bg-code);
  border:1px solid var(--border);
  border-radius:4px;
  padding:2px 6px;
  font-family:var(--font-mono);
  font-size:11px;
  color:var(--text-tertiary);
  pointer-events:none;
}
.search-results {
  position:absolute;
  top:calc(100% + 8px);
  left:0; right:0;
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:8px;
  max-height:400px;
  overflow-y:auto;
  box-shadow:0 8px 24px rgba(0,0,0,0.3);
  display:none;
}
.search-results.active { display:block; }
.search-result-item {
  padding:12px 16px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
  transition:background 0.15s;
}
.search-result-item:last-child { border-bottom:none; }
.search-result-item:hover,
.search-result-item.selected {
  background:rgba(99,102,241,0.1);
}
.search-result-title {
  font-size:13px;
  font-weight:500;
  color:var(--text-primary);
  margin-bottom:4px;
}
.search-result-path {
  font-size:11px;
  color:var(--text-tertiary);
  font-family:var(--font-mono);
}
.search-result-snippet {
  font-size:12px;
  color:var(--text-secondary);
  margin-top:6px;
  line-height:1.5;
}
.search-highlight {
  background:rgba(99,102,241,0.25);
  color:var(--accent);
  padding:1px 2px;
  border-radius:2px;
}
.search-no-results {
  padding:24px;
  text-align:center;
  color:var(--text-tertiary);
  font-size:13px;
}

/* â”€â”€ Copy Code Button â”€â”€ */
.code-block {
  position:relative;
}
.copy-code-btn {
  position:absolute;
  top:12px; right:12px;
  background:rgba(99,102,241,0.1);
  border:1px solid rgba(99,102,241,0.25);
  border-radius:6px;
  padding:6px 12px;
  font-family:var(--font-mono);
  font-size:11px;
  color:var(--accent);
  cursor:pointer;
  transition:all 0.2s;
  display:flex;
  align-items:center;
  gap:6px;
  opacity:0;
}
.code-block:hover .copy-code-btn { opacity:1; }
.copy-code-btn:hover {
  background:rgba(99,102,241,0.2);
  border-color:var(--accent);
  transform:translateY(-1px);
}
.copy-code-btn.copied {
  background:rgba(52,211,153,0.15);
  border-color:rgba(52,211,153,0.3);
  color:var(--green);
}
.copy-icon {
  font-size:12px;
}

/* â”€â”€ Enhanced Anchor Links â”€â”€ */
h2 .anchor,
h3 .anchor,
h4 .anchor {
  opacity:0.35;
  transition:opacity 0.2s;
  font-size:0.7em;
  color:var(--text-tertiary);
  text-decoration:none;
  margin-left:8px;
}
h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor {
  opacity:0.7;
}
h2 .anchor:hover,
h3 .anchor:hover,
h4 .anchor:hover {
  opacity:1;
  color:var(--accent);
}

/* â”€â”€ Section Numbers Enhancement â”€â”€ */
.nav-num {
  background:rgba(99,102,241,0.1);
  border-radius:4px;
  padding:2px 6px;
  font-size:10px;
}

/* â”€â”€ Keyboard Hint â”€â”€ */
.kb-hint {
  position:fixed;
  bottom:80px;
  right:28px;
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  padding:8px 12px;
  border-radius:8px;
  font-family:var(--font-mono);
  font-size:11px;
  color:var(--text-tertiary);
  opacity:0;
  transform:translateY(8px);
  transition:all 0.3s;
  pointer-events:none;
  z-index:60;
}
.kb-hint.show {
  opacity:1;
  transform:translateY(0);
}
.kb-hint kbd {
  background:var(--bg-code);
  border:1px solid var(--border);
  border-radius:3px;
  padding:2px 5px;
  font-size:10px;
  color:var(--accent);
}



/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âœ¨ PROFESSIONAL POLISH (Minimal & Functional)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Subtle section accent - single color only */
.section {
  position: relative;
  padding-left: 0;
  transition: transform 0.2s ease;
}

.section::before {
  content: '';
  position: absolute;
  left: -24px;
  top: 0;
  bottom: 0;
  width: 2px;
  background: linear-gradient(180deg, 
    transparent 0%, 
    rgba(99, 102, 241, 0.15) 10%, 
    rgba(99, 102, 241, 0.15) 90%, 
    transparent 100%);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.section:hover::before {
  opacity: 1;
}

/* Improved heading hierarchy */
h2 {
  letter-spacing: -0.02em;
  padding-bottom: 12px;
  border-bottom: 1px solid rgba(99, 102, 241, 0.1);
  margin-bottom: 28px;
}

h3 {
  margin-top: 40px;
  padding-top: 16px;
  border-top: 1px solid transparent;
}

h3:first-of-type {
  margin-top: 0;
  border-top: none;
  padding-top: 0;
}

h4 {
  margin-top: 28px;
}

/* Enhanced interactive elements */
/* Anchor links in headings (# symbol) */
h2 .anchor,
h3 .anchor,
h4 .anchor {
  opacity: 0.35;
  transition: opacity 0.2s ease;
}

h2:hover .anchor,
h3:hover .anchor,
h4:hover .anchor {
  opacity: 0.7;
}

h2 .anchor:hover,
h3 .anchor:hover,
h4 .anchor:hover {
  opacity: 1;
}

/* Better link styling */
a:not(.anchor):not(.nav-item):not(.cb-label) {
  color: var(--accent);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition: border-color 0.2s ease;
}

a:not(.anchor):not(.nav-item):not(.cb-label):hover {
  border-bottom-color: var(--accent);
}

/* Improved section dividers */
.section-divider {
  height: 1px;
  background: linear-gradient(90deg, 
    transparent 0%, 
    rgba(99, 102, 241, 0.15) 40%, 
    rgba(99, 102, 241, 0.15) 60%, 
    transparent 100%);
  margin: 64px 0;
  border: none;
}

/* Code block refinements */
.code-block {
  margin: 24px 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
}

.code-block:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
}

/* Callout improvements */
.callout {
  margin: 28px 0;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.callout:hover {
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
}

/* Table enhancements */
.tw table {
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* Navigation active state refinement */
.nav-item.active {
  background: rgba(99, 102, 241, 0.08);
  border-left: 3px solid var(--accent);
  padding-left: 17px;
}

/* Smooth transitions for all interactive elements */
.nav-item,
.copy-code-btn,
button,
.callout,
.code-block,
.mode-card {
  transition: all 0.2s ease;
}

/* Focus states for accessibility */
a:focus,
button:focus,
.nav-item:focus {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* Consistent spacing rhythm */
p + p {
  margin-top: 16px;
}

ul + p,
ol + p,
.code-block + p,
.callout + p {
  margin-top: 22px;
}


/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ”§ FIX: Sidebar Quantization "disabled" look + iOS focus box */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* 1) The sidebar bottom fade overlay can make lower items look "disabled". Disable it. */
.sidebar::after {
  height: 0 !important;
  background: none !important;
}

/* 2) iOS/touch taps often leave focus outlines on links. For sidebar nav items, use a subtle highlight instead. */
.nav-item:focus { outline: none; }
.nav-item:focus:not(.active) {
  background: var(--bg-tertiary);
  color: var(--text-primary);
}

/* Keep accessible focus ring for keyboard users */
.nav-item:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ“± MOBILE HAMBURGER MENU                            */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mobile-menu-btn {
  display:none;
  position:fixed; top:16px; left:16px; z-index:150;
  width:44px; height:44px;
  background:var(--bg-secondary);
  border:1px solid var(--border);
  border-radius:10px;
  cursor:pointer;
  align-items:center; justify-content:center;
  box-shadow:0 4px 16px rgba(0,0,0,0.25);
  transition:all 0.25s;
}
.mobile-menu-btn:hover {
  border-color:var(--accent);
  box-shadow:0 4px 20px rgba(99,102,241,0.2);
}
.mobile-menu-btn svg {
  width:20px; height:20px;
  stroke:var(--text-secondary);
  fill:none; stroke-width:2;
  stroke-linecap:round;
  transition:stroke 0.2s;
}
.mobile-menu-btn:hover svg { stroke:var(--accent); }
.mobile-menu-btn .hamburger-close { display:none; }
.mobile-menu-btn.active .hamburger-open { display:none; }
.mobile-menu-btn.active .hamburger-close { display:block; }

.sidebar-overlay {
  display:none;
  position:fixed; inset:0; z-index:95;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(4px);
  -webkit-backdrop-filter:blur(4px);
  opacity:0; transition:opacity 0.3s;
}
.sidebar-overlay.active {
  display:block; opacity:1;
}

@media(max-width:1050px){
  .mobile-menu-btn { display:flex; }
  .sidebar {
    transform:translateX(-100%);
    transition:transform 0.35s cubic-bezier(.22,.68,0,1);
    box-shadow:none;
  }
  .sidebar.mobile-open {
    transform:translateX(0);
    box-shadow:8px 0 32px rgba(0,0,0,0.3);
  }
  .content-wrapper { margin-left:0 !important; }
  .main { padding:32px 24px 80px; padding-top:72px; }
  .hero h1 { font-size:40px; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ¯ FAQ ACCORDION STYLING                           */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
details.callout {
  border:1px solid var(--border);
  border-left:3px solid var(--accent);
  background:var(--bg-tertiary);
  border-radius:9px;
  margin:10px 0;
  overflow:hidden;
  transition:border-color 0.25s, box-shadow 0.25s;
}
details.callout:hover {
  border-color:rgba(99,102,241,0.4);
  box-shadow:0 2px 12px rgba(99,102,241,0.08);
}
details.callout summary {
  padding:16px 20px;
  cursor:pointer;
  font-weight:500;
  font-size:15.5px;
  color:var(--text-primary);
  list-style:none;
  display:flex;
  align-items:center;
  gap:12px;
  transition:background 0.2s;
  user-select:none;
}
details.callout summary::-webkit-details-marker { display:none; }
details.callout summary::before {
  content:'';
  width:20px; height:20px; min-width:20px;
  background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%236366f1' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M9 18l6-6-6-6'/%3E%3C/svg%3E");
  background-size:contain;
  background-repeat:no-repeat;
  transition:transform 0.3s cubic-bezier(.22,.68,0,1);
  flex-shrink:0;
}
details.callout[open] summary::before {
  transform:rotate(90deg);
}
details.callout summary:hover {
  background:rgba(99,102,241,0.04);
}
details.callout > div {
  padding:0 20px 16px;
  animation:faqSlideIn 0.3s ease-out;
}
details.callout > div p {
  font-size:14.5px;
  color:var(--text-secondary);
  line-height:1.75;
}
@keyframes faqSlideIn {
  from { opacity:0; transform:translateY(-8px); }
  to { opacity:1; transform:translateY(0); }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ¨ SVG ICON STYLING                                */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.callout-title {
  display:flex; align-items:center; gap:8px;
}
.callout-icon {
  width:16px; height:16px; flex-shrink:0;
  display:inline-flex; align-items:center; justify-content:center;
}
.callout-icon svg {
  width:16px; height:16px; fill:none; stroke-width:2;
  stroke-linecap:round; stroke-linejoin:round;
}
.callout.tip .callout-icon svg { stroke:var(--green); }
.callout.warning .callout-icon svg { stroke:var(--amber); }
.callout.info .callout-icon svg { stroke:var(--blue); }
.callout.note .callout-icon svg { stroke:var(--accent); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* ğŸ–¨ï¸ PRINT STYLES                                    */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media print {
  body { background:#fff; color:#111; font-size:12pt; display:block; }
  .sidebar, .right-sidebar, .bg-orbs, .progress-bar,
  .b2t, .mobile-menu-btn, .sidebar-overlay,
  .hero-glow, .hero-glow-2, .search-container,
  .kb-hint, .copy-code-btn { display:none !important; }
  .content-wrapper { margin-left:0 !important; max-width:100%; padding:0; }
  .main { padding:20px 0; max-width:100%; }
  .hero h1 { font-size:28pt; color:#111; }
  .hero h1 .grad { -webkit-text-fill-color:#333; background:none; }
  h2, h3, h4 { color:#111; page-break-after:avoid; }
  h2::after { display:none; }
  .section { break-inside:avoid; }
  .section::before { display:none; }
  .section-divider { background:#ccc; margin:24px 0; }
  .callout { border-color:#999; background:#f8f8f8; }
  .callout-title { color:#333 !important; }
  .callout p, p { color:#333; }
  .code-block { border-color:#ccc; break-inside:avoid; }
  .code-block pre { color:#333; font-size:10pt; }
  .cb-head { background:#eee; }
  .ci { background:#eee; border-color:#ccc; color:#333; }
  table { border:1px solid #ccc; }
  thead { background:#eee; }
  thead th, tbody td { border-bottom:1px solid #ddd; color:#333; }
  a { color:#333; text-decoration:underline; }
  .reveal { opacity:1 !important; transform:none !important; }
  .hero-badge { border-color:#ccc; color:#555; }
  .rbadge { border-color:#999; background:#eee; color:#555; }
  details.callout { break-inside:avoid; }
  details.callout summary::before { display:none; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* âœ¨ ADDITIONAL PROFESSIONAL POLISH                   */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* Glossary cards grid */
.grid.cols-2 {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  margin:20px 0;
}
.grid.cols-2 .card {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:10px;
  padding:18px;
  transition:border-color 0.25s, transform 0.2s;
}
.grid.cols-2 .card:hover {
  border-color:rgba(99,102,241,0.35);
  transform:translateY(-2px);
}
.card-title {
  font-family:var(--font-mono);
  font-size:13px;
  font-weight:600;
  color:var(--accent);
  margin-bottom:8px;
}
.card p {
  font-size:14px;
  line-height:1.65;
  margin-bottom:0;
}
@media(max-width:600px){
  .grid.cols-2 { grid-template-columns:1fr; }
}

/* Firefox scrollbar */
* {
  scrollbar-width:thin;
  scrollbar-color:var(--border) transparent;
}

/* Better selection colors */
::selection {
  background:rgba(99,102,241,0.3);
  color:#fff;
}

/* Reading progress in sidebar */
.sidebar-reading-progress {
  height:2px;
  background:var(--bg-tertiary);
  margin:0 22px 8px;
  border-radius:1px;
  overflow:hidden;
}
.sidebar-reading-progress-fill {
  height:100%;
  width:0%;
  background:linear-gradient(90deg, var(--accent), #a78bfa);
  border-radius:1px;
  transition:width 0.15s linear;
}

/* Enhanced footer */
.footer {
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:16px;
  flex-wrap:wrap;
}
.footer-links {
  display:flex; gap:16px;
}
.footer-links a {
  font-size:11.5px;
  color:var(--text-tertiary);
  text-decoration:none;
  transition:color 0.2s;
}
.footer-links a:hover { color:var(--accent); }

/* Widget SVG icons */
.widget-icon-svg {
  width:18px; height:18px;
  stroke:var(--accent);
  fill:none; stroke-width:1.8;
  stroke-linecap:round; stroke-linejoin:round;
}

/* Search icon SVG */
.search-icon-svg {
  position:absolute;
  left:12px; top:50%;
  transform:translateY(-50%);
  width:15px; height:15px;
  stroke:var(--text-tertiary);
  fill:none; stroke-width:2;
  stroke-linecap:round; stroke-linejoin:round;
  pointer-events:none;
}

/* Copy button SVG */
.copy-code-btn svg {
  width:14px; height:14px;
  stroke:currentColor;
  fill:none; stroke-width:2;
  stroke-linecap:round; stroke-linejoin:round;
}

</style>
</head>
<body>
<!-- â”€â”€ Background Orbs â”€â”€ -->
<div aria-hidden="true" class="bg-orbs">
<div class="orb orb-1"></div>
<div class="orb orb-2"></div>
<div class="orb orb-3"></div>
</div>
<div class="progress-bar" id="progressBar"></div>
<!-- â”€â”€ Mobile Menu Button â”€â”€ -->
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation">
  <svg class="hamburger-open" viewBox="0 0 24 24"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
  <svg class="hamburger-close" viewBox="0 0 24 24"><line x1="6" y1="6" x2="18" y2="18"/><line x1="6" y1="18" x2="18" y2="6"/></svg>
</button>
<div class="sidebar-overlay" id="sidebarOverlay"></div>
<!-- â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="sidebar">
<div class="sidebar-header">
<a class="sidebar-logo" href="#top">
<div class="logo-icon">
<svg viewbox="0 0 24 24"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
</div>
<div>
<div class="logo-text">BeatSyncToolkit</div>
<div class="logo-sub">Adaptive Music Conductor Â· UE5</div>
</div>
</a>
<div class="sidebar-version"><span class="ver-dot"></span> v1.1 Â· 2026-02-01</div>
</div>
<div class="search-container">
<div class="search-box">
<svg class="search-icon-svg" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
<input autocomplete="off" class="search-input" id="searchInput" placeholder="Search documentation..." type="text"/>
<span class="search-shortcut">/</span>
<div class="search-results" id="searchResults"></div>
</div>
</div>
<div class="sidebar-nav">
<div class="sidebar-reading-progress"><div class="sidebar-reading-progress-fill" id="sidebarProgress"></div></div>
<div class="nav-section-label">Documentation</div>
<a class="nav-item" data-id="s0" href="#s0"><span class="nav-num">00</span> Before You Start</a>
<a class="nav-item" data-id="s1" href="#s1"><span class="nav-num">01</span> What It Does</a>
<a class="nav-item" data-id="s2" href="#s2"><span class="nav-num">02</span> Quick Start [BEGINNER]</a>
<div class="nav-sub">
<a class="nav-item" data-id="s2-0" href="#s2-0">Troubleshooting</a>
</div>
<a class="nav-item" data-id="s3" href="#s3"><span class="nav-num">03</span> Included Assets</a>
<a class="nav-item" data-id="s4" href="#s4"><span class="nav-num">04</span> Core Concepts [BEGINNER]</a>
<div class="nav-sub">
<a class="nav-item" data-id="s4-1" href="#s4-1">Conductor Actor</a>
<a class="nav-item" data-id="s4-2" href="#s4-2">Profiles â†’ States â†’ Playlists</a>
<a class="nav-item" data-id="s4-3" href="#s4-3">Layers (Stems)</a>
<a class="nav-item" data-id="s4-4" href="#s4-4">Beat/Bar Clock</a>
<a class="nav-item" data-id="s4-5" href="#s4-5">Zones [INTERMEDIATE]</a>
<a class="nav-item" data-id="s4-6" href="#s4-6">Intensity (0..1) [ADVANCED]</a>
</div>
<a class="nav-item" data-id="s5" href="#s5"><span class="nav-num">05</span> Music Profiles</a>
<div class="nav-sub">
<a class="nav-item" data-id="s5-audio-prep" href="#s5-audio-prep">Audio Preparation Guide</a>
<a class="nav-item" data-id="s5-5" href="#s5-5">Adding a New State</a>
<a class="nav-item" data-id="s5-6" href="#s5-6">Adding a Custom Layer</a>
<a class="nav-item" data-id="s5-7" href="#s5-7">Advanced: Default Layer Control</a>
<a class="nav-item" data-id="s5-8" href="#s5-8">Intensity Overrides</a>
</div>
<a class="nav-item" data-id="s6" href="#s6"><span class="nav-num">06</span> Gameplay API</a>
<a class="nav-item" data-id="s7" href="#s7"><span class="nav-num">07</span> Conductor Settings</a>
<a class="nav-item" data-id="s8" href="#s8"><span class="nav-num">08</span> Zone System [INTERMEDIATE]</a>
<a class="nav-item" data-id="s9" href="#s9"><span class="nav-num">09</span> Arbitration Rules [ADVANCED]</a>
<a class="nav-item" data-id="s10" href="#s10"><span class="nav-num">10</span> Quantization</a>
<a class="nav-item" data-id="s11" href="#s11"><span class="nav-num">11</span> Playlist &amp; Track Lock</a>
<a class="nav-item" data-id="s12" href="#s12"><span class="nav-num">12</span> Practical Examples</a>
<a class="nav-item" data-id="s13" href="#s13"><span class="nav-num">13</span> Debugging</a>
<a class="nav-item" data-id="s14" href="#s14"><span class="nav-num">14</span> Advanced Features [ADVANCED]</a>
<a class="nav-item" data-id="s15" href="#s15"><span class="nav-num">15</span> Limitations &amp; Roadmap</a>
<a class="nav-item" data-id="s16" href="#s16"><span class="nav-num">16</span> Glossary</a>
<a class="nav-item" data-id="s17" href="#s17"><span class="nav-num">17</span> FAQ</a>
<a class="nav-item" data-id="s18" href="#s18"><span class="nav-num">18</span> Support & Contact</a>
<!-- Sidebar spacer: prevents nav items from sitting under the bottom fade overlay -->
<div aria-hidden="true" style="height:90px;"></div>
</div>
</nav>
<!-- â•â•â•â•â•â•â•â•â•â•â• MAIN CONTENT â•â•â•â•â•â•â•â•â•â•â• -->
<div class="content-wrapper">
<main class="main" id="top">
<!-- â”€â”€â”€ HERO â”€â”€â”€ -->
<div class="hero">
<div class="hero-glow"></div>
<div class="hero-glow-2"></div>
<div class="hero-badge"><span class="dot"></span> UE5 Blueprint Â· No Quartz Required</div>
<h1>Beat<span class="grad">Sync</span>Toolkit</h1>
<p class="hero-subtitle">Beat/Bar-Synced Adaptive Music Conductor for Unreal Engine 5. Drive your game's music reactively from Blueprint â€” state transitions, layered stems, zones, and quantized timing. All without a custom GameInstance.</p>
<div class="hero-meta">
<div class="hero-meta-item"><span>Version</span>Â <span class="val">v1.1</span></div>
<div class="hero-meta-item"><span>Engine</span>Â <span class="val">UE 5.5.x</span></div>
<div class="hero-meta-item"><span>Type</span>Â <span class="val">Blueprint-First</span></div>
<div class="hero-meta-item"><span>Date</span>Â <span class="val">2026-02-01</span></div>
</div>
</div>
<!-- â•â•â• 0 â•â•â• -->
<section class="section visible" id="s0">
<h2><a class="anchor" href="#s0">#</a> Before You Start â€” Prerequisites <span class="rbadge ct" style="margin-left:auto">BEGINNER</span></h2>
<p>This documentation assumes you can navigate Unreal Editor comfortably and make basic Blueprint connections. If youâ€™re brand new, donâ€™t worry â€” you can still follow along, but these basics will help a lot.</p>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> What you should know (minimum)</div>
<ul class="ul">
<li><strong style="color:var(--text-primary)">Blueprint basics</strong> â€” variables, functions, events, calling nodes.</li>
<li><strong style="color:var(--text-primary)">Actor placement</strong> â€” dragging Actors into a Level and editing their Details panel.</li>
<li><strong style="color:var(--text-primary)">Basic audio concepts</strong> â€” what BPM is, and how to import WAV files into UE.</li>
</ul>
</div>
<h3>Data Assets (quick explanation)</h3>
<p>A <strong style="color:var(--text-primary)">Data Asset</strong> is an Unreal asset used to store structured configuration data. BeatSyncToolkit uses Data Assets for <span class="ci">Music Profiles</span> (playlists, BPM, stems, defaults, etc.). You edit the profile once, then every placed Conductor can reference it.</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Tip</div>
<p>If you donâ€™t know what a Data Asset is yet, you can still use the default profile for testing â€” see the <a href="#s2">Quick Start</a>.</p>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Engine Compatibility</div>
<p>BeatSyncToolkit is built and tested on <strong style="color:var(--text-primary)">UE 5.5.x</strong>. It uses standard Blueprint features (AudioComponents, Timers, Overlap Events, Data Assets) with no engine modifications, so it is expected to work on UE 5.4 and UE 5.3 as well. However, only 5.5.x is officially tested and supported. If you encounter issues on older engine versions, please report them.</p>
</div>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 1 â•â•â• -->
<section class="section visible" id="s1">
<h2><a class="anchor" href="#s1">#</a> 1. What BeatSyncToolkit Does</h2>
<p>BeatSyncToolkit lets you drive adaptive music in Unreal Engine using gameplay-friendly Blueprint nodes. It provides beat/bar timing, state-based music selection with per-state playlists, optional stem layers, and a zone system that can override the global music state and add extra layers â€” all without requiring a custom GameInstance.</p>
<h3>Key Features</h3>
<ul class="fl">
<li>Beat/bar clock (Timer-based) with an <span class="ci">OnBar</span> event for quantized changes â€” no Quartz dependency.</li>
<li>State system (<span class="ci">E_BST_MusicState</span>): switch music by gameplay state, optionally quantized to the next bar. New states can be added by extending the enum + defining a matching StateConfig in your profile â€” see <a href="#s5-5" style="color:var(--accent);text-decoration:none;">Adding a New State</a>.</li>
<li>Per-state playlist: each state can contain multiple tracks; auto-advance to the next track when the current ends.</li>
<li>Two-base crossfade playback (Base A / Base B) for smooth transitions between tracks and states.</li>
<li>Optional stem layers (<span class="ci">E_BST_MusicLayer</span>: Drums, Bass, Harmony, Melody, FX). Layers are always started muted and faded in/out â€” no restart.</li>
<li>Event-based layers: add/remove/clear layers via global Blueprint nodes (<span class="ci">BFL_BST</span>) with optional next-bar quantization.</li>
<li>Multi-layer event calls: add any number of layers in one node (array input), with optional next-bar quantization.</li>
<li>Start/Stop Music: optionally start silent and trigger <span class="ci">BST_StartMusic</span> / <span class="ci">BST_StopMusic</span> from gameplay or demo interactions.</li>
<li>Zone system (<span class="ci">BP_BST_MusicZone</span>): priority-based TopZone selection, zone state override, extra layers, and optional per-zone profile override.</li>
<li>Zone + event layer arbitration: effective layers are the OR combination of zone layers and event layers.</li>
<li>Quantized zone layer updates: zone layer changes can be applied immediately or on the next bar.</li>
<li>Playlist Track Lock: lock the currently playing track so it restarts instead of advancing â€” event-based and optional zone-based.</li>
<li>Low-friction UX: all gameplay calls go through a Blueprint Function Library. No manual Conductor references required.</li>
</ul>
<h3>What You Need to Place in Your Level</h3>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Required Actors</div>
<p><span class="ci">BP_BST_Conductor</span> â€” exactly one Conductor Actor in the level. This is the only mandatory placement. Optionally add one or more <span class="ci">BP_BST_MusicZone</span> actors for zone-based overrides and layer additions.</p>
</div>
<div id="s1-1">
<h3>1.1 Common Use Cases</h3>
<p>Below are simple â€œcopy-the-logicâ€ examples of the most common API calls. For more detailed scenarios (zones, track lock, quantization), see <a href="#s12" style="color:var(--accent)">Section 12: Practical Examples</a>.</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Example 1 Â· Switch to Combat Music</span></div>
<pre><span class="cmt">// In your Combat Manager / AI Director / GameMode:</span>
<span class="kw">OnEnemySpawned</span> (or <span class="kw">OnCombatStart</span>)
  <span class="fn">BST_SetMusicState</span>(<span class="cls">WorldContextObject</span>=<span class="val">Self</span>, <span class="val">NewState</span>=<span class="val">Combat</span>)</pre>
</div>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Example 2 Â· Add Drums Layer in a Boss Arena (Quantized)</span></div>
<pre><span class="cmt">// When player enters boss arena trigger:</span>
<span class="kw">OnBossArenaEntered</span>
  <span class="fn">BST_AddLayer</span>(<span class="cls">WorldContextObject</span>=<span class="val">Self</span>, <span class="val">Layer</span>=<span class="val">Drums</span>, <span class="val">QuantizeToNextBar</span>=<span class="val">true</span>)</pre>
</div>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Example 3 Â· Lock a Track During a Boss Phase</span></div>
<pre><span class="cmt">// Example: keep the current intense track looping during phase 2</span>
<span class="kw">OnBossHealthBelow50Percent</span>
  <span class="fn">BST_LockCurrentTrack</span>(<span class="cls">WorldContextObject</span>=<span class="val">Self</span>)

<span class="kw">OnBossDefeated</span>
  <span class="fn">BST_UnlockCurrentTrack</span>(<span class="cls">WorldContextObject</span>=<span class="val">Self</span>)</pre>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Reminder</div>
<p>If you forget to connect <span class="ci">Self</span> (or any valid object) to <span class="ci">WorldContextObject</span>, the BFL nodes may fail to find the Conductor and do nothing.</p>
</div>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Critical: Always Connect WorldContextObject</div>
<p>When calling any <span class="ci">BFL_BST</span> node (<span class="ci">BST_SetMusicState</span>, <span class="ci">BST_AddLayer(s)</span>, <span class="ci">BST_LockCurrentTrack</span>, etc.), you <strong style="color:var(--text-primary)">must</strong> connect a valid object (usually <span class="ci">Self</span>) to <span class="ci">WorldContextObject</span>. If itâ€™s left empty, the node may silently fail because it cannot locate the current World to find the placed Conductor.</p>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 2 â•â•â• -->
<section class="section visible" id="s2">
<h2><a href="#s2">#</a> 2. Quick Start <span class="rbadge ct" style="margin-left:auto">BEGINNER</span></h2>
<p>Get BeatSyncToolkit up and running in about 10 minutes.</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Absolute Beginner Quick Test (2 minutes)</div>
<ol style="margin:0.25rem 0 0 1.2rem;">
<li>In the Content Browser, open <span class="ci">Plugins â†’ BeatSyncToolkit â†’ Blueprints</span>.</li>
<li>Drag <span class="ci">BP_BST_Conductor</span> into your Level.</li>
<li>Select the Conductor and set:
      <ul class="ul">
<li><span class="ci">ActiveProfile</span> = <span class="ci">DA_BST_MusicProfile_Default</span></li>
<li><span class="ci">AutoStartState</span> = <span class="ci">Explore</span></li>
<li><span class="ci">bStartOnBeginPlay</span> = <strong style="color:var(--text-primary)">true</strong></li>
</ul>
</li>
<li>Press Play â€” music should start.</li>
</ol>
<p style="margin-top:0.6rem;margin-bottom:0;">If it doesnâ€™t play, jump to <a href="#s2-0">Troubleshooting</a>.</p>
</div>
<div class="steps">
<div class="step">
<div class="step-num">1</div>
<div class="step-content">
<h4>Add Content</h4>
<p>Add or import the BeatSyncToolkit content folder into your project â€” keep the folder structure intact. Open or create a test level. Drag <span class="ci">BP_BST_Conductor</span> into the level.</p>
</div>
</div>
<div class="step">
<div class="step-num">2</div>
<div class="step-content">
<h4>Assign a Profile &amp; Auto-Start</h4>
<p>Select <span class="ci">BP_BST_Conductor</span> in the level. If you want music to start automatically, enable <span class="ci">bStartOnBeginPlay</span>. For demos, disable it and call <span class="ci">BST_StartMusic</span> when the player is ready.</p>
<p>In Details â†’ BST â†’ Profile, set <span class="ci">ActiveProfile</span> to <span class="ci">DA_BST_MusicProfile_Default</span> and set <span class="ci">AutoStartState</span> (e.g. Explore). Press Play â€” the Conductor starts the chosen state, initializes the beat clock from the track's BPM/BPB, and begins playback.</p>
</div>
</div>
<div class="step">
<div class="step-num">3</div>
<div class="step-content">
<h4>Drive Music from Gameplay (No References)</h4>
<p>From any Blueprint, call the global nodes in <span class="ci">BFL_BST</span>. The <span class="ci">WorldContextObject</span> input is all that's needed â€” no manual Conductor references.</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BFL_BST Â· Core Nodes</span></div>
<pre><span class="fn">BST_StartMusic</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_StopMusic</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_SetMusicState</span>(<span class="cls">WorldContextObject</span>, <span class="val">NewState</span>)
<span class="fn">BST_AddLayer</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layer</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_AddLayers</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layers[]</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_RemoveLayer</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layer</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_ClearLayers</span>(<span class="cls">WorldContextObject</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_LockCurrentTrack</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_UnlockCurrentTrack</span>(<span class="cls">WorldContextObject</span>)</pre>
</div>
</div>
</div>
<div class="step">
<div class="step-num">4</div>
<div class="step-content">
<h4>Add Zones (Optional)</h4>
<p>Drag <span class="ci">BP_BST_MusicZone</span> into the level and scale its Box Collision to cover an area. Set <span class="ci">ZonePriority</span> (higher wins when zones overlap). Optionally set <span class="ci">ZoneState</span> to override the global state, and fill <span class="ci">ExtraLayers</span> to add layers while inside. Press Play and walk into the zone to see changes in action.</p>
</div>
</div>
</div>
<div id="s2-0">
<h3>Troubleshooting â€” Common Problems &amp; Solutions</h3>
<p>Most issues come from a missing Conductor in the Level, an unassigned profile, or a context object that canâ€™t find the World.</p>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Problem 1: Music doesnâ€™t play</div>
<ul class="ul">
<li>Is <span class="ci">BP_BST_Conductor</span> placed in the Level? (check the Outliner)</li>
<li>Is <span class="ci">ActiveProfile</span> assigned?</li>
<li>Is <span class="ci">AutoStartState</span> NOT <span class="ci">NONE</span>?</li>
<li>Open the console with <span class="ci">`</span> and look for errors.</li>
</ul>
</div>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Problem 2: <span class="ci">BST_SetMusicState</span> â€œdoes nothingâ€</div>
<ul class="ul">
<li>Is <span class="ci">WorldContextObject</span> connected? Usually you should pass <span class="ci">Self</span>.</li>
<li>Is a Conductor placed in the Level (remember: BeatSyncToolkit does <strong style="color:var(--text-primary)">not</strong> auto-spawn it)?</li>
<li>Enable <span class="ci">bDebugPrint</span> on the Conductor to see why a request is ignored.</li>
</ul>
</div>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Problem 3: Layers (stems) are not audible</div>
<ul class="ul">
<li>Does the current <span class="ci">TrackEntry</span> actually have a Sound assigned for that Layer?</li>
<li>Are you calling <span class="ci">BST_AddLayer</span> / <span class="ci">BST_AddLayers</span> with the correct layer enum?</li>
<li>Check layer volumes in the Track Entry (and make sure your stems are exported correctly).</li>
</ul>
</div>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Problem 4: Zones donâ€™t trigger</div>
<ul class="ul">
<li>Is the Zone collision set to <span class="ci">Generate Overlap Events</span> = true?</li>
<li>Does the collision channel overlap your player/pawn?</li>
<li>If you have nested zones, is <span class="ci">ZonePriority</span> correct (highest wins)?</li>
</ul>
</div>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 3 â•â•â• -->
<section class="section visible" id="s3">
<h2><a class="anchor" href="#s3">#</a> 3. Included Assets &amp; Files</h2>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Folder Structure</div>
<p>Keep the content folder structure intact so all internal references (profiles, actors, enums, structs) remain valid. The system is Blueprint-first and does not require a plugin build step.</p>
</div>
<div class="tw">
<table>
<thead><tr><th>Type</th><th>Name</th><th>Purpose</th></tr></thead>
<tbody>
<tr><td><span class="ci">Blueprint Actor</span></td><td><span class="ci">BP_BST_Conductor</span></td><td>Main runtime brain. Holds the beat clock, current state/track, playback components, layers, zones, and all arbitration logic.</td></tr>
<tr><td><span class="ci">Blueprint Actor</span></td><td><span class="ci">BP_BST_MusicZone</span></td><td>Overlap-triggered zone: override state, add extra layers, override profile, and optionally influence zone quantization / track lock.</td></tr>
<tr><td><span class="ci">Function Library</span></td><td><span class="ci">BFL_BST</span></td><td>Global gameplay-facing API. Finds the Conductor and forwards state / layer / lock requests.</td></tr>
<tr><td><span class="ci">Data Asset</span></td><td><span class="ci">DA_BST_MusicProfile_Default</span></td><td>Example profile containing StateConfigs and Track playlists.</td></tr>
<tr><td><span class="ci">Blueprint (Base)</span></td><td><span class="ci">PDA_BST_MusicProfile_Base</span></td><td>Base class type used by the Conductor for profile assets.</td></tr>
<tr><td><span class="ci">Enum</span></td><td><span class="ci">E_BST_MusicState</span></td><td>Music states (e.g. Explore, Combat). Extend by adding new entries â€” see <a href="#s5-5" style="color:var(--accent);text-decoration:none;">Adding a New State</a>.</td></tr>
<tr><td><span class="ci">Enum</span></td><td><span class="ci">E_BST_MusicLayer</span></td><td>Fixed layer set: Drums, Bass, Harmony, Melody, FX.</td></tr>
<tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_TrackEntry</span></td><td>One track: BaseSound + BPM / BPB + optional layer defs for each layer.</td></tr>
<tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_StateConfig</span></td><td>One state configuration: the state enum + its playlist of TrackEntry items.</td></tr>
<tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_LayerDef</span></td><td>Per-layer definition inside TrackEntry: an optional Sound asset and a target volume.</td></tr>
<tr><td><span class="ci">Internal</span></td><td><span class="ci">Pending Layer Queues</span></td><td>Quantized layer ops are implemented via pending arrays / flags processed on <span class="ci">BST_OnBar</span>. No asset â€” runtime only.</td></tr>
</tbody>
</table>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 4 â•â•â• -->
<section class="section visible" id="s4">
<h2><a class="anchor" href="#s4">#</a> 4. Core Concepts <span class="rbadge ct" style="margin-left:auto">BEGINNER</span></h2>
<div id="s4-1">
<h3>4.1 Conductor Actor</h3>
<p><span class="ci">BP_BST_Conductor</span> is the single authority that decides what music is playing. You place it manually in the level â€” it does not auto-spawn. Gameplay code never stores references to it. Instead, calls go through <span class="ci">BFL_BST</span>, which finds the Conductor in the current world and forwards the request.</p>
</div>
<div id="s4-2">
<h3>4.2 Profiles â†’ States â†’ Playlists â†’ Tracks</h3>
<p>A <strong style="color:var(--text-primary)">Music Profile</strong> is a data asset that maps each Music State to a playlist of TrackEntry items.</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Data Hierarchy</span></div>
<pre><span class="cls">Profile</span>  (DA_BST_MusicProfile)
  â””â”€â”€ <span class="cls">StateConfig</span>  (F_BST_StateConfig)
        â”œâ”€â”€ State:  <span class="val">E_BST_MusicState</span>   <span class="cmt">â† e.g. Explore, Combat</span>
        â””â”€â”€ Playlist:  <span class="fn">TrackEntry[]</span>
              â””â”€â”€ <span class="cls">TrackEntry</span>  (F_BST_TrackEntry)
                    â”œâ”€â”€ BaseSound      <span class="cmt">â† main audio (required)</span>
                    â”œâ”€â”€ BPM            <span class="cmt">â† beats per minute</span>
                    â”œâ”€â”€ BeatsPerBar    <span class="cmt">â† time signature</span>
                    â””â”€â”€ Layer Stems (Drums/Bass/Harmony/Melody/FX)    <span class="cmt">â† optional stems</span></pre>
</div>
</div>
<div id="s4-3">
<h3>4.3 Layers (Stems)</h3>
<p>Layers are optional stem audio components. If a TrackEntry provides a sound for a layer, the Conductor starts it immediately when the track begins â€” but at muted standby volume. Add/Remove operations only adjust volume (fade up/down) and do not restart audio.</p>
<p>The fixed layer set is <span class="ci">Drums</span>, <span class="ci">Bass</span>, <span class="ci">Harmony</span>, <span class="ci">Melody</span>, <span class="ci">FX</span>. If a track has no stem for a layer, that layer is safely ignored.</p>
<h4>Gameplay Layer Control (Event-Based)</h4>
<p>Use <span class="ci">BFL_BST</span> layer nodes to add/remove/clear layers from any Blueprint. Each call includes a <span class="ci">QuantizeToNextBar</span> boolean to apply the change on the next bar, or fade right away.</p>
<h4>Add Multiple Layers (Single Node)</h4>
<p>Use <span class="ci">BST_AddLayers</span> with an array input to add 2, 3, or all layers at once. Supply the array using Make Array (<span class="ci">E_BST_MusicLayer</span>). Duplicates are ignored.</p>
<p>Tracks can optionally <strong>auto-enable</strong> certain layers when the track starts (for example: Drums ON by default). This is an advanced feature covered in <a href="#s5-7" style="color:var(--accent);text-decoration:none;">Section 5.7</a>.</p>
</div>
<div id="s4-4">
<h3>4.4 Beat/Bar Clock (No Quartz)</h3>
<p>The Conductor maintains a beat clock using timers. Each beat advances <span class="ci">CurrentBeat</span>, and each bar fires <span class="ci">BST_OnBar</span>. Quantized operations â€” state changes and optional layer changes â€” are applied precisely on <span class="ci">BST_OnBar</span>.</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> No Quartz Dependency</div>
<p>BeatSyncToolkit uses its own timer-based clock instead of Unreal's Quartz system. Zero additional setup â€” just set BPM and BeatsPerBar in your TrackEntry and the clock handles the rest.</p>
</div>
</div>
<div id="s4-5">
<h3>4.5 Zones</h3>
<p><span class="ci">BP_BST_MusicZone</span> is an overlap-based, location-driven control layer. Think of it as â€œautomatic music rules based on where the player isâ€. The Conductor keeps a list of zones the player is currently inside, selects a single <span class="ci">TopZone</span>, then applies that zoneâ€™s behavior (state override, extra layers, optional profile override, optional track lock, and optional bar-quantized changes).</p>
<h4>What Zones Do (At a Glance)</h4>
<ul class="ul">
<li><strong style="color:var(--text-primary)">Location-based state control:</strong> entering an area can automatically switch the music state (e.g. Village â†’ Calm, Forest â†’ Explore).</li>
<li><strong style="color:var(--text-primary)">Extra layers on top:</strong> a zone can add layers (Drums/Bass/etc.) while you are inside, without changing the state.</li>
<li><strong style="color:var(--text-primary)">Optional profile override:</strong> a zone can temporarily switch to a different music profile (useful for â€œDungeon Music Packâ€ vs â€œOverworld Packâ€).</li>
<li><strong style="color:var(--text-primary)">Nested zones are safe:</strong> when multiple zones overlap, the highest priority wins (TopZone).</li>
</ul>
<h4>Zone Priority (Nested Zones)</h4>
<p>Each zone has a <span class="ci">ZonePriority</span>. If you are inside multiple zones at the same time, the Conductor picks the zone with the <strong style="color:var(--text-primary)">highest priority</strong> as the active <span class="ci">TopZone</span>. This makes nested or overlapping zones predictable: â€œthe most important room wins.â€</p>
<h4>Zone State Override vs Zone Extra Layers</h4>
<p>A zone can influence music in two independent ways:</p>
<ul class="ul">
<li><strong style="color:var(--text-primary)">ZoneState (Override):</strong> forces a specific state while inside. Example: â€œBossArena â†’ Combatâ€.</li>
<li><strong style="color:var(--text-primary)">ExtraLayers[] (Additive):</strong> adds layers while inside, without forcing a new state. Example: â€œWindyBridge â†’ FX layer ONâ€.</li>
</ul>
<p>If <span class="ci">ZoneState</span> is set to <span class="ci">NONE</span>, the zone does <em>not</em> force a state â€” it can still add extra layers (and optionally override the profile only when it is also forcing a state, depending on your Conductor rules).</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Simple Example</div>
<p><strong style="color:var(--text-primary)">Village Zone</strong> (Priority 0): ZoneState = Calm, ExtraLayers = []<br/>
<strong style="color:var(--text-primary)">Forest Zone</strong> (Priority 10): ZoneState = Explore, ExtraLayers = [Drums]<br/>
         When the player stands in the overlap region, Forest wins (higher priority) â†’ Explore plays, and Drums layer is enabled while inside.</p>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Why Zones Feel â€œSmartâ€</div>
<p>Zones do <strong style="color:var(--text-primary)">not</strong> fight your gameplay logic. They simply become the current <span class="ci">TopZone</span> (by priority) and contribute their rules (state override and/or extra layers) into the same arbitration pipeline as event layers and default layers.</p>
</div>
<div class="steps">
<div class="step">
<div class="step-num">1</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Place</strong> <span class="ci">BP_BST_MusicZone</span> in your level and scale it to cover your area (room, corridor, arena, etc.).</p>
</div>
</div>
<div class="step">
<div class="step-num">2</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Collision / Overlap:</strong> make sure the zoneâ€™s collision component generates overlaps with the player. Typical checklist:</p>
<ul class="ul">
<li><span class="ci">Generate Overlap Events</span> = true</li>
<li>Collision set to <strong style="color:var(--text-primary)">Overlap</strong> the channel your player uses (often Pawn)</li>
<li>If using custom collision channels, ensure your player capsule and the zone agree (Overlap â†” Overlap).</li>
</ul>
</div>
</div>
<div class="step">
<div class="step-num">3</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Set</strong> <span class="ci">ZonePriority</span>. Higher wins when zones overlap. A common pattern:</p>
<ul class="ul">
<li>Large â€œregionâ€ zones: priority 0â€“10</li>
<li>Small â€œroom / interior / specialâ€ zones inside them: priority 50â€“100+</li>
</ul>
</div>
</div>
<div class="step">
<div class="step-num">4</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Choose how the zone affects music:</strong></p>
<ul class="ul">
<li><strong style="color:var(--text-primary)">State override:</strong> set <span class="ci">ZoneState</span> to a real <span class="ci">E_BST_MusicState</span> value (e.g., Calm / Combat).</li>
<li><strong style="color:var(--text-primary)">Layer-only zone:</strong> set <span class="ci">ZoneState</span> = <span class="ci">NONE</span> and use <span class="ci">ExtraLayers</span> only.</li>
</ul>
</div>
</div>
<div class="step">
<div class="step-num">5</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Fill</strong> <span class="ci">ExtraLayers</span> with any layers you want active while inside the zone (Drums/Bass/Harmony/Melody/FX). These stack on top of the current state.</p>
</div>
</div>
<div class="step">
<div class="step-num">6</div>
<div class="step-content">
<p><strong style="color:var(--text-primary)">Optional extras:</strong></p>
<ul class="ul">
<li><span class="ci">OverrideProfile</span> â€” used only when the zone is also forcing a state (<span class="ci">ZoneState</span> â‰  <span class="ci">NONE</span>). This avoids unexpected restarts when the zone is layer-only.</li>
<li><span class="ci">bZoneTrackLock</span> â€” requests track lock while inside (event lock still has priority).</li>
<li><span class="ci">QuantizeZoneLayerChangesToBar</span> â€” if enabled, zone layer sets can snap to the next bar for musical timing.</li>
<li><span class="ci">AffectsOnlyLocalPlayer</span> â€” recommended for multiplayer so zones behave per-client.</li>
</ul>
</div>
</div>
</div>
<h4>How to Set Up a Zone (Step-by-Step)</h4><p>For deeper rules (profile override edge cases, zone quantization behavior, and zone/event arbitration), see <a class="anchor" href="#s8">Section 8</a> and <a class="anchor" href="#s9">Section 9</a>.</p>
</div>
<div id="s4-6">
<h3>4.6 Intensity System <span class="rbadge up" style="margin-left:0.5rem">ADVANCED</span></h3>
<p><strong style="color:var(--text-primary)">Intensity</strong> is an optional advanced feature: a continuous <span class="ci">0..1</span> value that can automatically enable â€œintensity-onlyâ€ layers based on rules. If youâ€™re new, you can skip Intensity and still get great results with <strong style="color:var(--text-primary)">States</strong>, <strong style="color:var(--text-primary)">Zones</strong>, and <strong style="color:var(--text-primary)">Event Layers</strong>.</p>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Full setup &amp; tuning (advanced)</div>
<p>For the complete workflow (rules, hysteresis, smoothing/ramp, and volume curves), see <a href="#s15-intensity">Section 14 â€” Intensity System (Advanced)</a>.</p>
</div>
<ul class="ul">
<li>You set intensity from gameplay via <span class="ci">BST_SetIntensity</span> (BFL node).</li>
<li>Intensity only affects layers that are enabled <em>by intensity rules</em> â€” it does <strong style="color:var(--text-primary)">not</strong> override Default / Zone / Event enabled layers.</li>
<li>If you donâ€™t call <span class="ci">BST_SetIntensity</span>, Intensity stays at its default and does nothing.</li>
</ul>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 5 â•â•â• -->
<section class="section visible" id="s5">
<h2><a class="anchor" href="#s5">#</a> 5. Creating &amp; Editing Music Profiles</h2>
<h3>5.1 Create a Custom Profile</h3>
<div class="steps">
<div class="step"><div class="step-num">1</div><div class="step-content"><p>In the Content Browser, duplicate <span class="ci">DA_BST_MusicProfile_Default</span>.</p></div></div>
<div class="step"><div class="step-num">2</div><div class="step-content"><p>Rename it â€” e.g. <span class="ci">DA_BST_MusicProfile_MyGame</span>.</p></div></div>
<div class="step"><div class="step-num">3</div><div class="step-content"><p>Open your new profile. For each state you want to support, add or edit a StateConfig entry.</p></div></div>
</div>
<h3>5.2 Fill a StateConfig (Playlist)</h3>
<p>In each StateConfig: set the State (<span class="ci">E_BST_MusicState</span>), add one or more TrackEntry items to the Tracks array, and provide accurate BPM and BeatsPerBar for each track.</p>
<h3>5.3 Fill a TrackEntry</h3>
<p>Each TrackEntry is the complete definition for one piece of music in a playlist.</p>
<div class="tw">
<table>
<thead><tr><th>Field</th><th>Type</th><th>Meaning</th></tr></thead>
<tbody>
<tr><td><span class="ci">BaseSound</span></td><td><span class="ci">SoundWave / SoundCue</span></td><td>Main full mix or main stem. Always required.</td></tr>
<tr><td><span class="ci">BPM</span></td><td><span class="ci">Float</span></td><td>Beats per minute. Drives the beat/bar clock and all quantization.</td></tr>
<tr><td><span class="ci">BeatsPerBar</span></td><td><span class="ci">Integer</span></td><td>Time signature in beats per bar (commonly 4).</td></tr>
<tr><td><span class="ci">Drums / Bass / Harmony / Melody / FX</span></td><td><span class="ci">F_BST_LayerDef</span></td><td>Optional stems for each layer. Leave empty if you don't have that stem.</td></tr>
</tbody>
</table>
</div>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Single WAV Use Case</div>
<p>If you only have a single WAV with no stems, set <span class="ci">BaseSound</span> only and leave all layer sounds empty. You can still use state switching and playlists. Layer add/remove calls are safely ignored when the current track has no matching stem.</p>
</div>
<h3 id="s5-layerdef">5.3.1 F_BST_LayerDef Fields (Per-Layer Configuration)</h3>
<p>Each layer slot (Drums, Bass, Harmony, Melody, FX) inside a TrackEntry uses the <span class="ci">F_BST_LayerDef</span> struct. Here are all configurable fields:</p>
<div class="tw">
<table>
<thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Meaning</th></tr></thead>
<tbody>
<tr><td><span class="ci">Sound</span></td><td><span class="ci">SoundWave / SoundCue</span></td><td>None</td><td>The audio asset for this stem. If empty, the layer is ignored for this track.</td></tr>
<tr><td><span class="ci">TargetVolume</span></td><td><span class="ci">Float</span></td><td>1.0</td><td>Volume when the layer is enabled (0.0 to 1.0). Use this to balance stems against each other.</td></tr>
<tr><td><span class="ci">FadeInDuration</span></td><td><span class="ci">Float</span></td><td>0.5</td><td>Seconds to fade in when the layer is enabled. Shorter = snappier, longer = smoother blend.</td></tr>
<tr><td><span class="ci">FadeOutDuration</span></td><td><span class="ci">Float</span></td><td>0.5</td><td>Seconds to fade out when the layer is disabled. Independent of FadeInDuration.</td></tr>
<tr><td><span class="ci">StandbyVolume</span></td><td><span class="ci">Float</span></td><td>0.0</td><td>Volume when the layer is muted but still playing in the background. Typically 0.0 (silent).</td></tr>
</tbody>
</table>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Layer Fades Are Per-Track, Per-Layer</div>
<p>Each layer in each track can have its own fade durations. For example, Drums can fade in over 0.2s (punchy) while Harmony fades in over 1.5s (smooth). This gives you precise control over how the mix evolves, without any Blueprint logic.</p>
</div>

<h3 id="s5-audio-prep">5.3.2 Audio Preparation Guide</h3>
<p>Before importing your music into Unreal, follow these guidelines to ensure BeatSyncToolkit works reliably.</p>
<h4>Supported Audio Formats</h4>
<div class="tw">
<table>
<thead><tr><th>Format</th><th>Recommended</th><th>Notes</th></tr></thead>
<tbody>
<tr><td><span class="ci">.wav</span></td><td><strong style="color:var(--green)">Yes</strong></td><td>Best quality, no compression artifacts. Preferred for all stems and base tracks.</td></tr>
<tr><td><span class="ci">.ogg</span></td><td>Acceptable</td><td>Smaller file size. Good for long ambient/exploration tracks where file size matters.</td></tr>
</tbody>
</table>
</div>
<h4>Stem Preparation Rules</h4>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Critical: All stems for the same track must be identical in length</div>
<p>BeatSyncToolkit starts all stems simultaneously and fades them in/out. If stems have different lengths, they will drift out of sync. Always export stems from the same session with the same start and end points.</p>
</div>
<ul>
<li><strong style="color:var(--text-primary)">Same BPM:</strong> All stems for one track must share the exact same BPM. The Conductor uses a single beat clock per track.</li>
<li><strong style="color:var(--text-primary)">Same length:</strong> Export all stems with identical start/end points. Pad shorter stems with silence if needed.</li>
<li><strong style="color:var(--text-primary)">Same sample rate:</strong> Use a consistent sample rate across all stems (44100 Hz or 48000 Hz recommended).</li>
<li><strong style="color:var(--text-primary)">Mono vs Stereo:</strong> Both work. Use stereo for full-mix base tracks and wide stems (pads, ambience). Mono is fine for punchy elements (kick, snare) if you want to save memory.</li>
<li><strong style="color:var(--text-primary)">No built-in fades:</strong> Do not add fade-in/fade-out to your stem files. BeatSyncToolkit handles all fading at runtime via LayerDef settings.</li>
<li><strong style="color:var(--text-primary)">Loop-ready:</strong> If you want seamless looping, make sure your audio starts and ends cleanly on a beat boundary. Avoid silence at the start or end of the file.</li>
</ul>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> DAW Export Tip</div>
<p>In your DAW (Ableton, FL Studio, Logic, Reaper, etc.), solo each stem group and "Export All" or "Bounce in Place" with the same range selection. This guarantees all files have identical length and timing.</p>
</div>
<h3>5.4 Assign Profile to the Conductor</h3>
<p>Select <span class="ci">BP_BST_Conductor</span> in your level. Set <span class="ci">ActiveProfile</span> to your custom profile asset. Set <span class="ci">AutoStartState</span> to the initial state. Press Play.</p>
<div id="s5-5">
<h3>5.5 Adding a New State</h3>
<p>You can extend BeatSyncToolkit with your own states. The system uses a loop-based lookup â€” no hardcoded switch-case â€” so adding a new enum entry won't break any existing Blueprint graphs or pins.</p>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Enum alone is not enough</div>
<p>Adding a new entry to <span class="ci">E_BST_MusicState</span> makes it appear in all BFL nodes immediately â€” but <strong style="color:var(--text-primary)">no music will play for that state</strong> until you also define a StateConfig with at least one track in your profile. The system won't crash â€” it simply won't switch, or will stay on the current track.</p>
</div>
<div class="steps">
<div class="step">
<div class="step-num">1</div>
<div class="step-content">
<h4>Add the new entry to the enum</h4>
<p>Open <span class="ci">E_BST_MusicState</span> and add your new state (e.g. <span class="ci">Stealth</span>). Save and compile. It will now appear as a selectable option in all BFL nodes across your project â€” automatically.</p>
</div>
</div>
<div class="step">
<div class="step-num">2</div>
<div class="step-content">
<h4>Open your Music Profile</h4>
<p>Open the profile Data Asset you're using (e.g. <span class="ci">DA_BST_MusicProfile_MyGame</span>).</p>
</div>
</div>
<div class="step">
<div class="step-num">3</div>
<div class="step-content">
<h4>Add a new StateConfig entry</h4>
<p>In the StateConfigs array, add a new row. Set its <span class="ci">State</span> to your new enum value (e.g. <span class="ci">Stealth</span>).</p>
</div>
</div>
<div class="step">
<div class="step-num">4</div>
<div class="step-content">
<h4>Add at least one TrackEntry</h4>
<p>Inside that StateConfig, add a TrackEntry to the Playlist array. At minimum, set <span class="ci">BaseSound</span>, <span class="ci">BPM</span>, and <span class="ci">BeatsPerBar</span>. Optionally add stem sounds (Drums/Bass/Harmony/Melody/FX) if your audio has them.</p>
</div>
</div>
<div class="step">
<div class="step-num">5</div>
<div class="step-content">
<h4>Save and test</h4>
<p>Save the profile. Press Play and call <span class="ci">BST_SetMusicState(Stealth)</span> â€” the Conductor will find the new StateConfig via lookup and switch to it.</p>
</div>
</div>
</div><h4>Files You Will Edit (State Extension)</h4>
<div class="files-grid">
<div class="file-pill">
<div class="file-pill-icon fp-enum">EN</div>
<div>
<div class="file-pill-text">E_BST_MusicState</div>
<div class="file-pill-label">Add the new enum entry</div>
</div>
</div>
<div class="file-pill">
<div class="file-pill-icon fp-da">DA</div>
<div>
<div class="file-pill-text">DA_BST_MusicProfile_*</div>
<div class="file-pill-label">Add a StateConfig row + playlist tracks</div>
</div>
</div>
<div class="file-pill">
<div class="file-pill-icon fp-struct">ST</div>
<div>
<div class="file-pill-text">F_BST_StateConfig</div>
<div class="file-pill-label">State + Playlist array</div>
</div>
</div>
<div class="file-pill">
<div class="file-pill-icon fp-struct">ST</div>
<div>
<div class="file-pill-text">F_BST_TrackEntry</div>
<div class="file-pill-label">BaseSound + BPM/BPB + optional stems</div>
</div>
</div>
<div class="file-pill">
<div class="file-pill-icon fp-bp">BP</div>
<div>
<div class="file-pill-text">BP_BST_MusicZone (optional)</div>
<div class="file-pill-label">Use the new state in ZoneState overrides</div>
</div>
</div>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Where Your New State Will Show Up Automatically</div>
<ul class="ul">
<li>All <span class="ci">BFL_BST</span> state nodes (dropdowns update automatically after compile).</li>
<li><span class="ci">BP_BST_MusicZone.ZoneState</span> dropdown.</li>
<li>Conductor settings such as <span class="ci">AutoStartState</span> (if you use it).</li>
</ul>
<p>If your new state is selectable but nothing changes, 99% of the time the profile is missing a matching <span class="ci">StateConfig</span> entry (or its playlist has no tracks).</p>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Why this works without breaking things</div>
<p>The Conductor resolves states by searching through the StateConfig array at runtime â€” not via a switch-case baked into the Blueprint graph. This means adding a new <span class="ci">E_BST_MusicState</span> entry won't cause any pin breaks or compilation errors anywhere. The only requirement is a matching StateConfig in your active profile.</p>
</div>
</div>
<div id="s5-6">
<h3>5.6 Adding a Custom Layer</h3>
<p>The five built-in layers (<span class="ci">Drums</span>, <span class="ci">Bass</span>, <span class="ci">Harmony</span>, <span class="ci">Melody</span>, <span class="ci">FX</span>) cover most games. If you truly need a sixth stem layer â€” for example <span class="ci">Percussion</span> â€” you <em>can</em> extend BeatSyncToolkit.</p>

<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Optional / Advanced</div>
<p>This is an advanced extension. You are adding a new audio channel, a new stem slot in track data, and wiring it into the Conductorâ€™s layer pipeline (prepare â†’ gating â†’ enable/arbitration â†’ fade routing). If you only want more variety, prefer <strong style="color:var(--text-primary)">States</strong>, <strong style="color:var(--text-primary)">Zones</strong>, and <strong style="color:var(--text-primary)">State Requests</strong> instead of inventing new layers.</p>
</div>

<h4>What stays the same</h4>
<ul class="ul">
<li><strong style="color:var(--text-primary)">BFL nodes</strong> automatically show the new enum entry in dropdowns (no BFL edits needed).</li>
<li><strong style="color:var(--text-primary)">Zone ExtraLayers</strong> and <strong style="color:var(--text-primary)">Event layers</strong> already use <span class="ci">E_BST_MusicLayer</span> arrays â€” your new layer can be requested immediately.</li>
<li>The core rule is unchanged: stems start playing in standby (muted), and layer toggles only change volume (no restart).</li>
</ul>

<h4>Step-by-step (recommended order)</h4>
<div class="steps">
  <div class="step">
    <div class="step-num">1</div>
    <div class="step-content">
      <h4>Extend the Layer Enum</h4>
      <p>Open <span class="ci">E_BST_MusicLayer</span> and add your new entry (example: <span class="ci">Percussion</span>). Save + compile. It will now appear in all layer dropdowns automatically.</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">2</div>
    <div class="step-content">
      <h4>Add a Stem Slot to Track Data</h4>
      <p>Open <span class="ci">F_BST_TrackEntry</span> and add a new field for your layer using the same type as other stems (recommended: <span class="ci">F_BST_LayerDef</span>).</p>
      <p><strong style="color:var(--text-primary)">Example:</strong> add a field named <span class="ci">Percussion</span> (type <span class="ci">F_BST_LayerDef</span>), so each TrackEntry can optionally provide a stem Sound + Target Volume.</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">3</div>
    <div class="step-content">
      <h4>Add a Dedicated AudioComponent</h4>
      <p>In <span class="ci">BP_BST_Conductor</span>, add a new AudioComponent for the layer (example: <span class="ci">AC_Percussion</span>). Configure it the same way as existing layer components (<span class="ci">AC_Drums</span>, <span class="ci">AC_Bass</span>, etc.).</p>
      <p>This component is the playback channel for the new stem.</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">4</div>
    <div class="step-content">
      <h4>Prepare the Stem on Track Start</h4>
      <p>Open <span class="ci">BST_EnsureLayerComponentsPlayingMuted</span> and add a block for your new layer:</p>
      <ul class="ul">
        <li>If the current track has a valid stem Sound for the layer â†’ <strong style="color:var(--text-primary)">SetSound (if changed)</strong>, <strong style="color:var(--text-primary)">Play</strong>, then set volume to <span class="ci">StandbyVolume</span> (very low).</li>
        <li>If the current track has <em>no</em> stem for the layer â†’ fade out to standby and only stop after a short delay (use <span class="ci">BST_FadeOutAndStopLayerComponent</span> pattern).</li>
      </ul>
      <div class="callout note">
        <div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Why this matters</div>
        <p>BeatSyncToolkitâ€™s core promise is: stems do not restart when you toggle layers â€” we only fade volumes. Preparing all available stems in standby on track start is what makes that possible.</p>
      </div>
    </div>
  </div>

  <div class="step">
    <div class="step-num">5</div>
    <div class="step-content">
      <h4>Gate by Stem Availability</h4>
      <p>Open <span class="ci">BST_CurrentTrackHasLayerSound</span> and add a new case for your layer that returns whether the current track actually contains a stem Sound for it.</p>
      <p>This prevents the system from ever trying to enable a layer that does not exist in the current track.</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">6</div>
    <div class="step-content">
      <h4>Include the Layer in Enable/Arbitration</h4>
      <p>Update the layer enable logic so your new layer follows the same rules as built-ins:</p>
      <p><strong style="color:var(--text-primary)">Enabled = (Default AND NOT Suppressed) OR Zone OR Event</strong>, gated by <span class="ci">BST_CurrentTrackHasLayerSound</span>.</p>
      <p>If your build uses helper functions, extend them:</p>
      <ul class="ul">
        <li><span class="ci">BST_ShouldEnableLayerNow</span> â€” add your enum case.</li>
        <li><span class="ci">BST_GetLayerTargetVolumeNow</span> â€” return the correct target volume for the layer (from your new <span class="ci">F_BST_LayerDef</span> field).</li>
      </ul>
      <p>If you donâ€™t have those helpers, the same logic lives directly inside <span class="ci">BST_ApplyEventLayersNow</span> â€” extend the corresponding block there.</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">7</div>
    <div class="step-content">
      <h4>Fade Routing (Apply)</h4>
      <p>In <span class="ci">BST_ApplyEventLayersNow</span>, add a new block that routes <strong style="color:var(--text-primary)">ShouldEnable</strong> to your new AudioComponent:</p>
      <ul class="ul">
        <li>If enabled â†’ <span class="ci">AdjustVolume(FadeSeconds, TargetVolume)</span></li>
        <li>If not enabled â†’ <span class="ci">AdjustVolume(FadeSeconds, StandbyVolume)</span></li>
      </ul>
      <p>Do not hard-stop stems here (except when the current track has no stem for that layer, handled via the â€œfade out and stopâ€ helper).</p>
    </div>
  </div>

  <div class="step">
    <div class="step-num">8</div>
    <div class="step-content">
      <h4>Default Layers & (Optional) Intensity</h4>
      <p>Because default layers and suppression work from enum lists, your new layer is supported automatically â€” <em>as long as</em> the Conductor includes it in the â€œall layersâ€ paths:</p>
      <ul class="ul">
        <li>Update <span class="ci">BST_RecomputeDefaultLayersForCurrentTrack</span> so <span class="ci">AllAvailable</span> can include the new layer.</li>
        <li>If you use <strong style="color:var(--text-primary)">Intensity</strong>, you may also need to update any layer-bitmask helpers (example: <span class="ci">BST_LayerToBit</span>) and intensity rule evaluation so the new layer can be intensity-driven.</li>
      </ul>
    </div>
  </div>
</div>

<h4>Finally: Fill the stem in your Profile</h4>
<p>Open your <span class="ci">DA_BST_MusicProfile_*</span> asset. For every TrackEntry that should support the new layer, fill in your new <span class="ci">F_BST_LayerDef</span> field (Sound + Target Volume). Tracks where you leave it empty will safely ignore the layer â€” no errors.</p>

<h4>Files You Will Edit (Advanced)</h4>
<table class="table">
<thead><tr><th>Type</th><th>Name</th><th>Why</th></tr></thead>
<tbody>
<tr><td>EN</td><td><span class="ci">E_BST_MusicLayer</span></td><td>Add the enum entry.</td></tr>
<tr><td>ST</td><td><span class="ci">F_BST_TrackEntry</span></td><td>Add the new <span class="ci">F_BST_LayerDef</span> field.</td></tr>
<tr><td>BP</td><td><span class="ci">BP_BST_Conductor</span></td><td>Add the new AudioComponent.</td></tr>
<tr><td>FN</td><td><span class="ci">BST_EnsureLayerComponentsPlayingMuted</span></td><td>Prepare the stem in standby on track start.</td></tr>
<tr><td>FN</td><td><span class="ci">BST_CurrentTrackHasLayerSound</span></td><td>Gate enable by stem availability.</td></tr>
<tr><td>FN</td><td><span class="ci">BST_ApplyEventLayersNow</span></td><td>Fade routing for the new AudioComponent.</td></tr>
<tr><td>FN</td><td><span class="ci">BST_RecomputeDefaultLayersForCurrentTrack</span></td><td>So your layer can be default-enabled (AllAvailable).</td></tr>
<tr><td>DA</td><td><span class="ci">DA_BST_MusicProfile_*</span></td><td>Fill the new stem Sound + Volume per track.</td></tr>
</tbody>
</table>

<p><strong style="color:var(--text-primary)">Why fixed layers by default</strong><br/>
Fixed layers give the best balance of low-friction setup, clean UX (simple nodes), reliable runtime behavior (consistent fades and quantization), and no audio-designer dependency for common cases. Custom layers are supported â€” but for most games, the five built-in layers are enough.</p>
</div>
<div id="s5-7">
<h3>5.7 Advanced: Default Layer Control (Auto-Start on Track Begin)</h3>
<p>By default, BeatSyncToolkit starts all available stems muted (StandbyVolume) and only enables layers when you request them via Events or Zones. <strong style="color:var(--text-primary)">Default Layer Control</strong> adds an optional third source: the track can auto-enable specific layers as soon as the track begins.</p>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Advanced Feature</div>
<p>If you do not need â€œauto-on layersâ€ per track, you can ignore this entire section. The toolkit works perfectly with Event Layers + Zone Layers only.</p>
</div>
<h4>What Problem This Solves</h4>
<p>Sometimes you want a track to start with a specific mix automatically, without calling AddLayer in gameplay. Examples:</p>
<ul class="ul">
<li>Track A starts with <span class="ci">Drums</span> already ON.</li>
<li>Track B starts fully muted (no layers ON).</li>
<li>Track C starts with <span class="ci">Drums + FX</span> ON, but only if those stems exist in that track.</li>
</ul>
<h4>Where You Configure It</h4>
<p>Default layers are configured <strong style="color:var(--text-primary)">per TrackEntry</strong> so each track in the same state playlist can behave differently. In <span class="ci">F_BST_TrackEntry</span>, you add:</p>
<ul class="ul">
<li><span class="ci">TrackDefaultMode</span> (enum): <span class="ci">InheritFromConductor</span>, <span class="ci">MutedOnly</span>, <span class="ci">AllAvailable</span>, <span class="ci">CustomList</span></li>
<li><span class="ci">TrackDefaultLayers</span> (array of <span class="ci">E_BST_MusicLayer</span>) used when mode is <span class="ci">CustomList</span></li>
</ul>
<h4>How the Modes Work</h4>
<div class="tw">
<table>
<thead><tr><th>Mode</th><th>Meaning</th><th>When to Use</th></tr></thead>
<tbody>
<tr>
<td><span class="ci">InheritFromConductor</span></td>
<td>Use the Conductorâ€™s global default-start setting (if you have one). If you donâ€™t use a global setting, treat this like <span class="ci">MutedOnly</span>.</td>
<td>Keep one consistent default across many tracks, while still allowing per-track override when needed.</td>
</tr>
<tr>
<td><span class="ci">MutedOnly</span></td>
<td>Start with no default layers enabled. All stems still <em>play muted</em> at standby volume.</td>
<td>Clean â€œsilent layers by defaultâ€ behavior. Gameplay/Zone decides everything.</td>
</tr>
<tr>
<td><span class="ci">AllAvailable</span></td>
<td>Enable every layer that exists in the current track (Drums/Bass/Harmony/Melody/FX, gated by stem validity).</td>
<td>Tracks that should start â€œfully stackedâ€ without extra gameplay calls.</td>
</tr>
<tr>
<td><span class="ci">CustomList</span></td>
<td>Enable only the layers in <span class="ci">TrackDefaultLayers</span> (also gated by stem validity).</td>
<td>Per-track curated starting mix (e.g., Drums+FX only).</td>
</tr>
</tbody>
</table>
</div>
<h4>Runtime: Recompute Before Applying Layers</h4>
<p>On every track start (state switch, StartMusic, playlist auto-advance, and â€œrestart same track while lockedâ€), the Conductor recomputes which default layers are active for <em>that</em> track using:</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BP_BST_Conductor</span></div>
<pre><span class="fn">BST_RecomputeDefaultLayersForCurrentTrack</span>()</pre>
</div>
<p>This function sets <span class="ci">ActiveDefaultLayers</span> for the current track, based on <span class="ci">TrackDefaultMode</span> and <span class="ci">TrackDefaultLayers</span>, and gates every choice through <span class="ci">BST_CurrentTrackHasLayerSound</span> so missing stems are never armed.</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Why This Must Run Before ApplyEventLayersNow</div>
<p><span class="ci">BST_ApplyEventLayersNow</span> is where volumes actually fade up/down. It needs the current <span class="ci">ActiveDefaultLayers</span> to be ready first. The recommended order on track start is:</p>
<p><span class="ci">EnsureLayerComponentsPlayingMuted</span> â†’ <span class="ci">BST_RecomputeDefaultLayersForCurrentTrack</span> â†’ <span class="ci">BST_ApplyEventLayersNow</span></p>
</div>
<h4>How Default Layers Interact with Zone / Event Layers</h4>
<p>Layers are enabled by <strong style="color:var(--text-primary)">OR logic</strong> across sources. Default layers cannot â€œturn offâ€ zone or event layers. The effective rule is:</p>
<div class="callout formula">
<div class="callout-title">Layer Enable Formula</div>
<p><span class="ci">Enabled</span> = <span class="ci">Zone</span> OR <span class="ci">Event</span> OR (<span class="ci">Default</span> AND NOT <span class="ci">SuppressedDefault</span>)</p>
</div>
<h4>Suppressing Default Layers with Remove / Clear</h4>
<p>You requested a special behavior: if the player removes a default-enabled layer during the current track, that layer should stop coming back from <span class="ci">Default</span> until the track restarts/changes.</p>
<p>This is handled with <span class="ci">SuppressedDefaultLayers</span>:</p>
<ul class="ul">
<li><span class="ci">BST_RemoveLayer</span>: removes from Event Layers, and if the layer is in <span class="ci">ActiveDefaultLayers</span>, it also adds it into <span class="ci">SuppressedDefaultLayers</span>.</li>
<li><span class="ci">BST_ClearLayers</span>: clears Event Layers, and sets <span class="ci">SuppressedDefaultLayers</span> to the current <span class="ci">ActiveDefaultLayers</span> (muting all defaults for the remainder of the track).</li>
<li><span class="ci">BST_AddLayer(s)</span> does <strong style="color:var(--text-primary)">not</strong> remove suppression â€” it enables via Event. Suppression resets only on track start.</li>
</ul>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Your Intended Gameplay Workflow</div>
<p>Default layers define the â€œstarting mixâ€. If you want to change the mix at runtime, you use Event Layers:<br/>
      â€¢ To disable a default layer for this track: call <span class="ci">BST_RemoveLayer</span> or <span class="ci">BST_ClearLayers</span><br/>
      â€¢ To enable it again: call <span class="ci">BST_AddLayer</span> / <span class="ci">BST_AddLayers</span><br/>
      â€¢ To reset defaults: restart/switch track (state switch, playlist advance, restart locked track)</p>
</div>
</div>
<div id="s5-8">
<h3>5.8 Intensity Overrides</h3><p>Intensity is an optional advanced system. You can safely skip it if you only want beat-synced state changes, zones, layers, and requests. If you do use Intensity, TrackEntries can optionally override which intensity rules/profile are active while that track is playing.</p><div class="callout info"><div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Where to learn it</div><p>See Section 14.2 â€œIntensity System (Advanced)â€ for the full setup, rules, smoothing, hysteresis, and overrides.</p></div>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 6 â•â•â• -->
<section class="section visible" id="s6">
<h2><a class="anchor" href="#s6">#</a> 6. Gameplay API (BFL_BST)</h2>
<p><span class="ci">BFL_BST</span> is the only thing your gameplay Blueprints need to call. It finds <span class="ci">BP_BST_Conductor</span> in the current world and forwards the request internally.</p><h3>State Requests (Priority Overrides)</h3>
<p><b>State Requests</b> are built for temporary, event-driven overrides (AI combat, boss phases, cutscenes, scripted moments) where you want the music to automatically revert when the event ends.</p>
<ul>
<li><b>Push</b> a request when the event starts.</li>
<li><b>Remove</b> the same request when the event ends.</li>
<li>If multiple requests are active, <b>higher Priority wins</b> (requests only compete with other requests).</li>
<li><b>Tip:</b> If you have many instances (multiple AI, repeated triggers), use <b>scoped</b> request keys so each instance cannot overwrite another.</li>
<li><b>Requests override the global baseline.</b> If any State Request is active, the winning request (highest Priority) overrides <span class="ci">GlobalRequestedState</span>.</li>
<li><b>Zones win by default.</b> If you are inside a TopZone that is forcing a state (<span class="ci">TopZone.ZoneState</span> is not NONE), the zone keeps control unless the winning request is pushed with <span class="ci">ForceWhileInZone = true</span>.</li>
<li><b>When requests end, the system falls back automatically.</b> After the last request is removed, the Conductor returns to the zoneâ€™s state (if still inside a forced zone), otherwise to <span class="ci">GlobalRequestedState</span>.</li><li><b>Note:</b> <span class="ci">BST_SetMusicState</span> updates <span class="ci">GlobalRequestedState</span> but does <em>not</em> cancel active requests.</li>
<li><span class="ci">BST_ClearRequests</span> clears every active request at once (useful for respawn, level reset, cutscene skip).</li>
</ul>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> State + Profile are resolved together</div>
<p><span class="ci">ProfileInUse</span> is resolved together with the effective desired state. The zoneâ€™s <span class="ci">OverrideProfile</span> is used only when the zone is actually providing the desired state (<span class="ci">TopZone.ZoneState</span>). If the desired state comes from a <span class="ci">State Request</span> or from <span class="ci">GlobalRequestedState</span>, then <span class="ci">ProfileInUse = ActiveProfile</span>. This prevents â€œstate not foundâ€ issues when a zone override profile does not contain a requested state.</p>
</div>
<h4>Normal Requests vs Scoped Requests</h4>
<p>Every state request is stored under a key called <span class="ci">RequestId</span>. If two systems use the same key, they are editing the <em>same</em> request.</p>
<ul>
<li><b>Normal request</b> â†’ You pick a globally-unique <span class="ci">RequestId</span> (good for singletons like cutscenes, boss phases, scripted moments).</li>
<li><b>Scoped request</b> â†’ The key is built from <span class="ci">ScopeKey + RequestName</span> (good when the same Blueprint can exist many times, like AI enemies or repeated triggers).</li>
</ul>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Why scoped requests matter (multi-AI / multi-instance safety)</div>
<p>If you spawn 5 enemies of the same AI Blueprint and they all push <span class="ci">"AI_Combat"</span>, they will fight over one request. The last one overwrites the others, and removing it can end combat music too early. Scoped requests avoid this by giving each instance its own unique request slot.</p>
</div>
<h4>How to use scoped requests</h4>
<ul>
<li><b>Recommended (if available in your build):</b> Use the request nodes that include a <span class="ci">Scope</span>/<span class="ci">ScopeKey</span> input. Plug <span class="ci">Self</span> for per-actor scope, and keep your request name short (e.g., <span class="ci">Combat</span>).</li>
<li><b>Fallback (works in any build):</b> Manually build a unique <span class="ci">RequestId</span> by combining a scope value (like the AI actor name) with a short request name (e.g., <span class="ci">Enemy_12_Combat</span>). Push and remove using the exact same string.</li>
</ul>
<h4>Example A2 â€” Multiple AI (Scoped)</h4>
<pre><span class="cmt">// Per AI instance (preferred):</span>
BST_PushStateRequest(Scoped(Self, "Combat"), Danger, 20, false, true)

<span class="cmt">// When that same AI ends the situation:</span>
BST_RemoveStateRequest(Scoped(Self, "Combat"), true)</pre>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Many enemies (100+)? Consider a manager.</div>
<p>For very large crowds, you may prefer a small â€œCombat Music Managerâ€ that keeps a counter (how many enemies are actively in combat) and pushes a single request while the counter &gt; 0. This avoids storing one request per enemy, but both approaches are valid.</p>
</div>
<h4>Example A â€” AI Combat (Auto-Revert)</h4>
<pre><span class="cmt">// When AI spots the player:</span>
BST_PushStateRequest("AI_Combat", Danger, 20, false, true)

<span class="cmt">// When AI loses the player:</span>
BST_RemoveStateRequest("AI_Combat", true)</pre>
<h4>Example B â€” Cutscene (Can Override Forced Zones)</h4>
<pre><span class="cmt">// Cutscene start (override forced zones by using ForceWhileInZone=true):</span>
BST_PushStateRequest("Cutscene", Cinematic, 100, true, true)

<span class="cmt">// Cutscene end:</span>
BST_RemoveStateRequest("Cutscene", true)</pre>
<p><b>Tip:</b> If you have multiple temporary systems and want to â€œreturn to normalâ€ quickly, call <span class="ci">BST_ClearRequests</span> instead of tracking every <span class="ci">RequestId</span>.</p>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Multiplayer / Replication Notes (Important)</div>
<p><strong style="color:var(--text-primary)">BeatSyncToolkit is client-side audio.</strong> In multiplayer, each client plays its own music locally. This means:</p>
<ul class="ul">
<li>If you call <span class="ci">BFL_BST</span> nodes <strong style="color:var(--text-primary)">only on the server</strong>, clients will not hear changes. Call the nodes on each client.</li>
<li>On a <strong style="color:var(--text-primary)">dedicated server</strong>, you usually do not need the Conductor at all (no audio). Place/run it on clients.</li>
<li>Recommended pattern: replicate a small â€œmusic intentâ€ (State, EventLayers, TrackLock) via <span class="ci">GameState</span> or a replicated manager, then in <span class="ci">OnRep</span> call the matching <span class="ci">BFL_BST</span> nodes locally.</li>
<li>Zones are evaluated per client. Use <span class="ci">AffectsOnlyLocalPlayer</span> on zones to avoid cross-player overlap edge cases.</li>
</ul>
<p>This toolkit does <strong style="color:var(--text-primary)">not</strong> force any networking architecture â€” it simply gives you clean local playback and a tiny gameplay API.</p>
</div>
<div class="callout note" style="margin-top:14px">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> QuantizeToNextBar (per-call)</div>
<p>When a node includes <span class="ci">QuantizeToNextBar</span>:
      <strong>true</strong> queues the change and applies it on the next bar;
      <strong>false</strong> applies immediately using fades.
      Use quantized calls for tight musical timing; use immediate calls for reactive gameplay.</p>
</div>
<div class="tw">
<table>
<thead><tr><th>Node</th><th>Description</th></tr></thead>
<tbody>
<tr><td><span class="ci">BST_GetConductor</span></td><td>Finds the placed <span class="ci">BP_BST_Conductor</span> in the current world. Returns <span class="ci">Found=false</span> if missing.</td></tr>
<tr><td><span class="ci">BST_StartMusic</span></td><td>Starts music playback. Use this when <span class="ci">bStartOnBeginPlay</span> is disabled â€” the demo-friendly "start silent" mode.</td></tr>
<tr><td><span class="ci">BST_StopMusic</span></td><td>Fades out and stops all music, stops the beat clock, resets runtime state. Safe to call anytime.</td></tr>
<tr><td><span class="ci">BST_SetMusicState</span></td><td>Sets the <b>Global Requested State</b> (your baseline). Zones and State Requests can still override it. Use this for long-lived gameplay modes (Exploration / Combat / Boss, etc.). For short-lived overrides, prefer <span class="ci">BST_PushStateRequest</span> + <span class="ci">BST_RemoveStateRequest</span>.</td></tr>
<tr><td><span class="ci">BST_PushStateRequest</span></td><td>Pushes a temporary state request (RequestId + Priority). Highest Priority wins (between requests). By default it overrides the global baseline; to override a <em>forced</em> zone state, push with <span class="ci">ForceWhileInZone = true</span>.</td></tr>
<tr><td><span class="ci">BST_RemoveStateRequest</span></td><td>Removes a previously pushed request by <span class="ci">RequestId</span>. After removal, the system falls back to the next winner (zone / another request / global state). Can be quantized to the next bar.</td></tr>
<tr><td><span class="ci">BST_ClearRequests</span></td><td>Clears <b>all</b> active state requests at once. Useful when you donâ€™t track IDs (respawn, level reset, cutscene skip). Can be quantized to the next bar.</td></tr>
<tr><td><span class="ci">BST_SetIntensity</span></td><td>Sets gameplay Intensity (0..1). Intensity auto-enables layers based on rules. Supports optional per-call <span class="ci">QuantizeToNextBar</span> and a per-call smooth/instant override (so quantized intensity also applies with the intended feel).</td></tr>
<tr><td><span class="ci">BST_GetCurrentIntensity01</span></td><td>Returns the Conductor's current applied intensity (after smoothing/ramp). Useful for UI/debug.</td></tr>
<tr><td><span class="ci">BST_IsIntensityRamping</span></td><td>True while the ramp timer is actively updating <span class="ci">CurrentIntensity01</span>.</td></tr>
<tr><td><span class="ci">BST_GetActiveIntensityLayers</span></td><td>Returns the layers currently enabled by Intensity rules (debug/readback).</td></tr>
<tr><td><span class="ci">BST_AddLayer</span></td><td>Adds a single event layer (fade in). Enable <span class="ci">QuantizeToNextBar</span> to apply on the next bar.</td></tr>
<tr><td><span class="ci">BST_AddLayers</span></td><td>Adds multiple event layers in one call (array input). Use Make Array to supply 2/3/all layers.</td></tr>
<tr><td><span class="ci">BST_RemoveLayer</span></td><td>Removes a single event layer (fade out). If the same layer is required by the active zone, it remains enabled.</td></tr>
<tr><td><span class="ci">BST_ClearLayers</span></td><td>Clears all event layers. Zone layers remain active and unaffected.</td></tr>
<tr><td><span class="ci">BST_LockCurrentTrack</span></td><td>Locks the currently playing track â€” prevents auto-advance, restarts the same track on finish.</td></tr>
<tr><td><span class="ci">BST_UnlockCurrentTrack</span></td><td>Releases the lock so the playlist can auto-advance again.</td></tr>
</tbody>
</table>
</div>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Important Behavior Notes</div>
<p><strong style="color:var(--text-primary)">No manual references needed</strong> â€” <span class="ci">WorldContextObject</span> is sufficient. If no Conductor exists in the level, all nodes do nothing (<span class="ci">Found=false</span>). Layer nodes operate on Event Layers (<span class="ci">ActiveEventLayers</span>). Zone Layers are managed separately by zones and are <em>not</em> cleared by <span class="ci">BST_ClearLayers</span>.</p>
</div>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> WorldContextObject â€” Connect to Self</div>
<p>Every <span class="ci">BFL_BST</span> node has a <span class="ci">WorldContextObject</span> input. This input <strong style="color:var(--text-primary)">must</strong> be connected â€” otherwise <span class="ci">BST_GetConductor</span> (which runs internally on every call) cannot locate the world and returns <span class="ci">Found=false</span>. The call silently does nothing.</p>
</div>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Â· Correct Wiring</span></div>
<pre><span class="cmt">â† Inside any Blueprint (Actor, Widget, GameMode, etc.)</span>

<span class="fn">BST_SetMusicState</span>(
    WorldContextObject: <span class="val">self</span>         <span class="cmt">â† drag "self" node here</span>
    NewState:           <span class="val">Combat</span>
)

<span class="cmt">â† "self" gives the node a valid World reference.</span>
<span class="cmt">   BST_GetConductor uses it to find BP_BST_Conductor in that world.</span></pre>
</div>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Â· Common Mistake</span></div>
<pre><span class="fn">BST_SetMusicState</span>(
    WorldContextObject: <span class="cmt">â† left empty / not connected</span>
    NewState:           <span class="val">Combat</span>
)

<span class="cmt">â† WorldContextObject is null.</span>
<span class="cmt">   BST_GetConductor returns Found=false.</span>
<span class="cmt">   Nothing happens. No error, no crash â€” silent fail.</span></pre>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 7 â•â•â• -->
<section class="section visible" id="s7">
<h2><a class="anchor" href="#s7">#</a> 7. Conductor Settings &amp; Variables</h2>
<p>These are the main user-facing variables shown in the Conductor's Details panel.</p>
<div class="tw">
<table>
<thead><tr><th>Variable</th><th>Meaning</th></tr></thead>
<tbody>
<tr><td><span class="ci">ActiveProfile</span></td><td>Profile asset used to resolve StateConfigs. Zones may temporarily override this via OverrideProfile.</td></tr>
<tr><td><span class="ci">AutoStartState</span></td><td>State to begin automatically when the level starts.</td></tr>
<tr><td><span class="ci">StateChangeFadeDuration</span></td><td>Crossfade duration when switching states or tracks.</td></tr>
<tr><td><span class="ci">bQuantizeStateChangesToBar</span></td><td>If true, state change requests are held and applied on the next bar.</td></tr>
<tr><td><span class="ci">bStartOnBeginPlay</span></td><td>If true, music starts automatically on BeginPlay. If false, the level starts silent until <span class="ci">BST_StartMusic</span> is called.</td></tr>
<tr><td><span class="ci">BaseVolume</span></td><td>Master volume multiplier for the base mix.</td></tr>
<tr><td><span class="ci">bAutoAdvancePlaylist</span></td><td>If true, the Conductor advances to the next track in the playlist when the active base finishes.</td></tr>
<tr><td><span class="ci">bLoopIfSingleTrack</span></td><td>If true and the playlist has only 1 track, restart it when it finishes.</td></tr>
<tr><td><span class="ci">bQuantizeZoneLayerChangesToBar</span></td><td>If true, zone layer set updates are queued and applied on the next bar.</td></tr>
<tr><td><span class="ci">DefaultIntensityProfile</span></td><td>Default Intensity Rules asset used when profiles are set to <span class="ci">UseConductorDefault</span> (or when no override is provided). <span class="cmt">(aka <span class="ci">DefaultIntensityRules</span> in older builds)</span></td></tr>
<tr><td><span class="ci">bUseIntensityHysteresis</span></td><td>If true, rules use a separate close threshold (OpenThreshold âˆ’ HysteresisDelta) to prevent flicker around boundaries.</td></tr>
<tr><td><span class="ci">DefaultIntensityHysteresisDelta</span></td><td>How far below OpenThreshold a layer must fall before it turns off (when hysteresis is enabled).</td></tr>
<tr><td><span class="ci">bSmoothIntensity</span></td><td>If true, the Conductor ramps <span class="ci">CurrentIntensity01</span> toward <span class="ci">TargetIntensity01</span> over time.</td></tr>
<tr><td><span class="ci">IntensitySmoothingSeconds</span></td><td>Approximate time to reach the target intensity (lower = snappier, higher = smoother).</td></tr>
<tr><td><span class="ci">IntensityRampUpdateInterval</span></td><td>How often the ramp tick runs (smaller = smoother, larger = cheaper).</td></tr>
<tr><td><span class="ci">MinCurveReapplyDelta</span></td><td>Min-change gate for V2.2: prevents re-applying intensity layers on tiny value changes during ramping. <span class="cmt">(aka <span class="ci">IntensityMinDeltaToReapply</span>)</span></td></tr>
<tr><td><span class="ci">bDebugPrint / bDebugZones / bDebugProfiles</span></td><td>Prints debug info to the console for troubleshooting.</td></tr>
</tbody>
</table>
</div>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Understanding Fade Durations</div>
<p>There are two separate fade systems in BeatSyncToolkit: (1) <span class="ci">StateChangeFadeDuration</span> controls the base track crossfade when switching states or tracks (set on the Conductor), and (2) <span class="ci">FadeInDuration</span> / <span class="ci">FadeOutDuration</span> control individual layer fades (set per-layer in each <span class="ci">F_BST_LayerDef</span> inside the TrackEntry). These are independent, so you can have a long 2-second state crossfade with snappy 0.1-second drum layer fades, or vice versa.</p>
</div>
<h3>Runtime Variables (FYI)</h3>
<p>At runtime the Conductor maintains <span class="ci">CurrentState</span>, <span class="ci">CurrentTrack</span>, beat clock values (BPM / BeatsPerBar / CurrentBeat), pending requests (PendingState, pending layer ops, pending zone layers), zone tracking (ActiveZones, TopZone, ActiveZoneLayers), and track lock flags (<span class="ci">bEventTrackLock</span>, <span class="ci">bZoneTrackLock</span>, <span class="ci">bTrackLockActive</span>).</p>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 8 â•â•â• -->
<section class="section visible" id="s8">
<h2><a class="anchor" href="#s8">#</a> 8. Zone System <span class="rbadge lt" style="margin-left:auto">INTERMEDIATE</span></h2>
<p>Zones are overlap-based. When the player enters or exits zones, the Conductor maintains an <span class="ci">ActiveZones</span> array and selects the TopZone by highest <span class="ci">ZonePriority</span>. Only the TopZone's settings are applied at any time.</p>
<h3>8.1 Zone Properties</h3>
<div class="tw">
<table>
<thead><tr><th>Property</th><th>Meaning</th></tr></thead>
<tbody>
<tr><td><span class="ci">ZonePriority</span></td><td>Higher value wins when multiple zones overlap.</td></tr>
<tr><td><span class="ci">ZoneState</span></td><td>If not NONE, becomes the effective desired state while inside the TopZone (zone wins by default; can be overridden only by a forced State Request).</td></tr>
<tr><td><span class="ci">ExtraLayers</span></td><td>Array of <span class="ci">E_BST_MusicLayer</span> to add while inside the zone.</td></tr>
<tr><td><span class="ci">OverrideProfile</span></td><td>Optional: use a different profile when this zone is TopZone <em>and</em> the zone is actually providing the desired state (<span class="ci">ZoneState</span> is not NONE and wins the resolver). If a forced State Request overrides the zone, the Conductor stays on <span class="ci">ActiveProfile</span>.</td></tr>
<tr><td><span class="ci">bZoneTrackLock</span></td><td>Request Track Lock while inside this zone. Lower priority than Event Track Lock.</td></tr>
<tr><td><span class="ci">State Quantize Override</span></td><td>Optional tri-state override for <em>state change</em> quantization while this zone is TopZone (<span class="ci">Inherit</span> / <span class="ci">Force On</span> / <span class="ci">Force Off</span>). If forced ON/OFF, it overrides the Conductor default at runtime.</td></tr>
<tr><td><span class="ci">QuantizeZoneLayerChangesToBar</span></td><td>Toggle that drives the Conductor's zone-layer quantization behavior when this zone becomes TopZone.</td></tr>
<tr><td><span class="ci">AffectsOnlyLocalPlayer</span></td><td>If enabled, the zone only reacts to the local player â€” useful for single-player testing.</td></tr>
</tbody>
</table>
</div>
<h3>8.2 Overlapping Zones &amp; Priority</h3>
<p>When inside multiple zones, the Conductor picks TopZone by the highest <span class="ci">ZonePriority</span>. If TopZone changes, the Conductor reapplies zone override (state / profile) and zone layers. Leaving a TopZone triggers reselection of the next best zone, or disables zone override entirely if none remain.</p>
<h3>8.3 Zone + Gameplay State Interaction</h3>
<p>Gameplay requests via <span class="ci">BST_SetMusicState</span> set <span class="ci">GlobalRequestedState</span>. If <span class="ci">ZoneOverrideActive</span> is true, the TopZone's <span class="ci">ZoneState</span> can override what actually plays. When you leave all zones, the Conductor returns to <span class="ci">GlobalRequestedState</span> automatically.</p>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Requests vs Zones</div>
<p>If you need to override a zone temporarily (AI combat, scripted moments), use <span class="ci">State Requests</span> (<span class="ci">BST_PushStateRequest</span> / <span class="ci">BST_PushScopedStateRequest</span>). Zones win by default when they force a state. To override a forced zone, push a request with <span class="ci">ForceWhileInZone = true</span>. When the request is removed, the system falls back to the zone (or the global state).</p>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 9 â•â•â• -->
<section class="section visible" id="s9">
<h2><a class="anchor" href="#s9">#</a> 9. Arbitration Rules <span class="rbadge up" style="margin-left:auto">ADVANCED</span></h2>
<p>When gameplay, zones, and events request different things at the same time, the Conductor follows deterministic priority rules.</p>
<h3>9.1 State Resolution Priority</h3>
<p>The Conductor resolves the effective desired state using these deterministic rules:</p>
<ol>
<li><b>Forced Zone State</b> â€” If <span class="ci">ZoneOverrideActive</span> is true and <span class="ci">TopZone.ZoneState</span> is not NONE, the zone becomes the effective desired state <b>by default</b>.</li>
<li><b>State Requests</b> â€” If there is no forced zone state, the winning request (highest Priority among requests) becomes the effective desired state.</li>
<li><b>GlobalRequestedState</b> â€” Fallback from <span class="ci">BST_SetMusicState</span>.</li>
</ol>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Overriding a forced zone</div>
<p>If you want a request to override a zone that is forcing a state, push that request with <span class="ci">ForceWhileInZone = true</span>. If it is false, the request remains active but the zone stays in control until you exit the forced zone (or the zone state becomes NONE).</p>
</div>
<h3>9.2 Profile Resolution Priority</h3>
<p><span class="ci">ProfileInUse</span> is resolved together with the effective desired state (via <span class="ci">BST_ResolveDesiredStateAndProfile_Now</span>).
<b>Rule:</b> Use the zoneâ€™s <span class="ci">OverrideProfile</span> only when the <em>zone</em> is the source of the desired state (<span class="ci">TopZone.ZoneState</span>). If the desired state comes from a <span class="ci">State Request</span> or from <span class="ci">GlobalRequestedState</span>, then <span class="ci">ProfileInUse = ActiveProfile</span>. This prevents â€œstate not foundâ€ issues when a zone override profile does not contain a requested state.</p>
<h3>9.3 Layer Resolution (OR Combination)</h3>
<p>A layer is active if <em>any</em> source requests it:</p>
<div class="tw">
<table>
<thead><tr><th>Layer Source</th><th>Description</th></tr></thead>
<tbody>
<tr><td><span class="ci">ActiveDefaultLayers</span></td><td>Layers that are enabled by default when a track starts (per-track overrides supported). These can be temporarily muted via <span class="ci">SuppressedDefaultLayers</span>.</td></tr>
<tr><td><span class="ci">ActiveZoneLayers</span></td><td>Layers from the current TopZone's ExtraLayers (or pending zone layer set if quantized).</td></tr>
<tr><td><span class="ci">ActiveEventLayers</span></td><td>Layers explicitly toggled by gameplay through BFL_BST (or pending ops if quantized).</td></tr>
<tr><td><span class="ci">ActiveIntensityLayers</span></td><td>Layers enabled automatically by Intensity rules (0..1). This is computed and updated as intensity changes.</td></tr>
</tbody>
</table>
</div>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> OR Combination</div>
<p>Because layers use OR logic, removing a layer from Event Layers will <strong style="color:var(--text-primary)">not</strong> turn it off if the active zone still requests that same layer.</p>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 10 â•â•â• -->
<section class="section visible" id="s10">
<h2><a class="anchor" href="#s10">#</a> 10. Quantization (Next-Bar Changes)</h2>
<p>Quantization applies changes exactly on the next bar boundary â€” keeping transitions musically clean.</p>
<h3>10.1 State Quantization</h3>
<p>When <span class="ci">bQuantizeStateChangesToBar</span> is ON, state requests wait until the next bar boundary. On <span class="ci">BST_OnBar</span>, the Conductor re-resolves the effective desired state/profile using the current <span class="ci">TopZone</span> (if any) + active <span class="ci">State Requests</span> + your latest <span class="ci">GlobalRequestedState</span>, then switches only if needed. This prevents â€œstaleâ€ zone states from applying if you enter/exit zones before the bar.</p>
<h4>Effective State Quantization (Zones vs Conductor)</h4>
<p>There are <em>two</em> related values:</p>
<ul class="ul">
<li><span class="ci">bQuantizeStateChangesToBar</span> â€” your <strong style="color:var(--text-primary)">default</strong> preference (instance-editable on the Conductor).</li>
<li><span class="ci">Quantize State Changes to Bar Effective</span> â€” the <strong style="color:var(--text-primary)">runtime</strong> value actually used by the system. This is resolved whenever TopZone changes.</li>
</ul>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> How the effective value is resolved</div>
<p>The Conductor resolves the effective flag via <span class="ci">BST_ResolveEffectiveStateQuantize</span>:</p>
<ul class="ul">
<li>If the current <span class="ci">TopZone</span> forces quantize ON/OFF (tri-state override), that wins.</li>
<li>Otherwise, it falls back to <span class="ci">bQuantizeStateChangesToBar</span>.</li>
</ul>
</div>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Donâ€™t set the Effective flag directly</div>
<p><span class="ci">Quantize State Changes to Bar Effective</span> is treated as <em>read-only</em>. If you set it manually, it will be overwritten the next time zones are recomputed or <span class="ci">BST_ResolveEffectiveStateQuantize</span> runs. For runtime toggles (like demo buttons), set <span class="ci">bQuantizeStateChangesToBar</span> instead.</p>
</div>
<h3>10.2 Event Layer Ops Quantization</h3>
<p>Queued layer ops are applied on each bar in a deterministic order:</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Pending Layer Ops Â· Execution Order</span></div>
<pre><span class="val">1)</span> <span class="fn">Clear</span>          <span class="cmt">â† optional PendingClearEventLayers</span>
<span class="val">2)</span> <span class="fn">Remove</span>        <span class="cmt">â† PendingRemoveLayers[]</span>
<span class="val">3)</span> <span class="fn">Add</span>           <span class="cmt">â† PendingAddLayers[] (only if track has that stem)</span>
<span class="val">4)</span> <span class="fn">ApplyNow</span>     <span class="cmt">â† BST_ApplyEventLayersNow()</span></pre>
</div>
<h3>10.3 Zone Layer Set Quantization</h3>
<p>When zone layer changes are quantized, the Conductor stores <span class="ci">PendingZoneLayers</span> and sets <span class="ci">bHasPendingZoneLayerSet=true</span>. On bar, <span class="ci">BST_ApplyPendingZoneLayers_OnBar</span> copies pending layers into <span class="ci">ActiveZoneLayers</span>, clears the flag, and calls <span class="ci">BST_ApplyEventLayersNow</span>.</p>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Quantization Summary</div>
<p>BeatSyncToolkit supports quantization for three categories: state changes (<span class="ci">bQuantizeStateChangesToBar</span>), event layer operations (per-call <span class="ci">QuantizeToNextBar</span>), and zone layer set updates (<span class="ci">bQuantizeZoneLayerChangesToBar</span>).</p>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 11 â•â•â• -->
<section class="section visible" id="s11">
<h2><a class="anchor" href="#s11">#</a> 11. Playlist, Auto-Advance &amp; Track Lock</h2>
<h3>11.1 Base Playback &amp; Crossfade</h3>
<p>The Conductor uses two base AudioComponents (Base A and Base B). When switching tracks or states, it crossfades from the active base to the other via <span class="ci">BST_CrossfadeBaseTo</span>. <span class="ci">bUsingBaseA</span> tracks which base is active â€” <span class="ci">OnAudioFinished</span> events from the inactive base are ignored.</p>
<h3>11.2 Auto-Advance (Play Next Track)</h3>
<p>If <span class="ci">bAutoAdvancePlaylist</span> is ON, when the active base finishes, <span class="ci">BST_PlayNextTrack_SameState</span> fires. The next track is chosen from the current state's playlist, avoiding immediate repeats when possible. After selection: beat clock restarts, base crossfades, layer components are ensured playing muted, and active layers are re-applied.</p>
<h3>11.3 Track Lock</h3>
<p>Track Lock prevents auto-advance for the current track. When locked and the active base finishes, the Conductor restarts <span class="ci">CurrentTrack</span> instead of advancing. Event-based lock (from <span class="ci">BFL_BST</span>) takes priority over zone-based lock (from TopZone).</p>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Track Lock Scope</div>
<p>Track Lock locks the <em>currently playing</em> track at the moment the lock is engaged â€” not a specific track by name. It locks whatever is playing right now.</p>
</div>
<h3>11.4 Advance Lock (Anti Double-Advance)</h3>
<p>The Conductor briefly sets an internal Advance Lock during transitions to prevent double-advance (e.g. if both base finished events fire near a switch). This lock auto-clears after <span class="ci">AdvanceLockSeconds</span>.</p>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 12 â•â•â• -->
<section class="section visible" id="s12">
<h2><a class="anchor" href="#s12">#</a> 12. Practical Examples</h2>
<h3>Example A â€” Exploration / Combat with Quantized Transitions</h3>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
<pre><span class="cmt">// Enable quantization on the Conductor</span>
<span class="cls">Conductor</span>.<span class="val">bQuantizeStateChangesToBar</span> = <span class="kw">true</span>

<span class="cmt">// If your game uses per-zone state-quantize overrides, refresh the runtime effective flag:</span>
<span class="cls">Conductor</span>.<span class="fn">BST_ResolveEffectiveStateQuantize</span>()

<span class="cmt">// Normal gameplay:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Explore</span>)

<span class="cmt">// Combat starts â€” change applies cleanly on next bar:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Combat</span>)

<span class="cmt">// Combat ends:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Explore</span>)</pre>
</div>
<h3>Example B â€” Layered Tension (Event Layers)</h3>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
<pre><span class="cmt">// Ensure your Combat tracks include a Drums stem</span>
<span class="fn">BST_AddLayer</span>(<span class="val">Drums</span>)       <span class="cmt">â† fade in drums</span>
<span class="fn">BST_RemoveLayer</span>(<span class="val">Drums</span>)    <span class="cmt">â† fade out drums</span>
<span class="cmt">// No Drums stem on current track â†’ safely ignored</span></pre>
</div>
<h3>Example C â€” Zone Overrides + Extra Layers</h3>
<p>Place a <span class="ci">BP_BST_MusicZone</span> for a "Danger Area". Set <span class="ci">ZonePriority</span> high, <span class="ci">ZoneState = Danger</span>, and <span class="ci">ExtraLayers = [FX]</span>.</p>
<p>Walk into the zone: state is overridden and FX layer enables. Walk out: music returns to <span class="ci">GlobalRequestedState</span> and FX turns off â€” unless it's still requested by event layers.</p>
<h3>Example D â€” Overlapping Zones (TopZone Selection)</h3>
<p>Place Zone A (Priority 10) and Zone B (Priority 20) overlapping. Inside both: Zone B is TopZone. Leave Zone B while still in Zone A: the Conductor automatically switches back to Zone A's behavior.</p>
<h3>Example E â€” Track Lock during a Boss Fight</h3>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
<pre><span class="cmt">// Boss fight begins:</span>
<span class="fn">BST_LockCurrentTrack</span>()      <span class="cmt">â† track restarts on finish</span>

<span class="cmt">// Boss fight ends:</span>
<span class="fn">BST_UnlockCurrentTrack</span>()    <span class="cmt">â† auto-advance resumes</span></pre>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 13 â•â•â• -->
<section class="section visible" id="s13">
<h2><a class="anchor" href="#s13">#</a> 13. Debugging &amp; Troubleshooting</h2>
<h3>Common Setup Issues</h3>
<div class="tw">
<table>
<thead><tr><th>Symptom</th><th>Likely Cause</th></tr></thead>
<tbody>
<tr><td>Nothing plays</td><td>Forgot to place <span class="ci">BP_BST_Conductor</span>, or <span class="ci">ActiveProfile</span> / <span class="ci">AutoStartState</span> is not set.</td></tr>
<tr><td>Layers do nothing</td><td>Current track has no stem for that layer â€” LayerDef sound is empty.</td></tr>
<tr><td>Zone changes don't apply</td><td>Player isn't overlapping the zone's collision, or TopZone selection isn't what you expect.</td></tr>
<tr><td>State changes seem delayed</td><td><span class="ci">bQuantizeStateChangesToBar</span> is on â€” changes apply on the next bar.</td></tr>
<tr><td>Layer changes seem delayed</td><td>You enabled <span class="ci">QuantizeToNextBar</span> on your layer call.</td></tr>
<tr><td>Host hears music, clients donâ€™t</td><td>You are triggering <span class="ci">BFL_BST</span> calls only on the server/host. Call them on each client (or replicate a â€œmusic intentâ€ and call nodes in <span class="ci">OnRep</span>).</td></tr></tbody>
</table>
</div>
<h3>Debug Flags</h3>
<p>Enable these on <span class="ci">BP_BST_Conductor</span> to get console output:</p>
<div class="code-block">
<div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Debug Flags</span></div>
<pre><span class="val">bDebugPrint</span>          <span class="cmt">â† state switches, track picks, bar events</span>
<span class="val">bDebugZones</span>         <span class="cmt">â† zone enter/exit, TopZone changes, overrides applied</span>
<span class="val">bDebugProfiles</span>      <span class="cmt">â† profile resolution, state config lookups</span></pre>
</div>
<h3>Sanity Checklist</h3>
<ul class="cl">
<li><div class="chk"><svg viewbox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Exactly one Conductor exists in the level.</li>
<li><div class="chk"><svg viewbox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> ActiveProfile contains an entry for the target state.</li>
<li><div class="chk"><svg viewbox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Each TrackEntry has BaseSound set and correct BPM / BPB.</li>
<li><div class="chk"><svg viewbox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Your desired layer's LayerDef sound is valid for that track.</li>
<li><div class="chk"><svg viewbox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Zones have collision enabled and overlap events firing.</li>
</ul>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 15 â•â•â• -->
<section class="section visible" id="s14">
<h2># 14. Advanced Features (Optional) <a class="anchor" href="#s14">#</a><span class="rbadge up" style="margin-left:auto">ADVANCED</span></h2>
<p>For power users who want to understand internal responsibilities. Most games only need the BFL nodes and profile / zone setup.</p><details class="callout"><summary>Optional: Conductor Function Map (for power users)</summary><div style="margin-top:12px"><table>
<thead><tr><th>Category</th><th>Functions</th></tr></thead>
<tbody>
<tr><td><span class="ci">Profile</span></td><td><span class="ci">BST_GetStateConfig</span>, <span class="ci">BST_GetStateConfig_FromProfile</span>, <span class="ci">BST_PickTrackForState</span></td></tr>
<tr><td><span class="ci">Clock</span></td><td><span class="ci">BST_StartBeatClock</span>, <span class="ci">BST_OnBeatTick</span>, <span class="ci">BST_OnBar</span></td></tr>
<tr><td><span class="ci">Runtime</span></td><td><span class="ci">BST_SwitchStateNow</span>, <span class="ci">BST_CrossfadeBaseTo</span></td></tr>
<tr><td><span class="ci">Public</span></td><td><span class="ci">BST_RequestState</span></td></tr>
<tr><td><span class="ci">State (Internal)</span></td><td><span class="ci">BST_RequestState_Internal</span></td></tr>
<tr><td><span class="ci">Layers</span></td><td><span class="ci">BST_EnsureLayerComponentsPlayingMuted</span>, <span class="ci">BST_ApplyEventLayersNow</span>, <span class="ci">BST_CurrentTrackHasLayerSound</span>, <span class="ci">BST_AddEventLayer</span></td></tr>
<tr><td><span class="ci">Layers (Quantize)</span></td><td><span class="ci">BST_QueueAddLayer</span>, <span class="ci">BST_QueueRemoveLayer</span>, <span class="ci">BST_QueueClearLayers</span>, <span class="ci">BST_ApplyPendingLayerOps_OnBar</span></td></tr>
<tr><td><span class="ci">Playlist</span></td><td><span class="ci">BST_PlayNextTrack_SameState</span>, <span class="ci">BST_SetAdvanceLock</span>, <span class="ci">BST_ClearAdvanceLock</span></td></tr>
<tr><td><span class="ci">Zones</span></td><td><span class="ci">BST_NotifyZoneEntered</span>, <span class="ci">BST_NotifyZoneExited</span>, <span class="ci">BST_RecomputeTopZone</span>, <span class="ci">BST_ApplyZoneOverrideNow</span>, <span class="ci">BST_ResolveDesiredStateAndProfile_Now</span>, <span class="ci">BST_ResolveEffectiveStateQuantize</span></td></tr>
<tr><td><span class="ci">Zones (Queued)</span></td><td><span class="ci">BST_RequestRecomputeTopZone</span>, <span class="ci">BST_RecomputeTopZone_Queued</span>, <span class="ci">BST_ApplyPendingZoneLayers_OnBar</span></td></tr>
<tr><td><span class="ci">State Requests</span></td><td><span class="ci">BST_GetTopStateRequest</span>, <span class="ci">BST_ResolveDesiredStateAndProfile_Now</span>, <span class="ci">BST_PushStateRequest</span>, <span class="ci">BST_RemoveStateRequest</span>, <span class="ci">BST_ClearRequests</span></td></tr>
<tr><td><span class="ci">Track Lock</span></td><td><span class="ci">BST_UpdateTrackLockActive</span>, <span class="ci">BST_RestartCurrentTrackLocked</span></td></tr>
<tr><td><span class="ci">Intensity</span></td>
<td>
<span class="ci">BST_SetIntensity</span>, <span class="ci">BST_BeginIntensityTransition</span>, <span class="ci">EVT_IntensityRampTick</span>,
  <span class="ci">BST_ResolveIntensityRulesForCurrentTrack</span>, <span class="ci">BST_RecomputeActiveIntensityLayers</span>,
  <span class="ci">BST_ApplyIntensityNow_Internal</span>, <span class="ci">BST_ApplyPendingIntensity_OnBar</span>,
  <span class="ci">BST_EvalIntensityVolumeScaleForLayer</span>, <span class="ci">BST_GetLayerTargetVolume_Now</span>,
  <span class="ci">BST_LayerToBit</span>
</td></tr>
</tbody>
</table></div></details>
<div class="tw">
</div>
<div id="s15-intensity">
<h3>14.2 Intensity System (Advanced)</h3>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> Advanced feature â€” optional</div>
<p>You can ship your game using only States/Zones/Layers without Intensity. Use Intensity if you want a single gameplay â€œtension dialâ€ that drives extra layers automatically.</p>
</div>
<p><strong style="color:var(--text-primary)">Intensity</strong> is a continuous <span class="ci">0..1</span> value that can automatically enable or disable layers based on a rule list. This gives you a single gameplay â€œdialâ€ (exploration â†’ tension â†’ combat) without writing multiple Add/Remove calls.</p>
<h4>How Intensity Turns Into Layers</h4>
<p>The Conductor evaluates the active intensity rules and builds <span class="ci">ActiveIntensityLayers</span>. Each rule maps one layer to an â€œopenâ€ threshold (and optionally a separate â€œcloseâ€ threshold).</p>
<div class="tw">
<table>
<thead><tr><th>Rule Field</th><th>Meaning</th></tr></thead>
<tbody>
<tr><td><span class="ci">Layer</span></td><td>Which layer this rule controls (Drums/Bass/Harmony/Melody/FX).</td></tr>
<tr><td><span class="ci">Threshold</span></td><td>Intensity at or above this value will enable the layer.</td></tr>
<tr><td><span class="ci">CloseThreshold</span></td><td>Optional: intensity at or below this value will disable the layer (used only when hysteresis is enabled). If left negative (e.g. -1), the Conductor derives it automatically.</td></tr>
</tbody>
</table>
</div>
<h4>Hysteresis (Why CloseThreshold Exists)</h4>
<p>Without hysteresis, if intensity hovers around a threshold (e.g. <span class="ci">0.49 â†’ 0.51 â†’ 0.50</span>), layers may rapidly toggle ON/OFF. <strong style="color:var(--text-primary)">Hysteresis</strong> adds a â€œdead bandâ€ so a layer opens at one value, but only closes after intensity drops a bit further.</p>
<ul class="ul">
<li><strong style="color:var(--text-primary)">Open:</strong> Intensity â‰¥ Threshold â†’ layer turns ON</li>
<li><strong style="color:var(--text-primary)">Close:</strong> Intensity â‰¤ CloseThreshold â†’ layer turns OFF</li>
</ul>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Practical Example</div>
<p>Drums opens at <span class="ci">0.45</span>. With hysteresis delta <span class="ci">0.10</span>, it closes at <span class="ci">0.35</span>. That means small fluctuations around 0.45 wonâ€™t spam toggles.</p>
</div>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Where hysteresis is configured</div>
<p>Hysteresis is a Conductor setting (<span class="ci">bUseIntensityHysteresis</span> + <span class="ci">DefaultIntensityHysteresisDelta</span>). It is not tied to the Music Profile override mode â€” you can use hysteresis whether your rules come from the Conductor default, a per-track Profile Override, or a per-track Rules Override.</p>
</div>
<h4>Quantized vs Immediate Intensity Changes</h4>
<p>The gameplay node <span class="ci">BFL_BST â†’ BST_SetIntensity</span> includes a <span class="ci">Quantize to Next Bar</span> input. When enabled, the request is scheduled and applied cleanly on the next bar tick. When disabled, the new target is applied immediately. Any per-call smoothing overrides (smooth vs instant, and optional ramp seconds) are stored alongside the pending intensity change, so the feel stays consistent even when quantized.</p>
<h4>Optional Smoothing / Ramp</h4>
<p>You can optionally smooth intensity changes so <span class="ci">CurrentIntensity01</span> ramps toward the target instead of snapping instantly. This is useful when gameplay produces noisy or jumpy values (AI counts, threat meters, distance checks).</p>
<ul class="ul">
<li>The Conductor has a default smoothing mode (<span class="ci">bSmoothIntensity</span> + <span class="ci">IntensitySmoothingSeconds</span>).</li>
<li><span class="ci">BFL_BST â†’ BST_SetIntensity</span> can override smoothing <em>per call</em> (smooth vs instant). This override is respected even when the intensity change is quantized to the next bar.</li>
<li>If smoothing is active for that call, the Conductor ramps toward the target over <span class="ci">IntensitySmoothingSeconds</span> (or your optional per-call ramp seconds override, if you use it).</li>
<li>Because your thresholds are different per layer, smoothing naturally creates a â€œbuild-upâ€ feel: layers can turn on one by one as intensity crosses each threshold.</li>
</ul>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> Smoothing vs Layer Fades</div>
<p>Smoothing affects <strong style="color:var(--text-primary)">when</strong> a layer becomes enabled (threshold timing). Layer fade durations affect <strong style="color:var(--text-primary)">how</strong> the audio volume transitions once enabled. You can use either one alone, but the combo feels most musical.</p>
</div>
<h4>Min-change Apply (Performance Optimization)</h4>
<p>During smoothing, intensity may be evaluated many times per second. However, the <em>set</em> of enabled layers typically changes only when intensity crosses a threshold. BeatSyncToolkit includes a small optimization called <strong style="color:var(--text-primary)">Min-change Apply</strong> to avoid redundant work while intensity ramps.</p>
<ul class="ul">
<li>The Conductor computes <span class="ci">CurrentIntensityMask</span> (a bitmask) from the rules each time it recomputes <span class="ci">ActiveIntensityLayers</span>.</li>
<li>If <span class="ci">CurrentIntensityMask</span> equals <span class="ci">LastAppliedIntensityMask</span>, the Conductor skips re-applying event layers for that tick.</li>
<li>When the mask changes (threshold crossed), it applies once and updates <span class="ci">LastAppliedIntensityMask</span>.</li>
</ul>
<div class="callout note">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M14.5 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg></span> What This Changes (and What It Doesn't)</div>
<p>This optimization does <strong style="color:var(--text-primary)">not</strong> change how the music sounds. It only reduces redundant calls to the layer application pipeline. Your audible fades are still controlled by the per-layer fade durations in your Music Profile / TrackEntry layer defs.</p>
</div>
<h4>How the Bitmask Works (BST_LayerToBit)</h4>
<p>To keep the system modular, the Conductor converts a layer enum value into a unique bit using <span class="ci">BST_LayerToBit</span>. The default implementation is generic: it returns <span class="ci">2^EnumIndex</span> (equivalent to <span class="ci">1 &lt;&lt; EnumIndex</span>). This means you do <strong style="color:var(--text-primary)">not</strong> need to edit <span class="ci">BST_LayerToBit</span> when adding new layers.</p>
<div class="callout warning">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span> If You Extend the Layer Enum</div>
<p>Only append new entries to <span class="ci">E_BST_MusicLayer</span>. Do not reorder existing entries. Reordering changes enum indices, which changes bit assignments used by <span class="ci">CurrentIntensityMask</span>.</p>
</div>
<h4 class="h4">Intensity Curves (Volume Scaling)</h4>
<p>
By default, Intensity is a <b>binary layer gate</b> (a layer is either enabled or not).
With curves, an Intensity-enabled layer can also have its <b>target volume scaled</b> as Intensity changes.
This enables â€œgradual buildâ€ layers (e.g., drums getting louder) without needing multiple stems.
</p>
<ul class="ul">
<li>Each <span class="ci">F_BST_IntensityRule</span> can optionally provide a <span class="ci">Volume Scalar Curve</span> (CurveFloat).
      The curve is evaluated with <span class="ci">X = CurrentIntensity01</span> and outputs a scale value.</li>
<li>The scale is clamped to <span class="ci">0..1</span> and applied as:
      <span class="ci">EffectiveTargetVolume = BaseTargetVolume * Scale</span>.</li>
<li><b>Important:</b> the curve scaling is applied only when a layer is enabled <b>ONLY</b> by Intensity
      (Nonâ€‘Intensity ON = false, Intensity ON = true). If a layer is enabled by Default/Zone/Event,
      the system returns <span class="ci">BaseTargetVolume</span> unchanged (your normal layer behavior). <b>Also:</b> Intensity does <b>not</b> disable layers that are enabled by Default/Zone/Event â€” those sources have higher priority, so the layer remains ON even if Intensity drops.</li>
</ul>
<div class="callout tip">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><path d="M12 2a7 7 0 00-4 12.7V17a1 1 0 001 1h6a1 1 0 001-1v-2.3A7 7 0 0012 2z"/><line x1="9" y1="21" x2="15" y2="21"/></svg></span> Min-change for Curves (Performance)</div>
  During a smooth ramp, Intensity updates frequently. To avoid spamming volume updates,
  the Conductor only re-applies curve-scaled volumes when the intensity moved by at least
  <span class="ci">MinCurveReapplyDelta</span> since the last curve re-apply.
  Whenever something â€œstructuralâ€ changes (state switch / track switch / layer enable sources),
  the Conductor resets <span class="ci">LastCurveReapplyIntensity01</span> to <span class="ci">-1</span> so the next apply forces a curve refresh.
</div>
</div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 16 â•â•â• -->
<section class="section visible" id="s15">
<h2><a class="anchor" href="#s15">#</a> 15. Known Limitations &amp; Roadmap</h2>
<h3>15.1 Current Limitations</h3>
<p>These are intentional design boundaries or features not yet implemented. None of these prevent shipping a game with BeatSyncToolkit.</p>
<div class="tw">
<table>
<thead><tr><th>Limitation</th><th>Details</th><th>Workaround</th></tr></thead>
<tbody>
<tr><td>No editor preview</td><td>Music only plays in PIE or Standalone. There is no "audition in editor" mode.</td><td>Use PIE with <span class="ci">bStartOnBeginPlay = true</span> for quick testing.</td></tr>
<tr><td>5 fixed layer slots</td><td>The built-in layers are Drums, Bass, Harmony, Melody, FX. Adding more requires manual extension (see Section 5.6).</td><td>For most games, 5 layers is more than enough. Use States/Zones for additional variation.</td></tr>
<tr><td>Single Conductor per level</td><td>Only one <span class="ci">BP_BST_Conductor</span> should exist at a time. Multiple Conductors are not supported.</td><td>Use Zones and State Requests for spatial and event-driven variation within the same Conductor.</td></tr>
<tr><td>Timer-based clock (not sample-accurate)</td><td>The beat clock uses UE Timers, which are frame-dependent. Very high BPM (300+) or very low frame rates may cause slight timing drift.</td><td>For typical game BPM ranges (60â€“200) at 30+ FPS, timing is solid. Not intended for rhythm-game-level precision.</td></tr>
<tr><td>No MIDI input/output</td><td>BST does not read or generate MIDI data.</td><td>Use gameplay events (BST_SetMusicState, BST_AddLayer) instead of MIDI.</td></tr>
<tr><td>No dynamic stem loading</td><td>All stems referenced in a profile are loaded when the profile is active. There is no on-demand streaming per stem.</td><td>Keep stem file sizes reasonable. Use Sound Cues with streaming settings if memory is a concern.</td></tr>
</tbody>
</table>
</div>
<h3>15.2 Roadmap</h3>
<p>BeatSyncToolkit is designed to be expandable. Upcoming systems are toggles, they will not break the current workflow.</p>
<div class="callout info"><div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Planned Additions</div><ul><li>More convenience BFL nodes (quality-of-life wrappers for common patterns).</li><li>Optional Intensity add-ons (e.g., temporary suppression, per-zone intensity modifiers).</li><li>More demo levels and example profiles.</li><li>Expanded documentation with screenshot walkthroughs.</li></ul></div>
</section>
<div class="section-divider"></div>
<!-- â•â•â• 17 â•â•â• -->
<section class="section visible" id="s16">
<h2><a class="anchor" href="#s16">#</a> 16. Glossary / Key Terms <span class="rbadge ct" style="margin-left:auto">BEGINNER</span></h2>
<p>Quick definitions for common terms used in this documentation.</p>
<div class="grid cols-2">
<div class="card">
<div class="card-title">Stems</div>
<p>Separate audio layers of the same music (drums, bass, melody, etc.). Each stem is its own sound file, so BeatSyncToolkit can fade layers in/out independently.</p>
</div>
<div class="card">
<div class="card-title">Quantization</div>
<p>Applying changes on the next <strong style="color:var(--text-primary)">bar</strong> boundary (instead of instantly). This keeps transitions musically clean.</p>
</div>
<div class="card">
<div class="card-title">BPM</div>
<p><em>Beats Per Minute</em> â€” how fast the music is. BeatSyncToolkit uses BPM to schedule beat/bar timing.</p>
</div>
<div class="card">
<div class="card-title">Bar</div>
<p>A musical measure. Commonly <span class="ci">4 beats = 1 bar</span> (but it depends on your trackâ€™s <span class="ci">BeatsPerBar</span>).</p>
</div>
<div class="card">
<div class="card-title">Quartz</div>
<p>Unreal Engineâ€™s sample-accurate audio timing system. BeatSyncToolkit <strong style="color:var(--text-primary)">does not</strong> use Quartz â€” it uses a lightweight Conductor timer/clock approach.</p>
</div>
<div class="card">
<div class="card-title">Arbitration</div>
<p>Rules for what â€œwinsâ€ when multiple systems try to control music at once (Zones vs Events vs Defaults vs State requests).</p>
</div>
<div class="card">
<div class="card-title">Hysteresis</div>
<p>A â€œdead zoneâ€ between open/close thresholds so a value doesnâ€™t flicker rapidly when hovering near the threshold.</p>
</div>
<div class="card">
<div class="card-title">Data Asset</div>
<p>An Unreal asset used to store structured configuration data. BeatSyncToolkit profiles are Data Assets.</p>
</div>
<div class="card">
<div class="card-title">Scope / Scoped Requests</div>
<p>A â€œgrouping keyâ€ used by State Requests so multiple instances (like many AI actors) donâ€™t overwrite each other. A scoped request key is typically <span class="ci">ScopeKey + RequestName</span>. Use per-actor scope for enemy AI, or use a shared scope for group-wide systems.</p>
</div>
<div class="card">
<div class="card-title">WorldContextObject</div>
<p>A Blueprint reference used to locate the current World. Most of the time, connect <span class="ci">Self</span>. Without a valid World context, global BFL nodes may fail to find the placed Conductor.</p>
</div>
</div>
<div class="callout info">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> Beginner note</div>
<p>If any of these terms are unfamiliar, start with <a href="#s2">Quick Start</a> and come back here later.</p>
</div>
</section><section class="section visible" id="s17"><h2><a class="anchor" href="#s17">#</a> 17. Frequently Asked Questions (FAQ)</h2><p>Quick answers to the most common questions.</p><details class="callout"><summary>Do I need C++ knowledge?</summary><div style="margin-top:12px"><p>No â€” BeatSyncToolkit is Blueprint-first and ships with global Blueprint nodes for runtime control.</p></div></details><details class="callout"><summary>Does this use Quartz?</summary><div style="margin-top:12px"><p>No. BST uses a lightweight timer-based beat clock and bar quantization. Quartz is not required (and BST can coexist with Quartz if your project uses it elsewhere).</p></div></details><details class="callout"><summary>Can I add custom Music States?</summary><div style="margin-top:12px"><p>Yes. Extend <span class="ci">E_BST_MusicState</span>, then add tracks for the new state inside your Music Profile DataAsset.</p></div></details><details class="callout"><summary>Can I use my own music?</summary><div style="margin-top:12px"><p>Yes. Any asset playable by an <span class="ci">AudioComponent</span> works (Sound Waves, Sound Cues, and MetaSound Source assets). Import your sounds, then assign them in your profile.</p></div></details><details class="callout"><summary>Does this work with MetaSounds?</summary><div style="margin-top:12px"><p>Yes â€” if you can assign it to an <span class="ci">AudioComponent</span>, BST can play it as a base track or as a layer stem.</p></div></details><details class="callout"><summary>Is there multiplayer support?</summary><div style="margin-top:12px"><p>BST is multiplayer-friendly, but audio is typically driven on each client. Replicate your gameplay events (state requests / layers / intensity) to clients, then call the BST nodes locally. Dedicated servers usually do not need to run audio.</p></div></details><details class="callout"><summary>Can I preview music in the editor?</summary><div style="margin-top:12px"><p>BST is designed for runtime playback (PIE / Standalone). It does not provide an 'editor-only audition' mode without pressing Play.</p></div></details><details class="callout"><summary>Performance impact?</summary><div style="margin-top:12px"><p>Very small. At runtime, BeatSyncToolkit uses <strong style="color:var(--text-primary)">2 base AudioComponents</strong> (for crossfade) + <strong style="color:var(--text-primary)">5 layer AudioComponents</strong> (one per stem) = 7 total AudioComponents. The beat clock is a single lightweight timer. Zone overlap checks use standard UE collision (no tick cost). State/layer arbitration runs only when something changes (event-driven, not per-tick). In practice, BST's CPU footprint is negligible compared to a single particle system. The only scaling concern is if you have a very large number of concurrent State Requests (100+), which is easily solved with a manager pattern (see Section 6).</p></div></details><details class="callout"><summary>Roadmap / updates?</summary><div style="margin-top:12px"><p>Check the <strong>Roadmap</strong> section for planned additions and version notes.</p></div></details><details class="callout"><summary>How do I remove/uninstall BeatSyncToolkit?</summary><div style="margin-top:12px"><p>Delete the <span class="ci">BeatSyncToolkit</span> content folder from your project. Remove any <span class="ci">BP_BST_Conductor</span> and <span class="ci">BP_BST_MusicZone</span> actors from your levels. Delete or disconnect any <span class="ci">BFL_BST</span> node calls in your Blueprints (they will show as broken nodes after removal). No engine files or config files are modified by BST, so removal is clean.</p></div></details>
<details class="callout"><summary>Does it work on UE 5.3 or 5.4?</summary><div style="margin-top:12px"><p>BeatSyncToolkit is built and tested on UE 5.5.x. It uses only standard Blueprint features, so it is expected to work on 5.3+ without issues. However, only 5.5.x is officially tested and supported. If you encounter issues on an older version, please report them.</p></div></details>
<details class="callout"><summary>Can I use Sound Cues or MetaSound Sources instead of raw WAV?</summary><div style="margin-top:12px"><p>Yes. Any asset that can be assigned to a standard UE <span class="ci">AudioComponent</span> works as a BaseSound or layer stem. This includes SoundWave (.wav, .ogg imports), SoundCue, and MetaSound Source assets.</p></div></details>
<details class="callout"><summary>What happens if I switch states while a crossfade is in progress?</summary><div style="margin-top:12px"><p>The Conductor handles rapid state switches gracefully. A new state switch during an active crossfade will start a new crossfade from the current mix, so you never hear a "jump". If quantization is enabled, the new switch waits for the next bar regardless.</p></div></details>
<details class="callout"><summary>Can I have different fade speeds per layer?</summary><div style="margin-top:12px"><p>Yes. Each layer in each TrackEntry has its own <span class="ci">FadeInDuration</span> and <span class="ci">FadeOutDuration</span> (configured in <span class="ci">F_BST_LayerDef</span>). For example, drums can snap in at 0.1s while harmony fades in over 2s.</p></div></details>
<details class="callout"><summary>How do I report issues?</summary><div style="margin-top:12px"><p>Contact us at <strong><a href="mailto:nonfigurestudio@gmail.com" style="color:var(--accent);text-decoration:none;">nonfigurestudio@gmail.com</a></strong> and include your engine version, a short repro checklist, and screenshots if possible.</p></div></details></section>

<section class="section visible" id="s18">
<h2><a class="anchor" href="#s18">#</a> 18. Support & Contact</h2>
<p>Need help or want to report an issue? Reach out to us.</p>

<h3>Email Support</h3>
<p>For questions, bug reports, or feature requests, contact us at:</p>
<p style="font-size:20px; margin-top:16px;"><strong><a href="mailto:nonfigurestudio@gmail.com" style="color:var(--accent);">nonfigurestudio@gmail.com</a></strong></p>

<div class="callout info" style="margin-top:32px;">
<div class="callout-title"><span class="callout-icon"><svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg></span> When reporting issues, please include:</div>
<ul>
<li>Your Unreal Engine version (e.g., UE 5.5.2)</li>
<li>Steps to reproduce the issue</li>
<li>Screenshots or error messages if applicable</li>
<li>Brief description of your setup (project type, music profile details)</li>
</ul>
</div>

</section>
<!-- â”€â”€â”€ FOOTER â”€â”€â”€ -->
<div class="footer">
<p>BeatSyncToolkit v1.1 Â· Adaptive Music Conductor for Unreal Engine 5.5.x</p>
<div class="footer-links">
  <a href="#s2">Quick Start</a>
  <a href="#s6">API Reference</a>
  <a href="#s17">FAQ</a>
  <a href="mailto:nonfigurestudio@gmail.com">Support</a>
</div>
</div>
</main><!-- end .main -->

<!-- â•â•â•â•â•â•â•â•â•â•â• RIGHT SIDEBAR (TOC) â•â•â•â•â•â•â•â•â•â•â• -->
<aside class="right-sidebar">
  
  <!-- Stats Widget -->
  <div class="sidebar-widget">
    <div class="widget-title">
      <span class="widget-icon"><svg class="widget-icon-svg" viewBox="0 0 24 24"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg></span>
      At a Glance
    </div>
    <div class="stats-grid">
      <div class="stat-item">
        <span class="stat-value">18</span>
        <span class="stat-label">Sections</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">100%</span>
        <span class="stat-label">Blueprint</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">5.5+</span>
        <span class="stat-label">UE Version</span>
      </div>
      <div class="stat-item">
        <span class="stat-value">0</span>
        <span class="stat-label">C++ Needed</span>
      </div>
    </div>
  </div>

  <!-- TOC Navigation -->
  <nav class="toc" id="toc">
    <div class="toc-title">On This Page</div>
    <ul class="toc-list" id="tocList">
      <!-- Dynamically populated -->
    </ul>
  </nav>

  <!-- Quick Actions Widget -->
  <div class="sidebar-widget">
    <div class="widget-title">
      <span class="widget-icon"><svg class="widget-icon-svg" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg></span>
      Quick Actions
    </div>
    <div class="quick-actions">
      <a href="#s2" class="quick-action-btn">
        <span class="icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 11-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg></span>
        <span>Quick Start Guide</span>
      </a>
      <a href="#s13" class="quick-action-btn">
        <span class="icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.7 6.3a1 1 0 000 1.4l1.6 1.6a1 1 0 001.4 0l3.77-3.77a6 6 0 01-7.94 7.94l-6.91 6.91a2.12 2.12 0 01-3-3l6.91-6.91a6 6 0 017.94-7.94l-3.76 3.76z"/></svg></span>
        <span>Troubleshooting</span>
      </a>
      <a href="#s17" class="quick-action-btn">
        <span class="icon"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 015.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg></span>
        <span>FAQ</span>
      </a>
    </div>
  </div>

  <!-- Help Widget -->
  <div class="sidebar-widget help-card">
    <div class="widget-title">
      <span class="widget-icon"><svg class="widget-icon-svg" viewBox="0 0 24 24"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg></span>
      Need Help?
    </div>
    <p class="help-text">
      Questions or issues? We're here to help!
    </p>
    <a href="mailto:nonfigurestudio@gmail.com" class="help-email">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
      <span>Contact Support</span>
    </a>
  </div>

</aside>

</div><!-- end .content-wrapper -->
<!-- Back to Top -->
<a class="b2t" href="#top" id="b2t">
<svg fill="none" height="14" stroke="currentColor" stroke-width="2.2" viewbox="0 0 16 16" width="14"><path d="M3 11l5-5 5 5"></path></svg>
</a>
<!-- â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
  const navItems = document.querySelectorAll('.nav-item[data-id]');
  const sectionEls = Array.from(document.querySelectorAll('.section[id]'));
  const progBar = document.getElementById('progressBar');
  const b2t = document.getElementById('b2t');

  function getScrollPct(){
    var h = document.documentElement;
    var b = document.body;
    var st = h.scrollTop || b.scrollTop;
    var sh = h.scrollHeight || b.scrollHeight;
    var ch = h.clientHeight;
    return (st / (sh - ch)) * 100;
  }

  // Sort sectionEls by actual document position (topâ†’bottom) â€” defensive
  sectionEls.sort(function(a, b){ return a.compareDocumentPosition(b) & 4 ? -1 : 1; });

  window.addEventListener('scroll', function(){
    // Progress bar
    progBar.style.width = getScrollPct() + '%';

    // Back to top
    b2t.classList.toggle('vis', window.scrollY > 500);

    // Active nav â€” use getBoundingClientRect for reliable viewport-relative position
    var current = null;
    for(var i = 0; i < sectionEls.length; i++){
      if(sectionEls[i].getBoundingClientRect().top <= 72){
        current = sectionEls[i].id;
      }
    }

    navItems.forEach(function(item){
      item.classList.toggle('active', item.dataset.id === current);
    });
  }, {passive:true});

  // Smooth scroll for nav clicks â€” manual offset so heading stays visible
  document.querySelectorAll('a[href^="#"]').forEach(function(a){
    a.addEventListener('click', function(e){
      var target = document.querySelector(this.getAttribute('href'));
      if(target){
        e.preventDefault();
        var y = target.getBoundingClientRect().top + window.scrollY - 56;
        window.scrollTo({top: y, behavior:'smooth'});
      }
    });
  });

  // â”€â”€ Scroll Reveal (Intersection Observer) â”€â”€
  // Only top-level .section elements get reveal â€” children inherit visibility from parent.
  const revealEls = document.querySelectorAll('.section');
  revealEls.forEach(el => el.classList.add('reveal'));

  const revealObserver = new IntersectionObserver(function(entries){
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.classList.add('visible');

        // Stagger .file-pill cards inside this section (if any)
        const pills = entry.target.querySelectorAll('.file-pill');
        if(pills.length){
          pills.forEach((pill, i) => {
            pill.style.opacity = '0';
            pill.style.transform = 'translateY(14px)';
            pill.style.transition = `opacity 0.4s cubic-bezier(.22,.68,0,1.2) ${i*0.07 + 0.3}s, transform 0.4s cubic-bezier(.22,.68,0,1.2) ${i*0.07 + 0.3}s`;
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                pill.style.opacity = '1';
                pill.style.transform = 'translateY(0)';
              });
            });
          });
        }

        revealObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.08, rootMargin: '0px 0px -30px 0px' });

  revealEls.forEach(el => revealObserver.observe(el));
})();


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”§ PROFESSIONAL DOCUMENTATION FEATURES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

(function(){
  // â”€â”€ Search Functionality â”€â”€
  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');
  const kbHint = document.getElementById('kbHint');

  if (searchInput && searchResults) {

    // â”€â”€ Search Index â”€â”€
    let searchIndex = [];
    let currentResults = [];
    let selectedResultIdx = -1;

    const MIN_QUERY_LEN = 2;
    const MAX_RESULTS = 12;
    const SNIPPET_RADIUS = 90;

    function normalizeText(str) {
      return (str || '')
        .toLowerCase()
        .replace(/[^\p{L}\p{N}\s]/gu, ' ')
        .replace(/\s+/g, ' ')
        .trim();
    }

    function tokenize(query) {
      const q = normalizeText(query);
      if (!q) return [];
      return q.split(' ').filter(Boolean);
    }

    function slugify(str) {
      return normalizeText(str).replace(/\s+/g, '-').slice(0, 64) || 'heading';
    }

    function getText(el) {
      if (!el) return '';
      return (el.innerText || el.textContent || '').replace(/\s+/g, ' ').trim();
    }

    function getHeadingLevel(el) {
      const m = /^H([1-6])$/.exec(el.tagName || '');
      return m ? parseInt(m[1], 10) : 0;
    }

    function ensureId(el, fallbackId) {
      if (el.id && el.id.length > 0) return el.id;
      el.id = fallbackId;
      return el.id;
    }

    // Extract text that "belongs" to a heading: until the next heading of same-or-higher level.
    function extractRangeText(headingEl) {
      const level = getHeadingLevel(headingEl);
      const parts = [];
      let node = headingEl.nextSibling;

      while (node) {
        if (node.nodeType === 1 && /^H[1-6]$/.test(node.tagName)) {
          const nl = getHeadingLevel(node);
          if (nl > 0 && nl <= level) break;
        }

        if (node.nodeType === 1) {
          const t = getText(node);
          if (t) parts.push(t);
        } else if (node.nodeType === 3) {
          const t = (node.textContent || '').replace(/\s+/g, ' ').trim();
          if (t) parts.push(t);
        }

        node = node.nextSibling;
      }

      return parts.join(' ');
    }

    function buildSearchIndex() {
      searchIndex = [];
      const sections = document.querySelectorAll('.section');

      sections.forEach((section) => {
        const h2 = section.querySelector('h2');
        if (!h2) return;

        const sectionId = section.id || '';
        const sectionTitle = getText(h2).replace(/^#\s*/, '').trim();

        // Whole section (broad matches)
        searchIndex.push({
          id: sectionId,
          title: sectionTitle,
          path: sectionTitle,
          content: getText(section),
          element: h2,
          level: 2
        });

        // Sub-headings (more precise matches)
        const subs = Array.from(section.querySelectorAll('h3, h4'));
        subs.forEach((sub, i) => {
          const subTitle = getText(sub).trim();
          const autoId = `${sectionId || 'sec'}-auto-${i}-${slugify(subTitle).slice(0, 24)}`;
          const subId = ensureId(sub, autoId);
          const subContent = extractRangeText(sub);

          searchIndex.push({
            id: subId,
            title: subTitle,
            path: `${sectionTitle} â†’ ${subTitle}`,
            content: subContent,
            element: sub,
            level: getHeadingLevel(sub)
          });
        });
      });
    }

    buildSearchIndex();

    function matchesAllTokens(haystackNorm, toks) {
      for (const t of toks) {
        if (!haystackNorm.includes(t)) return false;
      }
      return true;
    }

    function scoreItem(item, toks, rawQuery) {
      const titleNorm = normalizeText(item.title);
      const pathNorm = normalizeText(item.path);
      const contentNorm = normalizeText(item.content);

      let score = 0;

      toks.forEach((t) => {
        if (titleNorm.includes(t)) score += 60;
        if (pathNorm.includes(t)) score += 20;
        if (contentNorm.includes(t)) score += 8;
      });

      const qNorm = normalizeText(rawQuery);
      if (qNorm && titleNorm.startsWith(qNorm)) score += 120;
      if (qNorm && titleNorm === qNorm) score += 180;

      if (item.level >= 3) score += 10; // prefer specific headings slightly

      return score;
    }

    function makeSnippet(content, toks) {
      const raw = (content || '').replace(/\s+/g, ' ').trim();
      if (!raw) return '';

      const rawLower = raw.toLowerCase();
      let firstIdx = -1;

      for (const t of toks) {
        const i = rawLower.indexOf(t);
        if (i !== -1 && (firstIdx === -1 || i < firstIdx)) firstIdx = i;
      }

      if (firstIdx === -1) {
        return raw.slice(0, SNIPPET_RADIUS * 2) + (raw.length > SNIPPET_RADIUS * 2 ? 'â€¦' : '');
      }

      const start = Math.max(0, firstIdx - SNIPPET_RADIUS);
      const end = Math.min(raw.length, firstIdx + SNIPPET_RADIUS);

      const prefix = start > 0 ? 'â€¦' : '';
      const suffix = end < raw.length ? 'â€¦' : '';

      return prefix + raw.slice(start, end) + suffix;
    }

    function highlightTokens(text, toks) {
      let out = text;
      toks.forEach((t) => {
        if (!t) return;
        const escaped = t.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        const re = new RegExp(`(${escaped})`, 'ig');
        out = out.replace(re, '<span class="search-highlight">$1</span>');
      });
      return out;
    }

    function closeResults() {
      searchResults.classList.remove('active');
      selectedResultIdx = -1;
    }

    function updateSelectedResult() {
      const items = searchResults.querySelectorAll('.search-result-item');
      items.forEach(item => item.classList.remove('selected'));
      if (selectedResultIdx >= 0 && selectedResultIdx < items.length) {
        items[selectedResultIdx].classList.add('selected');
        items[selectedResultIdx].scrollIntoView({ block: 'nearest' });
      }
    }

    function displayResults(results, toks, rawQuery) {
      currentResults = results;

      if (results.length === 0) {
        searchResults.innerHTML = `
          <div class="search-empty">
            <div class="search-empty-icon"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg></div>
            <div class="search-empty-text">No results found for "${rawQuery}"</div>
          </div>
        `;
        searchResults.classList.add('active');
        return;
      }

      searchResults.innerHTML = results.map((item, idx) => {
        const snippet = makeSnippet(item.content, toks);
        return `
          <div class="search-result-item" data-idx="${idx}">
            <div class="search-result-title">${highlightTokens(item.title, toks)}</div>
            <div class="search-result-path">${highlightTokens(item.path, toks)}</div>
            <div class="search-result-snippet">${highlightTokens(snippet, toks)}</div>
          </div>
        `;
      }).join('');

      searchResults.querySelectorAll('.search-result-item').forEach((itemEl) => {
        itemEl.addEventListener('click', function () {
          const idx = parseInt(this.dataset.idx, 10);
          const item = currentResults[idx];
          if (!item || !item.element) return;

          closeResults();
          searchInput.blur();

          const y = item.element.getBoundingClientRect().top + window.pageYOffset - 90;
          window.scrollTo({ top: y, behavior: 'smooth' });

          try { if (item.id) history.replaceState(null, '', '#' + item.id); } catch(e) {}

          item.element.classList.add('search-target');
          setTimeout(() => item.element.classList.remove('search-target'), 1200);
        });
      });

      searchResults.classList.add('active');
    }

    function performSearch(query) {
      const raw = (query || '').trim();
      const toks = tokenize(raw);

      if (raw.length < MIN_QUERY_LEN || toks.length === 0) {
        searchResults.innerHTML = '';
        closeResults();
        currentResults = [];
        return;
      }

      const matches = searchIndex.filter((item) => {
        const hay = normalizeText(item.title + ' ' + item.path + ' ' + item.content);
        return matchesAllTokens(hay, toks);
      });

      const scored = matches.map((item) => ({
        item,
        score: scoreItem(item, toks, raw)
      })).sort((a, b) => b.score - a.score);

      selectedResultIdx = -1;
      displayResults(scored.slice(0, MAX_RESULTS).map(s => s.item), toks, raw);
    }

    // Debounced search input
    let searchTimeout;
    searchInput.addEventListener('input', function () {
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => performSearch(this.value), 120);
    });

    // Keyboard shortcut: "/" focuses search
    document.addEventListener('keydown', function (e) {
      if (e.key === '/' && document.activeElement !== searchInput) {
        e.preventDefault();
        searchInput.focus();
        if (kbHint) {
          kbHint.classList.add('show');
          setTimeout(() => kbHint.classList.remove('show'), 3000);
        }
      }
    });

    // Keyboard navigation in results
    searchInput.addEventListener('keydown', function (e) {
      const items = searchResults.querySelectorAll('.search-result-item');

      if (e.key === 'ArrowDown' && items.length > 0) {
        e.preventDefault();
        selectedResultIdx = Math.min(selectedResultIdx + 1, items.length - 1);
        updateSelectedResult();
      } else if (e.key === 'ArrowUp' && items.length > 0) {
        e.preventDefault();
        selectedResultIdx = Math.max(selectedResultIdx - 1, 0);
        updateSelectedResult();
      } else if (e.key === 'Enter' && selectedResultIdx >= 0 && items.length > 0) {
        e.preventDefault();
        items[selectedResultIdx].click();
      } else if (e.key === 'Escape') {
        closeResults();
        searchInput.blur();
      }
    });

    // Close results when clicking outside
    document.addEventListener('click', function (e) {
      if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
        closeResults();
      }
    });

    // Light target highlight (inject once)
    if (!document.getElementById('bst-search-target-style')) {
      const style = document.createElement('style');
      style.id = 'bst-search-target-style';
      style.textContent = `
        .search-target { outline: 2px solid var(--accent); outline-offset: 6px; border-radius: 10px; }
      `;
      document.head.appendChild(style);
    }

  }

  // â”€â”€ Copy Code Buttons â”€â”€
  document.querySelectorAll('.code-block').forEach(block => {
    const btn = document.createElement('button');
    btn.className = 'copy-code-btn';
    btn.innerHTML = '<span class="copy-icon"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></span><span class="copy-text">Copy</span>';
    block.appendChild(btn);
    
    btn.addEventListener('click', function(){
      const pre = block.querySelector('pre');
      if(!pre) return;
      
      // Get text without HTML tags
      const code = pre.textContent;
      
      // Copy to clipboard
      navigator.clipboard.writeText(code).then(() => {
        btn.classList.add('copied');
        btn.innerHTML = '<span class="copy-icon"><svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg></span><span class="copy-text">Copied!</span>';
        
        setTimeout(() => {
          btn.classList.remove('copied');
          btn.innerHTML = '<span class="copy-icon"><svg viewBox="0 0 24 24"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg></span><span class="copy-text">Copy</span>';
        }, 2000);
      });
    });
  });
  
  // â”€â”€ Enhanced Anchor Links â”€â”€
  // Add IDs to h3 and h4 if they don't have them
  document.querySelectorAll('h3, h4').forEach((heading, idx) => {
    if(!heading.id){
      const text = heading.textContent.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
      heading.id = 'heading-' + text.substring(0, 30) + '-' + idx;
    }
    
    // Add anchor link if not present
    if(!heading.querySelector('.anchor')){
      const anchor = document.createElement('a');
      anchor.className = 'anchor';
      anchor.href = '#' + heading.id;
      anchor.textContent = '#';
      anchor.onclick = function(e){
        e.preventDefault();
        const y = heading.getBoundingClientRect().top + window.scrollY - 80;
        window.scrollTo({top: y, behavior:'smooth'});
        try { history.pushState(null, null, '#' + heading.id); } catch(e) {}
      };
      heading.appendChild(anchor);
    }
  });
  
  // Show kb hint on first page load
  if(kbHint){
    setTimeout(() => {
      kbHint.classList.add('show');
      setTimeout(() => kbHint.classList.remove('show'), 3000);
    }, 1000);
  }
  
})();

// â•â•â•â•â•â•â•â•â•â•â• RIGHT SIDEBAR TOC â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const tocList = document.getElementById('tocList');
  const navItems = document.querySelectorAll('.nav-item[data-id]');
  let currentSectionId = null;
  
  function updateTOC(sectionId) {
    if (currentSectionId === sectionId) return;
    currentSectionId = sectionId;
    
    // Find the section element
    const section = document.getElementById(sectionId);
    if (!section) {
      tocList.innerHTML = '<div class="toc-empty">No headings in this section</div>';
      return;
    }
    
    // Get all h3 headings in this section
    const headings = section.querySelectorAll('h3');
    
    if (headings.length === 0) {
      tocList.innerHTML = '<div class="toc-empty">No headings in this section</div>';
      return;
    }
    
    // Build TOC list
    tocList.innerHTML = '';
    headings.forEach((heading, index) => {
      // Ensure heading has an ID
      if (!heading.id) {
        const text = heading.textContent.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
        heading.id = 'heading-' + text.substring(0, 30) + '-' + index;
      }
      
      const li = document.createElement('li');
      li.className = 'toc-item';
      
      const link = document.createElement('a');
      link.href = '#' + heading.id;
      link.className = 'toc-link';
      link.textContent = heading.textContent.replace(/#$/, '').trim();
      link.onclick = function(e) {
        e.preventDefault();
        const y = heading.getBoundingClientRect().top + window.scrollY - 100;
        window.scrollTo({top: y, behavior:'smooth'});
        try { history.pushState(null, null, '#' + heading.id); } catch(e) {}
        updateActiveTOCLink();
      };
      
      li.appendChild(link);
      tocList.appendChild(li);
    });
    
    // Update active TOC link based on scroll position
    updateActiveTOCLink();
  }
  
  function updateActiveTOCLink() {
    const tocLinks = document.querySelectorAll('.toc-link');
    const scrollPos = window.scrollY + 120;
    
    let activeLink = null;
    tocLinks.forEach(link => {
      const targetId = link.getAttribute('href').substring(1);
      const target = document.getElementById(targetId);
      if (target && target.getBoundingClientRect().top + window.scrollY <= scrollPos) {
        activeLink = link;
      }
    });
    
    tocLinks.forEach(link => link.classList.remove('active'));
    if (activeLink) {
      activeLink.classList.add('active');
    }
  }
  
  // Listen to section changes
  navItems.forEach(item => {
    item.addEventListener('click', function() {
      const sectionId = this.getAttribute('data-id');
      setTimeout(() => updateTOC(sectionId), 100);
    });
  });
  
  // Listen to scroll for active TOC link highlighting
  let scrollTimeout;
  window.addEventListener('scroll', function() {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(updateActiveTOCLink, 50);
  });
  
  // Initialize TOC with first visible section
  const firstSection = document.querySelector('.section[id]');
  if (firstSection) {
    updateTOC(firstSection.id);
  }
})();

// â•â•â•â•â•â•â•â•â•â•â• MOBILE MENU â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const btn = document.getElementById('mobileMenuBtn');
  const sidebar = document.querySelector('.sidebar');
  const overlay = document.getElementById('sidebarOverlay');
  
  if (!btn || !sidebar || !overlay) return;
  
  function toggleMenu() {
    const isOpen = sidebar.classList.toggle('mobile-open');
    btn.classList.toggle('active', isOpen);
    overlay.classList.toggle('active', isOpen);
    document.body.style.overflow = isOpen ? 'hidden' : '';
  }
  
  function closeMenu() {
    sidebar.classList.remove('mobile-open');
    btn.classList.remove('active');
    overlay.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  btn.addEventListener('click', toggleMenu);
  overlay.addEventListener('click', closeMenu);
  
  // Close menu when nav item is clicked
  sidebar.querySelectorAll('.nav-item').forEach(function(item){
    item.addEventListener('click', closeMenu);
  });
})();

// â•â•â•â•â•â•â•â•â•â•â• SIDEBAR READING PROGRESS â•â•â•â•â•â•â•â•â•â•â•
(function(){
  const fill = document.getElementById('sidebarProgress');
  if (!fill) return;
  
  window.addEventListener('scroll', function(){
    var h = document.documentElement;
    var b = document.body;
    var st = h.scrollTop || b.scrollTop;
    var sh = h.scrollHeight || b.scrollHeight;
    var ch = h.clientHeight;
    var pct = (st / (sh - ch)) * 100;
    fill.style.width = Math.min(100, Math.max(0, pct)) + '%';
  }, {passive:true});
})();
</script>
</body>
</html>
