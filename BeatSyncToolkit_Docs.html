<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BeatSyncToolkit â€” Documentation v1.1</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@600;700;800&family=Outfit:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
:root {
  --bg-primary: #080c18;
  --bg-secondary: #0e1220;
  --bg-tertiary: #141a2e;
  --bg-code: #0a0f1f;
  --border: #1e2a45;
  --border-hover: #2d3f5f;
  --text-primary: #dde2eb;
  --text-secondary: #9da5bf;
  --text-tertiary: #5a6477;
  --accent: #6366f1;
  --accent-glow: rgba(99,102,241,0.15);
  --accent-hover: #7c7ff5;
  --accent-muted: rgba(99,102,241,0.08);
  --green: #34d399;
  --amber: #fbbf24;
  --red: #f87171;
  --blue: #60a5fa;
  --font-heading: 'Syne', sans-serif;
  --font-body: 'Outfit', sans-serif;
  --font-mono: 'JetBrains Mono', monospace;
  --sidebar-width: 272px;
}

* { margin:0; padding:0; box-sizing:border-box; }
html { scroll-behavior:auto; }

body {
  font-family: var(--font-body);
  background: var(--bg-primary);
  color: var(--text-primary);
  min-height:100vh;
  display:flex;
  font-size:16px;
  line-height:1.75;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PROGRESS BAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.progress-bar {
  position:fixed; top:0; left:0; height:2px;
  background: linear-gradient(90deg, var(--accent), #a78bfa, var(--accent));
  width:0%; z-index:200;
  transition: width 0.15s linear;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SIDEBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.sidebar {
  width:var(--sidebar-width);
  min-height:100vh;
  background:var(--bg-secondary);
  border-right:1px solid var(--border);
  position:fixed; top:0; left:0;
  height:100vh; overflow-y:auto; z-index:100;
  display:flex; flex-direction:column;
}

.sidebar-header {
  padding:28px 22px 18px;
  border-bottom:1px solid var(--border);
  position:sticky; top:0;
  background:var(--bg-secondary); z-index:1;
}

.sidebar-logo {
  display:flex; align-items:center; gap:12px;
  text-decoration:none;
}

.logo-icon {
  width:38px; height:38px;
  background:linear-gradient(135deg, #6366f1, #8b5cf6);
  border-radius:9px;
  display:flex; align-items:center; justify-content:center;
  box-shadow: 0 2px 12px rgba(99,102,241,0.3);
}

.logo-icon svg { width:20px; height:20px; stroke:#fff; fill:none; stroke-width:1.8; }

.logo-text {
  font-family:var(--font-heading);
  font-weight:700; font-size:17px;
  color:var(--text-primary); letter-spacing:-0.5px;
}

.logo-sub {
  font-size:10.5px; color:var(--text-tertiary);
  font-weight:400; font-family:var(--font-body); margin-top:1px;
}

.sidebar-version {
  margin-top:14px; display:inline-flex;
  align-items:center; gap:6px;
  background:var(--accent-muted);
  border:1px solid rgba(99,102,241,0.2);
  border-radius:20px; padding:3px 10px;
  font-size:10.5px; color:var(--accent);
  font-family:var(--font-mono); font-weight:500;
}

.ver-dot {
  width:6px; height:6px; background:var(--green);
  border-radius:50%; animation:pulse 2.2s infinite;
}

@keyframes pulse {
  0%,100%{opacity:1} 50%{opacity:0.35}
}

/* Nav */
.sidebar-nav { flex:1; padding:14px 10px; }

.nav-section-label {
  font-size:9.5px; text-transform:uppercase;
  letter-spacing:1.4px; color:var(--text-tertiary);
  padding:18px 12px 5px; font-weight:600;
  font-family:var(--font-mono);
}

.nav-item {
  display:flex; align-items:center;
  padding:6px 12px; border-radius:6px;
  text-decoration:none; color:var(--text-secondary);
  font-size:13px; font-weight:400;
  transition:all 0.18s; position:relative;
  white-space:nowrap; overflow:hidden;
  text-overflow:ellipsis; gap:8px;
}

.nav-item:hover { background:var(--bg-tertiary); color:var(--text-primary); }

.nav-item.active {
  background:var(--accent-muted);
  color:var(--accent); font-weight:500;
}

.nav-item.active::before {
  content:''; position:absolute; left:0; top:50%;
  transform:translateY(-50%);
  width:2.5px; height:16px;
  background:var(--accent); border-radius:0 2px 2px 0;
}

.nav-num {
  color:var(--text-tertiary); font-size:10.5px;
  font-family:var(--font-mono); min-width:20px;
  text-align:right; flex-shrink:0;
}

.nav-sub { padding-left:10px; }
.nav-sub .nav-item { font-size:12.5px; padding:4.5px 12px; color:var(--text-tertiary); }
.nav-sub .nav-item:hover { color:var(--text-secondary); }
.nav-sub .nav-item.active { color:var(--accent); background:var(--accent-muted); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ MAIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.main {
  margin-left:var(--sidebar-width);
  max-width:1020px; width:100%;
  padding:64px 64px 140px;
  position:relative; z-index:1;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.hero { margin-bottom:68px; position:relative; }

.hero-glow {
  position:absolute; top:-80px; left:-120px;
  width:520px; height:340px;
  background:radial-gradient(ellipse, rgba(99,102,241,0.07) 0%, transparent 68%);
  pointer-events:none;
}

.hero-badge {
  display:inline-flex; align-items:center; gap:6px;
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:20px; padding:4px 12px;
  font-size:11px; color:var(--text-secondary);
  margin-bottom:22px; font-family:var(--font-mono);
}

.hero-badge .dot {
  width:6px; height:6px; background:var(--green);
  border-radius:50%; animation:pulse 2.2s infinite;
}

.hero h1 {
  font-family:var(--font-heading); font-size:56px;
  font-weight:800; letter-spacing:-2.2px;
  line-height:1.08; color:#fff; margin-bottom:14px;
}

.hero h1 .grad {
  background:linear-gradient(135deg, #818cf8 0%, #a78bfa 50%, #6366f1 100%);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text;
}

.hero-subtitle {
  font-size:18px; color:var(--text-secondary);
  font-weight:300; max-width:560px; line-height:1.65;
}

.hero-meta {
  margin-top:24px; display:flex; gap:24px; flex-wrap:wrap;
}

.hero-meta-item {
  display:flex; align-items:center; gap:5px;
  font-size:11.5px; color:var(--text-tertiary);
  font-family:var(--font-mono);
}

.hero-meta-item .val { color:var(--text-secondary); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.section { margin-bottom:52px; }

.section-divider {
  height:1px;
  background:linear-gradient(90deg, transparent 0%, var(--border) 30%, var(--border) 50%, transparent 100%);
  background-size:200% 100%;
  margin:44px 0;
  animation:shimmer 4s ease-in-out infinite;
}

h2 {
  font-family:var(--font-heading); font-size:30px;
  font-weight:700; color:#fff; letter-spacing:-0.8px;
  margin-bottom:10px; margin-top:4px;
  display:flex; align-items:center; gap:10px;
  position:relative;
}

h2 .anchor {
  color:var(--text-tertiary); font-size:17px;
  text-decoration:none; opacity:0; transition:opacity 0.2s;
  font-family:var(--font-mono);
}
h2:hover .anchor { opacity:0.6; }

h3 {
  font-family:var(--font-heading); font-size:22px;
  font-weight:600; color:var(--text-primary);
  letter-spacing:-0.4px; margin:26px 0 9px;
}

h4 {
  font-family:var(--font-heading); font-size:17.5px;
  font-weight:600; color:var(--text-primary);
  margin:18px 0 7px;
}

p { color:var(--text-secondary); margin-bottom:15px; font-weight:300; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.ci {
  font-family:var(--font-mono); font-size:13px;
  background:var(--bg-code); border:1px solid var(--border);
  color:var(--accent-hover); padding:2px 6px;
  border-radius:4px; white-space:nowrap;
}

.code-block {
  background:var(--bg-code); border:1px solid var(--border);
  border-radius:10px; margin:14px 0 18px; overflow:hidden;
  transition:border-color 0.25s, box-shadow 0.25s;
}
.code-block:hover {
  border-color:rgba(99,102,241,0.35);
  box-shadow:0 0 18px rgba(99,102,241,0.08);
}

.cb-head {
  display:flex; align-items:center; padding:9px 14px;
  background:var(--bg-tertiary);
  border-bottom:1px solid var(--border); gap:5px;
}

.cd { width:11px; height:11px; border-radius:50%; }
.cd.r{background:#f87171} .cd.y{background:#fbbf24} .cd.g{background:#34d399}

.cb-label {
  font-family:var(--font-mono); font-size:10.5px;
  color:var(--text-tertiary); margin-left:auto;
}

.code-block pre {
  padding:18px 22px; font-family:var(--font-mono);
  font-size:14px; line-height:1.8; color:var(--text-secondary);
  overflow-x:auto; white-space:pre;
}

.kw{color:#c084fc} .fn{color:#60a5fa} .str{color:#34d399}
.cmt{color:#3d4a66;font-style:italic} .val{color:#fb923c} .cls{color:#f472b6}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CALLOUTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.callout {
  border-radius:9px; padding:18px 20px; margin:20px 0;
  border-left:3px solid; position:relative;
  transition:border-color 0.22s, background 0.22s;
}

.callout-title {
  font-weight:600; font-size:13.5px; margin-bottom:5px;
  font-family:var(--font-body);
}

.callout p { font-size:15px; margin-bottom:0; }

.callout.tip { border-color:var(--green); background:rgba(52,211,153,0.06); }
.callout.tip .callout-title { color:var(--green); }

.callout.warning { border-color:var(--amber); background:rgba(251,191,36,0.06); }
.callout.warning .callout-title { color:var(--amber); }

.callout.info { border-color:var(--blue); background:rgba(96,165,250,0.06); }
.callout.info .callout-title { color:var(--blue); }

.callout.note { border-color:var(--accent); background:var(--accent-muted); }
.callout.note .callout-title { color:var(--accent); }

.callout.tip:hover { background:rgba(52,211,153,0.1); border-color:rgba(52,211,153,0.45); }
.callout.warning:hover { background:rgba(251,191,36,0.1); border-color:rgba(251,191,36,0.45); }
.callout.info:hover { background:rgba(96,165,250,0.1); border-color:rgba(96,165,250,0.45); }
.callout.note:hover { background:rgba(99,102,241,0.14); border-color:rgba(99,102,241,0.4); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TABLES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.tw {
  overflow-x:auto; margin:18px 0;
  border-radius:9px; border:1px solid var(--border);
  position:relative;
}

table { width:100%; border-collapse:collapse; font-size:14.5px; }

thead { background:var(--bg-tertiary); }

thead th {
  text-align:left; padding:11px 17px;
  color:var(--text-tertiary); font-weight:600;
  font-size:10.5px; text-transform:uppercase;
  letter-spacing:0.7px; border-bottom:1px solid var(--border);
  white-space:nowrap; font-family:var(--font-mono);
}

tbody tr {
  border-bottom:1px solid var(--border);
  transition:background 0.2s;
}
tbody tr:last-child { border-bottom:none; }
tbody tr:hover { background:rgba(99,102,241,0.07); }

tbody td {
  padding:11px 17px; color:var(--text-secondary);
  vertical-align:top; font-weight:300;
}
tbody td:first-child { color:var(--text-primary); font-weight:500; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ STEPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.steps { margin:18px 0; }

.step { display:flex; gap:16px; margin-bottom:18px; align-items:flex-start; }

.step-num {
  min-width:28px; height:28px;
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:6px; display:flex; align-items:center; justify-content:center;
  font-family:var(--font-mono); font-size:12px;
  color:var(--accent); font-weight:500; flex-shrink:0;
  transition:all 0.22s;
}
.step:hover .step-num {
  background:var(--accent-muted);
  border-color:var(--accent);
  box-shadow:0 0 10px rgba(99,102,241,0.2);
}

.step-content h4 { margin-top:2px; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FEATURE LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
ul.fl { list-style:none; margin:14px 0; }

ul.fl li {
  padding:7px 0 7px 18px; color:var(--text-secondary);
  font-size:15.5px; font-weight:300; line-height:1.75;
  position:relative;
}

ul.fl li::before {
  content:''; width:5px; height:5px;
  background:var(--accent); border-radius:50%;
  position:absolute; left:0;
  top:calc(7px + (1.75em - 5px) / 2);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ CHECKLIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
ul.cl { list-style:none; margin:14px 0; }

ul.cl li {
  padding:6px 0; color:var(--text-secondary);
  font-size:15.5px; display:flex;
  align-items:flex-start; gap:9px;
}

.chk {
  width:17px; height:17px; min-width:17px;
  border:2px solid var(--green); border-radius:4px;
  display:flex; align-items:center; justify-content:center;
  margin-top:2px; flex-shrink:0;
}

.chk svg { width:9px; height:9px; stroke:var(--green); fill:none; stroke-width:3; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ PRIORITY BADGES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.pri {
  display:inline-flex; align-items:center;
  font-size:10.5px; font-family:var(--font-mono);
  padding:2px 7px; border-radius:4px; font-weight:500;
}
.pri.hi { background:rgba(248,113,113,0.1); color:var(--red); border:1px solid rgba(248,113,113,0.2); }
.pri.md { background:rgba(251,191,36,0.1); color:var(--amber); border:1px solid rgba(251,191,36,0.2); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROADMAP CARDS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rcard {
  background:var(--bg-tertiary); border:1px solid var(--border);
  border-radius:10px; padding:20px; margin:10px 0;
  transition:border-color 0.28s, box-shadow 0.28s, transform 0.28s;
}
.rcard:hover {
  border-color:rgba(99,102,241,0.45);
  box-shadow:0 4px 24px rgba(99,102,241,0.1);
  transform:translateY(-2px);
}

.rcard-head {
  display:flex; align-items:center;
  justify-content:space-between; margin-bottom:8px;
  flex-wrap:wrap; gap:8px;
}

.rcard h4 { margin:0; font-size:16px; }
.rcard p { font-size:14.5px; margin-bottom:0; }

.rbadge {
  font-size:10px; font-family:var(--font-mono);
  padding:3px 8px; border-radius:4px; font-weight:500;
}
.rbadge.up { background:rgba(99,102,241,0.12); color:var(--accent); border:1px solid rgba(99,102,241,0.2); }
.rbadge.lt { background:rgba(96,165,250,0.1); color:var(--blue); border:1px solid rgba(96,165,250,0.15); }
.rbadge.ct { background:rgba(52,211,153,0.1); color:var(--green); border:1px solid rgba(52,211,153,0.15); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCROLLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
::-webkit-scrollbar { width:5px; }
::-webkit-scrollbar-track { background:transparent; }
::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
::-webkit-scrollbar-thumb:hover { background:var(--border-hover); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ BACK TO TOP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.b2t {
  position:fixed; bottom:28px; right:28px;
  width:38px; height:38px;
  background:var(--bg-secondary); border:1px solid var(--border);
  border-radius:8px; display:flex; align-items:center; justify-content:center;
  cursor:pointer; opacity:0; transform:translateY(8px);
  transition:all 0.3s; z-index:50;
  text-decoration:none; color:var(--text-secondary);
}
.b2t.vis { opacity:1; transform:translateY(0); }
.b2t:hover { border-color:var(--accent); color:var(--accent); }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer {
  border-top:1px solid var(--border);
  padding-top:28px; margin-top:32px;
}
.footer p { font-size:11.5px; color:var(--text-tertiary); margin:0; }

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RESPONSIVE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@media(max-width:1050px){
  .sidebar{display:none}
  .main{margin-left:0;padding:32px 24px 80px}
  .hero h1{font-size:40px}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SCROLL REVEAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.reveal {
  opacity:0;
  transform:translateY(22px);
  transition:opacity 0.55s cubic-bezier(.22,.68,0,1.2), transform 0.55s cubic-bezier(.22,.68,0,1.2);
}
.reveal.visible {
  opacity:1;
  transform:translateY(0);
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SECTION DIVIDER SHIMMER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
@keyframes shimmer {
  0%{background-position:200% 0}
  100%{background-position:-200% 0}
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ FILES EDITED TABLE (advanced layer section) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.files-grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  margin:14px 0 20px;
}
.file-pill {
  background:var(--bg-tertiary);
  border:1px solid var(--border);
  border-radius:7px;
  padding:10px 14px;
  display:flex; align-items:center; gap:9px;
  transition:border-color 0.2s, background 0.2s;
}
.file-pill:hover {
  border-color:rgba(99,102,241,0.35);
  background:rgba(99,102,241,0.06);
}
.file-pill-icon {
  width:28px; height:28px; border-radius:5px;
  display:flex; align-items:center; justify-content:center;
  font-size:11px; font-family:var(--font-mono);
  font-weight:600; flex-shrink:0;
}
.fp-enum { background:rgba(244,114,182,0.12); color:#f472b6; }
.fp-struct { background:rgba(251,191,36,0.12); color:#fbbf24; }
.fp-bp { background:rgba(96,165,250,0.12); color:#60a5fa; }
.fp-da { background:rgba(52,211,153,0.12); color:#34d399; }
.file-pill-text { font-size:12.5px; color:var(--text-secondary); font-family:var(--font-mono); }
.file-pill-label { font-size:10px; color:var(--text-tertiary); display:block; margin-top:1px; font-family:var(--font-body); }

@media(max-width:680px){
  .files-grid { grid-template-columns:1fr; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
/* âœ¨  VISUAL POLISH                                   */
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* â”€â”€ Background Orbs â”€â”€ */
.bg-orbs {
  position:fixed; inset:0;
  pointer-events:none; z-index:0;
  overflow:hidden;
}
.orb {
  position:absolute; border-radius:50%;
}
.orb-1 {
  width:680px; height:680px;
  top:-220px; right:-160px;
  background:radial-gradient(circle, rgba(99,102,241,0.065) 0%, transparent 60%);
  filter:blur(80px);
  animation:orbFloat1 22s ease-in-out infinite;
}
.orb-2 {
  width:500px; height:500px;
  bottom:-180px; left:10%;
  background:radial-gradient(circle, rgba(139,92,246,0.045) 0%, transparent 60%);
  filter:blur(70px);
  animation:orbFloat2 30s ease-in-out infinite;
}
.orb-3 {
  width:380px; height:380px;
  top:38%; left:58%;
  background:radial-gradient(circle, rgba(56,189,248,0.035) 0%, transparent 60%);
  filter:blur(60px);
  animation:orbFloat3 26s ease-in-out infinite;
}
@keyframes orbFloat1 {
  0%,100%{ transform:translate(0,0) scale(1); }
  35%{ transform:translate(-70px, 90px) scale(1.08); }
  70%{ transform:translate(50px, -50px) scale(0.96); }
}
@keyframes orbFloat2 {
  0%,100%{ transform:translate(0,0) scale(1); }
  50%{ transform:translate(80px, -70px) scale(1.1); }
}
@keyframes orbFloat3 {
  0%,100%{ transform:translate(0,0) scale(1); }
  40%{ transform:translate(-55px, -40px) scale(1.05); }
  70%{ transform:translate(40px, 50px) scale(0.95); }
}

/* â”€â”€ Hero Glow Pulse â”€â”€ */
.hero-glow {
  animation:heroGlowPulse 8s ease-in-out infinite alternate;
}
@keyframes heroGlowPulse {
  0%{ opacity:0.7; transform:scale(1) translate(0,0); }
  100%{ opacity:1; transform:scale(1.2) translate(-18px, 12px); }
}

/* â”€â”€ Hero Second Orb (right side) â”€â”€ */
.hero-glow-2 {
  position:absolute; top:-20px; right:-40px;
  width:280px; height:220px;
  background:radial-gradient(ellipse, rgba(139,92,246,0.065) 0%, transparent 65%);
  pointer-events:none;
  animation:heroGlow2Pulse 10s ease-in-out infinite alternate;
}
@keyframes heroGlow2Pulse {
  0%{ opacity:0.5; transform:scale(0.93) translate(0,0); }
  100%{ opacity:1; transform:scale(1.18) translate(12px, -10px); }
}

/* â”€â”€ h2 Animated Underline â”€â”€ */
h2::after {
  content:'';
  position:absolute; left:0; bottom:-5px;
  height:2px; width:0;
  background:linear-gradient(90deg, var(--accent), #a78bfa 55%, transparent);
  border-radius:1px;
  transition:width 0.7s cubic-bezier(.22,.68,0,1.2) 0.2s;
}
.section.reveal.visible h2::after { width:90px; }

/* â”€â”€ Traffic Light Dots Glow â”€â”€ */
.cd.r { box-shadow:0 0 5px rgba(248,113,113,0.55); }
.cd.y { box-shadow:0 0 5px rgba(251,191,36,0.5); }
.cd.g { box-shadow:0 0 5px rgba(52,211,153,0.55); }

/* â”€â”€ Active Nav Indicator Glow â”€â”€ */
.nav-item.active::before {
  box-shadow:0 0 8px 1px rgba(99,102,241,0.5);
}

/* â”€â”€ Table Top Gradient Accent â”€â”€ */
.tw::before {
  content:'';
  position:absolute; top:0; left:0; right:0; height:2px;
  background:linear-gradient(90deg, var(--accent), #a78bfa 50%, transparent);
  border-radius:9px 9px 0 0;
  opacity:0.55;
}

/* â”€â”€ Inline Code (.ci) Hover Glow â”€â”€ */
.ci { transition:border-color 0.2s, box-shadow 0.2s; }
.ci:hover {
  border-color:rgba(99,102,241,0.42);
  box-shadow:0 0 8px rgba(99,102,241,0.15);
}

/* â”€â”€ Callout Left Border Inner Glow â”€â”€ */
.callout::before {
  content:'';
  position:absolute; left:0; top:0; bottom:0; width:55px;
  border-radius:9px 0 0 9px;
  pointer-events:none;
  opacity:0.07;
  transition:opacity 0.22s;
}
.callout.tip::before    { background:linear-gradient(90deg, var(--green), transparent); }
.callout.warning::before { background:linear-gradient(90deg, var(--amber), transparent); }
.callout.info::before   { background:linear-gradient(90deg, var(--blue), transparent); }
.callout.note::before   { background:linear-gradient(90deg, var(--accent), transparent); }
.callout:hover::before  { opacity:0.15; }

/* â”€â”€ Step Number Gradient Background â”€â”€ */
.steps .step-num {
  background:linear-gradient(135deg, var(--bg-tertiary), rgba(99,102,241,0.14));
}

/* â”€â”€ Back to Top Glow â”€â”€ */
.b2t:hover {
  box-shadow:0 0 18px rgba(99,102,241,0.3);
}

/* â”€â”€ Sidebar Bottom Fade â”€â”€ */
.sidebar::after {
  content:'';
  position:absolute; bottom:0; left:0; right:0; height:70px;
  background:linear-gradient(to top, rgba(14,18,32,0.95), transparent);
  pointer-events:none; z-index:2;
}

</style>
</head>
<body>

<!-- â”€â”€ Background Orbs â”€â”€ -->
<div class="bg-orbs" aria-hidden="true">
  <div class="orb orb-1"></div>
  <div class="orb orb-2"></div>
  <div class="orb orb-3"></div>
</div>

<div class="progress-bar" id="progressBar"></div>

<!-- â•â•â•â•â•â•â•â•â•â•â• SIDEBAR â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="sidebar">
  <div class="sidebar-header">
    <a class="sidebar-logo" href="#top">
      <div class="logo-icon">
        <svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
      </div>
      <div>
        <div class="logo-text">BeatSyncToolkit</div>
        <div class="logo-sub">Adaptive Music Conductor Â· UE5</div>
      </div>
    </a>
    <div class="sidebar-version"><span class="ver-dot"></span> v1.1 Â· 2026-02-01</div>
  </div>

  <div class="sidebar-nav">
    <div class="nav-section-label">Documentation</div>
    <a href="#s1"  class="nav-item" data-id="s1"><span class="nav-num">01</span> What It Does</a>
    <a href="#s2"  class="nav-item" data-id="s2"><span class="nav-num">02</span> Quick Start</a>
    <a href="#s3"  class="nav-item" data-id="s3"><span class="nav-num">03</span> Included Assets</a>
    <a href="#s4"  class="nav-item" data-id="s4"><span class="nav-num">04</span> Core Concepts</a>
    <div class="nav-sub">
      <a href="#s4-1" class="nav-item" data-id="s4-1">Conductor Actor</a>
      <a href="#s4-2" class="nav-item" data-id="s4-2">Profiles â†’ States â†’ Playlists</a>
      <a href="#s4-3" class="nav-item" data-id="s4-3">Layers (Stems)</a>
      <a href="#s4-4" class="nav-item" data-id="s4-4">Beat/Bar Clock</a>
      <a href="#s4-5" class="nav-item" data-id="s4-5">Zones</a>
    </div>
    <a href="#s5"  class="nav-item" data-id="s5"><span class="nav-num">05</span> Music Profiles</a>
    <div class="nav-sub">
      <a href="#s5-5" class="nav-item" data-id="s5-5">Adding a New State</a>
      <a href="#s5-6" class="nav-item" data-id="s5-6">Adding a Custom Layer</a>
    </div>
    <a href="#s6"  class="nav-item" data-id="s6"><span class="nav-num">06</span> Gameplay API</a>
    <a href="#s7"  class="nav-item" data-id="s7"><span class="nav-num">07</span> Conductor Settings</a>
    <a href="#s8"  class="nav-item" data-id="s8"><span class="nav-num">08</span> Zone System</a>
    <a href="#s9"  class="nav-item" data-id="s9"><span class="nav-num">09</span> Arbitration Rules</a>
    <a href="#s10" class="nav-item" data-id="s10"><span class="nav-num">10</span> Quantization</a>
    <a href="#s11" class="nav-item" data-id="s11"><span class="nav-num">11</span> Playlist & Track Lock</a>
    <a href="#s12" class="nav-item" data-id="s12"><span class="nav-num">12</span> Practical Examples</a>
    <a href="#s13" class="nav-item" data-id="s13"><span class="nav-num">13</span> Debugging</a>
    <a href="#s14" class="nav-item" data-id="s14"><span class="nav-num">14</span> Not Included</a>
    <a href="#s15" class="nav-item" data-id="s15"><span class="nav-num">15</span> Advanced Reference</a>
    <a href="#s16" class="nav-item" data-id="s16"><span class="nav-num">16</span> Roadmap</a>
  </div>
</nav>

<!-- â•â•â•â•â•â•â•â•â•â•â• MAIN CONTENT â•â•â•â•â•â•â•â•â•â•â• -->
<main class="main" id="top">

<!-- â”€â”€â”€ HERO â”€â”€â”€ -->
<div class="hero">
  <div class="hero-glow"></div>
  <div class="hero-glow-2"></div>
  <div class="hero-badge"><span class="dot"></span> UE5 Blueprint Â· No Quartz Required</div>
  <h1>Beat<span class="grad">Sync</span>Toolkit</h1>
  <p class="hero-subtitle">Beat/Bar-Synced Adaptive Music Conductor for Unreal Engine 5. Drive your game's music reactively from Blueprint â€” state transitions, layered stems, zones, and quantized timing. All without a custom GameInstance.</p>
  <div class="hero-meta">
    <div class="hero-meta-item"><span>Version</span>&nbsp;<span class="val">v1.1</span></div>
    <div class="hero-meta-item"><span>Engine</span>&nbsp;<span class="val">UE 5.5.x</span></div>
    <div class="hero-meta-item"><span>Type</span>&nbsp;<span class="val">Blueprint-First</span></div>
    <div class="hero-meta-item"><span>Date</span>&nbsp;<span class="val">2026-02-01</span></div>
  </div>
</div>

<!-- â•â•â• 1 â•â•â• -->
<section class="section" id="s1">
  <h2><a class="anchor" href="#s1">#</a> 1. What BeatSyncToolkit Does</h2>
  <p>BeatSyncToolkit lets you drive adaptive music in Unreal Engine using gameplay-friendly Blueprint nodes. It provides beat/bar timing, state-based music selection with per-state playlists, optional stem layers, and a zone system that can override the global music state and add extra layers â€” all without requiring a custom GameInstance.</p>

  <h3>Key Features</h3>
  <ul class="fl">
    <li>Beat/bar clock (Timer-based) with an <span class="ci">OnBar</span> event for quantized changes â€” no Quartz dependency.</li>
    <li>State system (<span class="ci">E_BST_MusicState</span>): switch music by gameplay state, optionally quantized to the next bar. New states can be added by extending the enum + defining a matching StateConfig in your profile â€” see <a href="#s5-5" style="color:var(--accent);text-decoration:none;">Adding a New State</a>.</li>
    <li>Per-state playlist: each state can contain multiple tracks; auto-advance to the next track when the current ends.</li>
    <li>Two-base crossfade playback (Base A / Base B) for smooth transitions between tracks and states.</li>
    <li>Optional stem layers (<span class="ci">E_BST_MusicLayer</span>: Drums, Bass, Harmony, Melody, FX). Layers are always started muted and faded in/out â€” no restart.</li>
    <li>Event-based layers: add/remove/clear layers via global Blueprint nodes (<span class="ci">BFL_BST</span>) with optional next-bar quantization.</li>
    <li>Multi-layer event calls: add any number of layers in one node (array input), with optional next-bar quantization.</li>
    <li>Start/Stop Music: optionally start silent and trigger <span class="ci">BST_StartMusic</span> / <span class="ci">BST_StopMusic</span> from gameplay or demo interactions.</li>
    <li>Zone system (<span class="ci">BP_BST_MusicZone</span>): priority-based TopZone selection, zone state override, extra layers, and optional per-zone profile override.</li>
    <li>Zone + event layer arbitration: effective layers are the OR combination of zone layers and event layers.</li>
    <li>Quantized zone layer updates: zone layer changes can be applied immediately or on the next bar.</li>
    <li>Playlist Track Lock: lock the currently playing track so it restarts instead of advancing â€” event-based and optional zone-based.</li>
    <li>Low-friction UX: all gameplay calls go through a Blueprint Function Library. No manual Conductor references required.</li>
  </ul>

  <h3>What You Need to Place in Your Level</h3>
  <div class="callout info">
    <div class="callout-title">ğŸ“Œ Required Actors</div>
    <p><span class="ci">BP_BST_Conductor</span> â€” exactly one Conductor Actor in the level. This is the only mandatory placement. Optionally add one or more <span class="ci">BP_BST_MusicZone</span> actors for zone-based overrides and layer additions.</p>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 2 â•â•â• -->
<section class="section" id="s2">
  <h2><a class="anchor" href="#s2">#</a> 2. Quick Start</h2>
  <p>Get BeatSyncToolkit up and running in about 10 minutes.</p>

  <div class="callout info">
    <div class="callout-title">âš¡ TL;DR Quick Setup</div>
    <ul class="fl" style="margin-top:10px">
      <li>Place exactly one <span class="ci">BP_BST_Conductor</span> in the level.</li>
      <li>Assign <span class="ci">ActiveProfile</span> and pick an <span class="ci">AutoStartState</span>.</li>
      <li>Either enable <span class="ci">bStartOnBeginPlay</span> <em>or</em> start silent and call <span class="ci">BST_StartMusic</span>.</li>
      <li>Control music from anywhere using <span class="ci">BFL_BST</span> (states, layers, quantize, track lock, start/stop).</li>
    </ul>
  </div>

  <div class="steps">
    <div class="step">
      <div class="step-num">1</div>
      <div class="step-content">
        <h4>Add Content</h4>
        <p>Add or import the BeatSyncToolkit content folder into your project â€” keep the folder structure intact. Open or create a test level. Drag <span class="ci">BP_BST_Conductor</span> into the level <em>(recommended: exactly one Conductor per level/world)</em>.</p>
      </div>
    </div>
    <div class="step">
      <div class="step-num">2</div>
      <div class="step-content">
        <h4>Assign a Profile & Auto-Start</h4>
        <p>Select <span class="ci">BP_BST_Conductor</span> in the level. If you want music to start automatically, enable <span class="ci">bStartOnBeginPlay</span>. For demos, disable it and call <span class="ci">BST_StartMusic</span> when the player is ready.</p>
        <p>In Details â†’ BST â†’ Profile, set <span class="ci">ActiveProfile</span> to <span class="ci">DA_BST_MusicProfile_Default</span> and set <span class="ci">AutoStartState</span> (e.g. Explore). Press Play â€” the Conductor starts the chosen state, initializes the beat clock from the track's BPM/BPB, and begins playback.</p>
      </div>
    </div>
    <div class="step">
      <div class="step-num">3</div>
      <div class="step-content">
        <h4>Drive Music from Gameplay (No References)</h4>
        <p>From any Blueprint, call the global nodes in <span class="ci">BFL_BST</span>. The <span class="ci">WorldContextObject</span> input is all that's needed â€” no manual Conductor references.</p>
        <div class="code-block">
          <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BFL_BST Â· Core Nodes</span></div>
          <pre><span class="fn">BST_StartMusic</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_StopMusic</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_SetMusicState</span>(<span class="cls">WorldContextObject</span>, <span class="val">NewState</span>)
<span class="fn">BST_AddLayer</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layer</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_AddLayers</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layers[]</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_RemoveLayer</span>(<span class="cls">WorldContextObject</span>, <span class="val">Layer</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_ClearLayers</span>(<span class="cls">WorldContextObject</span>, <span class="val">QuantizeToNextBar</span>)
<span class="fn">BST_LockCurrentTrack</span>(<span class="cls">WorldContextObject</span>)
<span class="fn">BST_UnlockCurrentTrack</span>(<span class="cls">WorldContextObject</span>)</pre>
        </div>
      </div>
    </div>
    <div class="step">
      <div class="step-num">4</div>
      <div class="step-content">
        <h4>Add Zones (Optional)</h4>
        <p>Drag <span class="ci">BP_BST_MusicZone</span> into the level and scale its Box Collision to cover an area. Set <span class="ci">ZonePriority</span> (higher wins when zones overlap). Optionally set <span class="ci">ZoneState</span> to override the global state, and fill <span class="ci">ExtraLayers</span> to add layers while inside. Press Play and walk into the zone to see changes in action.</p>
      </div>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 3 â•â•â• -->
<section class="section" id="s3">
  <h2><a class="anchor" href="#s3">#</a> 3. Included Assets & Files</h2>
  <div class="callout tip">
    <div class="callout-title">ğŸ’¡ Folder Structure</div>
    <p>Keep the content folder structure intact so all internal references (profiles, actors, enums, structs) remain valid. The system is Blueprint-first and does not require a plugin build step.</p>
  </div>
  <div class="tw">
    <table>
      <thead><tr><th>Type</th><th>Name</th><th>Purpose</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">Blueprint Actor</span></td><td><span class="ci">BP_BST_Conductor</span></td><td>Main runtime brain. Holds the beat clock, current state/track, playback components, layers, zones, and all arbitration logic.</td></tr>
        <tr><td><span class="ci">Blueprint Actor</span></td><td><span class="ci">BP_BST_MusicZone</span></td><td>Overlap-triggered zone: override state, add extra layers, override profile, and optionally influence zone quantization / track lock.</td></tr>
        <tr><td><span class="ci">Function Library</span></td><td><span class="ci">BFL_BST</span></td><td>Global gameplay-facing API. Finds the Conductor and forwards state / layer / lock requests.</td></tr>
        <tr><td><span class="ci">Data Asset</span></td><td><span class="ci">DA_BST_MusicProfile_Default</span></td><td>Example profile containing StateConfigs and Track playlists.</td></tr>
        <tr><td><span class="ci">Blueprint (Base)</span></td><td><span class="ci">PDA_BST_MusicProfile_Base</span></td><td>Base class type used by the Conductor for profile assets.</td></tr>
        <tr><td><span class="ci">Enum</span></td><td><span class="ci">E_BST_MusicState</span></td><td>Music states (e.g. Explore, Combat). Extend by adding new entries â€” see <a href="#s5-5" style="color:var(--accent);text-decoration:none;">Adding a New State</a>.</td></tr>
        <tr><td><span class="ci">Enum</span></td><td><span class="ci">E_BST_MusicLayer</span></td><td>Fixed layer set: Drums, Bass, Harmony, Melody, FX.</td></tr>
        <tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_TrackEntry</span></td><td>One track: BaseSound + BPM / BPB + optional layer defs for each layer.</td></tr>
        <tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_StateConfig</span></td><td>One state configuration: the state enum + its playlist of TrackEntry items.</td></tr>
        <tr><td><span class="ci">Struct</span></td><td><span class="ci">F_BST_LayerDef</span></td><td>Per-layer definition inside TrackEntry: an optional Sound asset and a target volume.</td></tr>
        <tr><td><span class="ci">Internal</span></td><td><span class="ci">Pending Layer Queues</span></td><td>Quantized layer ops are implemented via pending arrays / flags processed on <span class="ci">BST_OnBar</span>. No asset â€” runtime only.</td></tr>
      </tbody>
    </table>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 4 â•â•â• -->
<section class="section" id="s4">
  <h2><a class="anchor" href="#s4">#</a> 4. Core Concepts</h2>

  <div id="s4-1">
    <h3>4.1 Conductor Actor</h3>
    <p><span class="ci">BP_BST_Conductor</span> is the single authority that decides what music is playing. You place it manually in the level â€” it does not auto-spawn. Gameplay code never stores references to it. Instead, calls go through <span class="ci">BFL_BST</span>, which finds the Conductor in the current world and forwards the request.</p>
  </div>

  <div id="s4-2">
    <h3>4.2 Profiles â†’ States â†’ Playlists â†’ Tracks</h3>
    <p>A <strong style="color:var(--text-primary)">Music Profile</strong> is a data asset that maps each Music State to a playlist of TrackEntry items.</p>
    <div class="code-block">
      <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Data Hierarchy</span></div>
      <pre><span class="cls">Profile</span>  (DA_BST_MusicProfile)
  â””â”€â”€ <span class="cls">StateConfig</span>  (F_BST_StateConfig)
        â”œâ”€â”€ State:  <span class="val">E_BST_MusicState</span>   <span class="cmt">â† e.g. Explore, Combat</span>
        â””â”€â”€ Playlist:  <span class="fn">TrackEntry[]</span>
              â””â”€â”€ <span class="cls">TrackEntry</span>  (F_BST_TrackEntry)
                    â”œâ”€â”€ BaseSound      <span class="cmt">â† main audio (required)</span>
                    â”œâ”€â”€ BPM            <span class="cmt">â† beats per minute</span>
                    â”œâ”€â”€ BeatsPerBar    <span class="cmt">â† time signature</span>
                    â””â”€â”€ LayerDefs[]    <span class="cmt">â† optional stems</span></pre>
    </div>
  </div>

  <div id="s4-3">
    <h3>4.3 Layers (Stems)</h3>
    <p>Layers are optional stem audio components. If a TrackEntry provides a sound for a layer, the Conductor starts it immediately when the track begins â€” but at muted standby volume. Add/Remove operations only adjust volume (fade up/down) and do not restart audio.</p>
    <p>The fixed layer set is <span class="ci">Drums</span>, <span class="ci">Bass</span>, <span class="ci">Harmony</span>, <span class="ci">Melody</span>, <span class="ci">FX</span>. If a track has no stem for a layer, that layer is safely ignored.</p>
    <h4>Gameplay Layer Control (Event-Based)</h4>
    <p>Use <span class="ci">BFL_BST</span> layer nodes to add/remove/clear layers from any Blueprint. Each call includes a <span class="ci">QuantizeToNextBar</span> boolean to apply the change on the next bar, or fade right away.</p>
    <h4>Add Multiple Layers (Single Node)</h4>
    <p>Use <span class="ci">BST_AddLayers</span> with an array input to add 2, 3, or all layers at once. Supply the array using Make Array (<span class="ci">E_BST_MusicLayer</span>). Duplicates are ignored.</p>
  </div>

  <div id="s4-4">
    <h3>4.4 Beat/Bar Clock (No Quartz)</h3>
    <p>The Conductor maintains a beat clock using timers. Each beat advances <span class="ci">CurrentBeat</span>, and each bar fires <span class="ci">BST_OnBar</span>. Quantized operations â€” state changes and optional layer changes â€” are applied precisely on <span class="ci">BST_OnBar</span>.</p>
    <div class="callout tip">
      <div class="callout-title">ğŸ’¡ No Quartz Dependency</div>
      <p>BeatSyncToolkit uses its own timer-based clock instead of Unreal's Quartz system. Zero additional setup â€” just set BPM and BeatsPerBar in your TrackEntry and the clock handles the rest.</p>
    </div>
  </div>

  <div id="s4-5">
    <h3>4.5 Zones</h3>
    <p><span class="ci">BP_BST_MusicZone</span> is an overlap-based control layer. The Conductor tracks all zones the player is inside, selects a single TopZone by <span class="ci">ZonePriority</span>, and applies that zone's state override, extra layers, profile override, and optional track lock / quantization behavior.</p>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 5 â•â•â• -->
<section class="section" id="s5">
  <h2><a class="anchor" href="#s5">#</a> 5. Creating & Editing Music Profiles</h2>

  <h3>5.1 Create a Custom Profile</h3>
  <div class="steps">
    <div class="step"><div class="step-num">1</div><div class="step-content"><p>In the Content Browser, duplicate <span class="ci">DA_BST_MusicProfile_Default</span>.</p></div></div>
    <div class="step"><div class="step-num">2</div><div class="step-content"><p>Rename it â€” e.g. <span class="ci">DA_BST_MusicProfile_MyGame</span>.</p></div></div>
    <div class="step"><div class="step-num">3</div><div class="step-content"><p>Open your new profile. For each state you want to support, add or edit a StateConfig entry.</p></div></div>
  </div>

  <h3>5.2 Fill a StateConfig (Playlist)</h3>
  <p>In each StateConfig: set the State (<span class="ci">E_BST_MusicState</span>), add one or more TrackEntry items to the Tracks array, and provide accurate BPM and BeatsPerBar for each track.</p>

  <h3>5.3 Fill a TrackEntry</h3>
  <p>Each TrackEntry is the complete definition for one piece of music in a playlist.</p>
  <div class="tw">
    <table>
      <thead><tr><th>Field</th><th>Type</th><th>Meaning</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">BaseSound</span></td><td><span class="ci">SoundWave / SoundCue</span></td><td>Main full mix or main stem. Always required.</td></tr>
        <tr><td><span class="ci">BPM</span></td><td><span class="ci">Float</span></td><td>Beats per minute. Drives the beat/bar clock and all quantization.</td></tr>
        <tr><td><span class="ci">BeatsPerBar</span></td><td><span class="ci">Integer</span></td><td>Time signature in beats per bar (commonly 4).</td></tr>
        <tr><td><span class="ci">Drums / Bass / Harmony / Melody / FX</span></td><td><span class="ci">F_BST_LayerDef</span></td><td>Optional stems for each layer. Leave empty if you don't have that stem.</td></tr>
      </tbody>
    </table>
  </div>
  <div class="callout note">
    <div class="callout-title">ğŸµ Single WAV Use Case</div>
    <p>If you only have a single WAV with no stems, set <span class="ci">BaseSound</span> only and leave all layer sounds empty. You can still use state switching and playlists. Layer add/remove calls are safely ignored when the current track has no matching stem.</p>
  </div>

  <h3>5.4 Assign Profile to the Conductor</h3>
  <p>Select <span class="ci">BP_BST_Conductor</span> in your level. Set <span class="ci">ActiveProfile</span> to your custom profile asset. Set <span class="ci">AutoStartState</span> to the initial state. Press Play.</p>

  <div id="s5-5">
    <h3>5.5 Adding a New State</h3>
    <p>You can extend BeatSyncToolkit with your own states. The system uses a loop-based lookup â€” no hardcoded switch-case â€” so adding a new enum entry won't break any existing Blueprint graphs or pins.</p>

    <div class="callout warning">
      <div class="callout-title">âš ï¸ Enum alone is not enough</div>
      <p>Adding a new entry to <span class="ci">E_BST_MusicState</span> makes it appear in all BFL nodes immediately â€” but <strong style="color:var(--text-primary)">no music will play for that state</strong> until you also define a StateConfig with at least one track in your profile. The system won't crash â€” it simply won't switch, or will stay on the current track.</p>
    </div>

    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-content">
          <h4>Add the new entry to the enum</h4>
          <p>Open <span class="ci">E_BST_MusicState</span> and add your new state (e.g. <span class="ci">Stealth</span>). Save and compile. It will now appear as a selectable option in all BFL nodes across your project â€” automatically.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">2</div>
        <div class="step-content">
          <h4>Open your Music Profile</h4>
          <p>Open the profile Data Asset you're using (e.g. <span class="ci">DA_BST_MusicProfile_MyGame</span>).</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">3</div>
        <div class="step-content">
          <h4>Add a new StateConfig entry</h4>
          <p>In the StateConfigs array, add a new row. Set its <span class="ci">State</span> to your new enum value (e.g. <span class="ci">Stealth</span>).</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">4</div>
        <div class="step-content">
          <h4>Add at least one TrackEntry</h4>
          <p>Inside that StateConfig, add a TrackEntry to the Playlist array. At minimum, set <span class="ci">BaseSound</span>, <span class="ci">BPM</span>, and <span class="ci">BeatsPerBar</span>. Optionally add stem LayerDefs if your audio has them.</p>
        </div>
      </div>
      <div class="step">
        <div class="step-num">5</div>
        <div class="step-content">
          <h4>Save and test</h4>
          <p>Save the profile. Press Play and call <span class="ci">BST_SetMusicState(Stealth)</span> â€” the Conductor will find the new StateConfig via lookup and switch to it.</p>
        </div>
      </div>
    </div>

    <div class="callout tip">
      <div class="callout-title">ğŸ’¡ Why this works without breaking things</div>
      <p>The Conductor resolves states by searching through the StateConfig array at runtime â€” not via a switch-case baked into the Blueprint graph. This means adding a new <span class="ci">E_BST_MusicState</span> entry won't cause any pin breaks or compilation errors anywhere. The only requirement is a matching StateConfig in your active profile.</p>
    </div>
  </div>
  <div id="s5-6">
    <h3>5.6 Adding a Custom Layer</h3>
    <p>The five built-in layers (Drums, Bass, Harmony, Melody, FX) cover the vast majority of use cases. If your project needs a sixth layer â€” say <span class="ci">Percussion</span> â€” you can extend the system. This is an <strong style="color:var(--text-primary)">advanced operation</strong> that touches multiple files and requires understanding of how the Conductor's internal layer pipeline works.</p>

    <div class="callout warning">
      <div class="callout-title">âš ï¸ This is not a quick tweak</div>
      <p>Adding a custom layer means adding a new audio channel, a new stem slot in the track data, and wiring it into three separate Conductor functions. If you only need common stems (Drums / Bass / Harmony / Melody / FX), <strong style="color:var(--text-primary)">no changes are required</strong> â€” the system handles everything out of the box.</p>
    </div>

    <div class="steps">
      <div class="step">
        <div class="step-num">1</div>
        <div class="step-content">
          <h4>Add the new entry to the layer enum</h4>
          <p>Open <span class="ci">E_BST_MusicLayer</span> and add your new layer (e.g. <span class="ci">Percussion</span>). Save and compile. It will now appear as a selectable option in all BFL layer nodes automatically.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">2</div>
        <div class="step-content">
          <h4>Extend the track data struct</h4>
          <p>Open <span class="ci">F_BST_TrackEntry</span> and add a new field for the stem sound â€” e.g. <span class="ci">Percussion_Sound</span> (SoundBase or SoundWave). Every TrackEntry in your Music Profile can now optionally contain a Percussion stem.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">3</div>
        <div class="step-content">
          <h4>Add a dedicated AudioComponent in the Conductor</h4>
          <p>Open <span class="ci">BP_BST_Conductor</span> and add a new AudioComponent â€” e.g. <span class="ci">AC_Percussion</span>. Set it up the same way the existing layer components are configured (AC_Drums, AC_Bass, etc.). This gives the Conductor a dedicated playback channel for the new layer.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">4</div>
        <div class="step-content">
          <h4>Wire into the "Ensure" function</h4>
          <p>In <span class="ci">BP_BST_Conductor</span>, open <span class="ci">BST_EnsureLayerComponentsPlayingMuted</span>. Add a new block for Percussion that follows the same pattern as existing layers:</p>
          <div class="code-block">
            <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BST_EnsureLayerComponentsPlayingMuted</span></div>
            <pre><span class="kw">IF</span> CurrentTrack.<span class="val">Percussion_Sound</span> <span class="kw">is valid</span>
    AC_Percussion â†’ <span class="fn">SetSound</span>(<span class="val">Percussion_Sound</span>)  <span class="cmt">â† if not already set</span>
    AC_Percussion â†’ <span class="fn">Play</span>()
    AC_Percussion â†’ <span class="fn">SetVolumeParameter</span>(<span class="val">StandbyVolume</span>)   <span class="cmt">â† e.g. 0.01</span>
<span class="kw">ELSE</span>
    <span class="cmt">â† do not force-enable; let it settle to standby</span></pre>
          </div>
          <p>This ensures the Percussion stem is prepared (playing muted) on every state or track switch, exactly like the other stems.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">5</div>
        <div class="step-content">
          <h4>Wire into the layer gating function</h4>
          <p>In <span class="ci">BP_BST_Conductor</span>, open <span class="ci">BST_CurrentTrackHasLayerSound</span>. Add a new case:</p>
          <div class="code-block">
            <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BST_CurrentTrackHasLayerSound</span></div>
            <pre><span class="kw">IF</span> Layer == <span class="val">Percussion</span>
    <span class="kw">RETURN</span> <span class="fn">IsValid</span>(CurrentTrack.<span class="val">Percussion_Sound</span>)</pre>
          </div>
          <p>This is the gating check â€” the system will never try to "arm" a layer that doesn't exist in the current track.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">6</div>
        <div class="step-content">
          <h4>Wire into runtime layer application (fades)</h4>
          <p>In <span class="ci">BP_BST_Conductor</span>, open <span class="ci">BST_ApplyEventLayersNow</span>. Add a new block for Percussion:</p>
          <div class="code-block">
            <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">BST_ApplyEventLayersNow Â· Percussion block</span></div>
            <pre><span class="cmt">â† Percussion is enabled if ANY source requests it AND track has the stem:</span>
<span class="val">ShouldEnable</span> = (ZoneLayers <span class="kw">OR</span> EventLayers contains <span class="val">Percussion</span>)
                  <span class="kw">AND</span> <span class="fn">BST_CurrentTrackHasLayerSound</span>(<span class="val">Percussion</span>)

<span class="kw">IF</span> ShouldEnable
    AC_Percussion â†’ <span class="fn">AdjustVolume</span>(<span class="val">FadeTime</span>, <span class="val">TargetVolume</span>)
<span class="kw">ELSE</span>
    AC_Percussion â†’ <span class="fn">AdjustVolume</span>(<span class="val">FadeTime</span>, <span class="val">StandbyVolume</span>)</pre>
          </div>
          <p>After this, Percussion responds correctly to event-based layer nodes, zone-based layer arrays, and quantized changes â€” because the bar system calls ApplyEventLayersNow on every bar boundary.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">7</div>
        <div class="step-content">
          <h4>Multi-layer add â€” nothing extra needed</h4>
          <p>If your existing multi-layer add function (<span class="ci">BST_AddEventLayers</span>) uses an enum-based loop, the new Percussion entry is automatically supported â€” as long as steps 5 and 6 are done. No changes required here.</p>
        </div>
      </div>

      <div class="step">
        <div class="step-num">8</div>
        <div class="step-content">
          <h4>Fill in the stem in your Music Profile</h4>
          <p>Open any <span class="ci">DA_BST_MusicProfile_*</span> Data Asset. For every TrackEntry that should support Percussion, fill in the <span class="ci">Percussion_Sound</span> field with the actual stem audio. Tracks where you leave it empty will simply not arm Percussion â€” no errors.</p>
        </div>
      </div>
    </div>

    <h3>Files You Will Edit</h3>
    <div class="files-grid">
      <div class="file-pill">
        <div class="file-pill-icon fp-enum">EN</div>
        <div><div class="file-pill-text">E_BST_MusicLayer</div><div class="file-pill-label">New enum entry</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-struct">ST</div>
        <div><div class="file-pill-text">F_BST_TrackEntry</div><div class="file-pill-label">New stem field</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-bp">BP</div>
        <div><div class="file-pill-text">BP_BST_Conductor</div><div class="file-pill-label">New AudioComponent</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-bp">FN</div>
        <div><div class="file-pill-text">EnsureLayerComponentsPlayingMuted</div><div class="file-pill-label">Stem prepare block</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-bp">FN</div>
        <div><div class="file-pill-text">CurrentTrackHasLayerSound</div><div class="file-pill-label">Gating check</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-bp">FN</div>
        <div><div class="file-pill-text">ApplyEventLayersNow</div><div class="file-pill-label">Fade logic</div></div>
      </div>
      <div class="file-pill">
        <div class="file-pill-icon fp-da">DA</div>
        <div><div class="file-pill-text">DA_BST_MusicProfile_*</div><div class="file-pill-label">Fill stem sounds</div></div>
      </div>
    </div>

    <div class="callout tip">
      <div class="callout-title">ğŸ’¡ Why fixed layers by default</div>
      <p>Fixed layers give the best balance of low-friction setup, clean UX (simple nodes), reliable runtime behavior (consistent fades and quantization), and no audio-designer dependency for common cases. Custom layers are a supported extension path â€” but for 99% of games, Drums / Bass / Harmony / Melody / FX is everything you need. If you don't plan to add custom layers, you can safely ignore the advanced customization notes here.</p>
    </div>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 6 â•â•â• -->
<section class="section" id="s6">
  <h2><a class="anchor" href="#s6">#</a> 6. Gameplay API (BFL_BST)</h2>
  <p><span class="ci">BFL_BST</span> is the only thing your gameplay Blueprints need to call. It finds <span class="ci">BP_BST_Conductor</span> in the current world and forwards the request internally.</p>
  <div class="callout note" style="margin-top:14px">
    <div class="callout-title">â±ï¸ QuantizeToNextBar (per-call)</div>
    <p>When a node includes <span class="ci">QuantizeToNextBar</span>:
      <strong>true</strong> queues the change and applies it on the next bar;
      <strong>false</strong> applies immediately using fades.
      Use quantized calls for tight musical timing; use immediate calls for reactive gameplay.</p>
  </div>
  <div class="tw">
    <table>
      <thead><tr><th>Node</th><th>Description</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">BST_GetConductor</span></td><td>Finds the placed <span class="ci">BP_BST_Conductor</span> in the current world. Returns <span class="ci">Found=false</span> if missing.</td></tr>
        <tr><td><span class="ci">BST_StartMusic</span></td><td>Starts music playback. Use this when <span class="ci">bStartOnBeginPlay</span> is disabled â€” the demo-friendly "start silent" mode.</td></tr>
        <tr><td><span class="ci">BST_StopMusic</span></td><td>Fades out and stops all music, stops the beat clock, resets runtime state. Safe to call anytime.</td></tr>
        <tr><td><span class="ci">BST_SetMusicState</span></td><td>Requests a music state change. Obeys zone override rules unless you use the force variant.</td></tr>
        <tr><td><span class="ci">BST_AddLayer</span></td><td>Adds a single event layer (fade in). Enable <span class="ci">QuantizeToNextBar</span> to apply on the next bar.</td></tr>
        <tr><td><span class="ci">BST_AddLayers</span></td><td>Adds multiple event layers in one call (array input). Use Make Array to supply 2/3/all layers.</td></tr>
        <tr><td><span class="ci">BST_RemoveLayer</span></td><td>Removes a single event layer (fade out). If the same layer is required by the active zone, it remains enabled.</td></tr>
        <tr><td><span class="ci">BST_ClearLayers</span></td><td>Clears all event layers. Zone layers remain active and unaffected.</td></tr>
        <tr><td><span class="ci">BST_LockCurrentTrack</span></td><td>Locks the currently playing track â€” prevents auto-advance, restarts the same track on finish.</td></tr>
        <tr><td><span class="ci">BST_UnlockCurrentTrack</span></td><td>Releases the lock so the playlist can auto-advance again.</td></tr>
      </tbody>
    </table>
  </div>
  <div class="callout warning">
    <div class="callout-title">âš ï¸ Important Behavior Notes</div>
    <p><strong style="color:var(--text-primary)">No manual references needed</strong> â€” <span class="ci">WorldContextObject</span> is sufficient. If no Conductor exists in the level, all nodes do nothing (<span class="ci">Found=false</span>). Layer nodes operate on Event Layers (<span class="ci">ActiveEventLayers</span>). Zone Layers are managed separately by zones and are <em>not</em> cleared by <span class="ci">BST_ClearLayers</span>.</p>
  </div>

  <div class="callout warning">
    <div class="callout-title">âš ï¸ WorldContextObject â€” Connect to Self</div>
    <p>Every <span class="ci">BFL_BST</span> node has a <span class="ci">WorldContextObject</span> input. This input <strong style="color:var(--text-primary)">must</strong> be connected â€” otherwise <span class="ci">BST_GetConductor</span> (which runs internally on every call) cannot locate the world and returns <span class="ci">Found=false</span>. The call silently does nothing.</p>
  </div>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Â· Correct Wiring</span></div>
    <pre><span class="cmt">â† Inside any Blueprint (Actor, Widget, GameMode, etc.)</span>

<span class="fn">BST_SetMusicState</span>(
    WorldContextObject: <span class="val">self</span>         <span class="cmt">â† drag "self" node here</span>
    NewState:           <span class="val">Combat</span>
)

<span class="cmt">â† "self" gives the node a valid World reference.</span>
<span class="cmt">   BST_GetConductor uses it to find BP_BST_Conductor in that world.</span></pre>
  </div>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Â· Common Mistake</span></div>
    <pre><span class="fn">BST_SetMusicState</span>(
    WorldContextObject: <span class="cmt">â† left empty / not connected</span>
    NewState:           <span class="val">Combat</span>
)

<span class="cmt">â† WorldContextObject is null.</span>
<span class="cmt">   BST_GetConductor returns Found=false.</span>
<span class="cmt">   Nothing happens. No error, no crash â€” silent fail.</span></pre>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 7 â•â•â• -->
<section class="section" id="s7">
  <h2><a class="anchor" href="#s7">#</a> 7. Conductor Settings & Variables</h2>
  <p>These are the main user-facing variables shown in the Conductor's Details panel.</p>
  <div class="tw">
    <table>
      <thead><tr><th>Variable</th><th>Meaning</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">ActiveProfile</span></td><td>Profile asset used to resolve StateConfigs. Zones may temporarily override this via OverrideProfile.</td></tr>
        <tr><td><span class="ci">AutoStartState</span></td><td>State to begin automatically when the level starts.</td></tr>
        <tr><td><span class="ci">StateChangeFadeDuration</span></td><td>Crossfade duration when switching states or tracks.</td></tr>
        <tr><td><span class="ci">bQuantizeStateChangesToBar</span></td><td>If true, state change requests are held and applied on the next bar.</td></tr>
        <tr><td><span class="ci">bStartOnBeginPlay</span></td><td>If true, music starts automatically on BeginPlay. If false, the level starts silent until <span class="ci">BST_StartMusic</span> is called.</td></tr>
        <tr><td><span class="ci">BaseVolume</span></td><td>Master volume multiplier for the base mix.</td></tr>
        <tr><td><span class="ci">bAutoAdvancePlaylist</span></td><td>If true, the Conductor advances to the next track in the playlist when the active base finishes.</td></tr>
        <tr><td><span class="ci">bLoopIfSingleTrack</span></td><td>If true and the playlist has only 1 track, restart it when it finishes.</td></tr>
        <tr><td><span class="ci">bAllowGameplayOverrideWhileInZone</span></td><td>If true, a force request node can switch state even while a zone override is active.</td></tr>
        <tr><td><span class="ci">bQuantizeZoneLayerChangesToBar</span></td><td>If true, zone layer set updates are queued and applied on the next bar.</td></tr>
        <tr><td><span class="ci">bDebugPrint / bDebugZones / bDebugProfiles</span></td><td>Prints debug info to the console for troubleshooting.</td></tr>
      </tbody>
    </table>
  </div>
  <h3>Runtime Variables (FYI)</h3>
  <p>At runtime the Conductor maintains <span class="ci">CurrentState</span>, <span class="ci">CurrentTrack</span>, beat clock values (BPM / BeatsPerBar / CurrentBeat), pending requests (PendingState, pending layer ops, pending zone layers), zone tracking (ActiveZones, TopZone, ActiveZoneLayers), and track lock flags (<span class="ci">bEventTrackLock</span>, <span class="ci">bZoneTrackLock</span>, <span class="ci">bTrackLockActive</span>).</p>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 8 â•â•â• -->
<section class="section" id="s8">
  <h2><a class="anchor" href="#s8">#</a> 8. Zone System</h2>
  <p>Zones are overlap-based. When the player enters or exits zones, the Conductor maintains an <span class="ci">ActiveZones</span> array and selects the TopZone by highest <span class="ci">ZonePriority</span>. Only the TopZone's settings are applied at any time.</p>

  <h3>8.1 Zone Properties</h3>
  <div class="tw">
    <table>
      <thead><tr><th>Property</th><th>Meaning</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">ZonePriority</span></td><td>Higher value wins when multiple zones overlap.</td></tr>
        <tr><td><span class="ci">ZoneState</span></td><td>If not NONE, overrides the global requested state while inside the TopZone.</td></tr>
        <tr><td><span class="ci">ExtraLayers</span></td><td>Array of <span class="ci">E_BST_MusicLayer</span> to add while inside the zone.</td></tr>
        <tr><td><span class="ci">OverrideProfile</span></td><td>Optional: use a different profile while this zone is TopZone (only active when ZoneState is not NONE).</td></tr>
        <tr><td><span class="ci">bZoneTrackLock</span></td><td>Request Track Lock while inside this zone. Lower priority than Event Track Lock.</td></tr>
        <tr><td><span class="ci">QuantizeZoneLayerChangesToBar</span></td><td>Toggle that drives the Conductor's zone-layer quantization behavior when this zone becomes TopZone.</td></tr>
        <tr><td><span class="ci">AffectsOnlyLocalPlayer</span></td><td>If enabled, the zone only reacts to the local player â€” useful for single-player testing.</td></tr>
      </tbody>
    </table>
  </div>

  <h3>8.2 Overlapping Zones & Priority</h3>
  <p>When inside multiple zones, the Conductor picks TopZone by the highest <span class="ci">ZonePriority</span>. If TopZone changes, the Conductor reapplies zone override (state / profile) and zone layers. Leaving a TopZone triggers reselection of the next best zone, or disables zone override entirely if none remain.</p>

  <h3>8.3 Zone + Gameplay State Interaction</h3>
  <p>Gameplay requests via <span class="ci">BST_SetMusicState</span> set <span class="ci">GlobalRequestedState</span>. If <span class="ci">ZoneOverrideActive</span> is true, the TopZone's <span class="ci">ZoneState</span> can override what actually plays. When you leave all zones, the Conductor returns to <span class="ci">GlobalRequestedState</span> automatically.</p>
  <div class="callout note">
    <div class="callout-title">ğŸ“Œ Force Override</div>
    <p><span class="ci">BST_RequestState_ForceWhileInZone</span> can force a state change while inside zones â€” but only if <span class="ci">bAllowGameplayOverrideWhileInZone</span> is enabled on the Conductor.</p>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 9 â•â•â• -->
<section class="section" id="s9">
  <h2><a class="anchor" href="#s9">#</a> 9. Arbitration Rules</h2>
  <p>When gameplay, zones, and events request different things at the same time, the Conductor follows deterministic priority rules.</p>

  <h3>9.1 State Resolution Priority</h3>
  <div class="tw">
    <table>
      <thead><tr><th>Source</th><th>Priority</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">TopZone.ZoneState</span> (if ZoneOverrideActive and not NONE)</td><td><span class="pri hi">Highest</span> â€” Overrides the effective playing state.</td></tr>
        <tr><td><span class="ci">GlobalRequestedState</span> (from gameplay)</td><td><span class="pri md">Fallback</span> â€” Used when no zone override is active or ZoneState is NONE.</td></tr>
      </tbody>
    </table>
  </div>

  <h3>9.2 Profile Resolution Priority</h3>
  <p><span class="ci">ProfileInUse</span> is resolved each time a zone override is applied. If <span class="ci">ZoneOverrideActive</span> and TopZone's <span class="ci">OverrideProfile</span> is valid and <span class="ci">ZoneState</span> is not NONE, then <span class="ci">ProfileInUse = OverrideProfile</span>. Otherwise, <span class="ci">ProfileInUse = ActiveProfile</span>.</p>

  <h3>9.3 Layer Resolution (OR Combination)</h3>
  <p>A layer is active if <em>any</em> source requests it:</p>
  <div class="tw">
    <table>
      <thead><tr><th>Layer Source</th><th>Description</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">ActiveZoneLayers</span></td><td>Layers from the current TopZone's ExtraLayers (or pending zone layer set if quantized).</td></tr>
        <tr><td><span class="ci">ActiveEventLayers</span></td><td>Layers added by gameplay through BFL_BST nodes (or pending ops if quantized).</td></tr>
      </tbody>
    </table>
  </div>
  <div class="callout warning">
    <div class="callout-title">âš ï¸ OR Combination</div>
    <p>Because layers use OR logic, removing a layer from Event Layers will <strong style="color:var(--text-primary)">not</strong> turn it off if the active zone still requests that same layer.</p>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 10 â•â•â• -->
<section class="section" id="s10">
  <h2><a class="anchor" href="#s10">#</a> 10. Quantization (Next-Bar Changes)</h2>
  <p>Quantization applies changes exactly on the next bar boundary â€” keeping transitions musically clean.</p>

  <h3>10.1 State Quantization</h3>
  <p>When <span class="ci">bQuantizeStateChangesToBar</span> is ON, <span class="ci">BST_RequestState</span> stores <span class="ci">PendingState</span> and sets <span class="ci">bHasPendingState=true</span>. On <span class="ci">BST_OnBar</span>, the pending state is applied via <span class="ci">BST_SwitchStateNow</span> and the flag is cleared.</p>

  <h3>10.2 Event Layer Ops Quantization</h3>
  <p>Queued layer ops are applied on each bar in a deterministic order:</p>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Pending Layer Ops Â· Execution Order</span></div>
    <pre><span class="val">1)</span> <span class="fn">Clear</span>          <span class="cmt">â† optional PendingClearEventLayers</span>
<span class="val">2)</span> <span class="fn">Remove</span>        <span class="cmt">â† PendingRemoveLayers[]</span>
<span class="val">3)</span> <span class="fn">Add</span>           <span class="cmt">â† PendingAddLayers[] (only if track has that stem)</span>
<span class="val">4)</span> <span class="fn">ApplyNow</span>     <span class="cmt">â† BST_ApplyEventLayersNow()</span></pre>
  </div>

  <h3>10.3 Zone Layer Set Quantization</h3>
  <p>When zone layer changes are quantized, the Conductor stores <span class="ci">PendingZoneLayers</span> and sets <span class="ci">bHasPendingZoneLayerSet=true</span>. On bar, <span class="ci">BST_ApplyPendingZoneLayers_OnBar</span> copies pending layers into <span class="ci">ActiveZoneLayers</span>, clears the flag, and calls <span class="ci">BST_ApplyEventLayersNow</span>.</p>

  <div class="callout tip">
    <div class="callout-title">ğŸ’¡ Quantization Summary</div>
    <p>BeatSyncToolkit supports quantization for three categories: state changes (<span class="ci">bQuantizeStateChangesToBar</span>), event layer operations (per-call <span class="ci">QuantizeToNextBar</span>), and zone layer set updates (<span class="ci">bQuantizeZoneLayerChangesToBar</span>).</p>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 11 â•â•â• -->
<section class="section" id="s11">
  <h2><a class="anchor" href="#s11">#</a> 11. Playlist, Auto-Advance & Track Lock</h2>

  <h3>11.1 Base Playback & Crossfade</h3>
  <p>The Conductor uses two base AudioComponents (Base A and Base B). When switching tracks or states, it crossfades from the active base to the other via <span class="ci">BST_CrossfadeBaseTo</span>. <span class="ci">bUsingBaseA</span> tracks which base is active â€” <span class="ci">OnAudioFinished</span> events from the inactive base are ignored.</p>

  <h3>11.2 Auto-Advance (Play Next Track)</h3>
  <p>If <span class="ci">bAutoAdvancePlaylist</span> is ON, when the active base finishes, <span class="ci">BST_PlayNextTrack_SameState</span> fires. The next track is chosen from the current state's playlist, avoiding immediate repeats when possible. After selection: beat clock restarts, base crossfades, layer components are ensured playing muted, and active layers are re-applied.</p>

  <h3>11.3 Track Lock</h3>
  <p>Track Lock prevents auto-advance for the current track. When locked and the active base finishes, the Conductor restarts <span class="ci">CurrentTrack</span> instead of advancing. Event-based lock (from <span class="ci">BFL_BST</span>) takes priority over zone-based lock (from TopZone).</p>
  <div class="callout note">
    <div class="callout-title">ğŸ“Œ Track Lock Scope</div>
    <p>Track Lock locks the <em>currently playing</em> track at the moment the lock is engaged â€” not a specific track by name. It locks whatever is playing right now.</p>
  </div>

  <h3>11.4 Advance Lock (Anti Double-Advance)</h3>
  <p>The Conductor briefly sets an internal Advance Lock during transitions to prevent double-advance (e.g. if both base finished events fire near a switch). This lock auto-clears after <span class="ci">AdvanceLockSeconds</span>.</p>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 12 â•â•â• -->
<section class="section" id="s12">
  <h2><a class="anchor" href="#s12">#</a> 12. Practical Examples</h2>

  <h3>Example A â€” Exploration / Combat with Quantized Transitions</h3>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
    <pre><span class="cmt">// Enable quantization on the Conductor</span>
<span class="cls">Conductor</span>.<span class="val">bQuantizeStateChangesToBar</span> = <span class="kw">true</span>

<span class="cmt">// Normal gameplay:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Explore</span>)

<span class="cmt">// Combat starts â€” change applies cleanly on next bar:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Combat</span>)

<span class="cmt">// Combat ends:</span>
<span class="fn">BST_SetMusicState</span>(<span class="val">Explore</span>)</pre>
  </div>

  <h3>Example B â€” Layered Tension (Event Layers)</h3>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
    <pre><span class="cmt">// Ensure your Combat tracks include a Drums stem</span>
<span class="fn">BST_AddLayer</span>(<span class="val">Drums</span>)       <span class="cmt">â† fade in drums</span>
<span class="fn">BST_RemoveLayer</span>(<span class="val">Drums</span>)    <span class="cmt">â† fade out drums</span>
<span class="cmt">// No Drums stem on current track â†’ safely ignored</span></pre>
  </div>

  <h3>Example C â€” Zone Overrides + Extra Layers</h3>
  <p>Place a <span class="ci">BP_BST_MusicZone</span> for a "Danger Area". Set <span class="ci">ZonePriority</span> high, <span class="ci">ZoneState = Danger</span>, and <span class="ci">ExtraLayers = [FX]</span>.</p>
  <p>Walk into the zone: state is overridden and FX layer enables. Walk out: music returns to <span class="ci">GlobalRequestedState</span> and FX turns off â€” unless it's still requested by event layers.</p>

  <h3>Example D â€” Overlapping Zones (TopZone Selection)</h3>
  <p>Place Zone A (Priority 10) and Zone B (Priority 20) overlapping. Inside both: Zone B is TopZone. Leave Zone B while still in Zone A: the Conductor automatically switches back to Zone A's behavior.</p>

  <h3>Example E â€” Track Lock during a Boss Fight</h3>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Blueprint Pseudocode</span></div>
    <pre><span class="cmt">// Boss fight begins:</span>
<span class="fn">BST_LockCurrentTrack</span>()      <span class="cmt">â† track restarts on finish</span>

<span class="cmt">// Boss fight ends:</span>
<span class="fn">BST_UnlockCurrentTrack</span>()    <span class="cmt">â† auto-advance resumes</span></pre>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 13 â•â•â• -->
<section class="section" id="s13">
  <h2><a class="anchor" href="#s13">#</a> 13. Debugging & Troubleshooting</h2>

  <h3>Common Setup Issues</h3>
  <div class="tw">
    <table>
      <thead><tr><th>Symptom</th><th>Likely Cause</th></tr></thead>
      <tbody>
        <tr><td>Nothing plays</td><td>Forgot to place <span class="ci">BP_BST_Conductor</span>, or <span class="ci">ActiveProfile</span> / <span class="ci">AutoStartState</span> is not set.</td></tr>
        <tr><td>Layers do nothing</td><td>Current track has no stem for that layer â€” LayerDef sound is empty.</td></tr>
        <tr><td>Zone changes don't apply</td><td>Player isn't overlapping the zone's collision, or TopZone selection isn't what you expect.</td></tr>
        <tr><td>State changes seem delayed</td><td><span class="ci">bQuantizeStateChangesToBar</span> is on â€” changes apply on the next bar.</td></tr>
        <tr><td>Layer changes seem delayed</td><td>You enabled <span class="ci">QuantizeToNextBar</span> on your layer call.</td></tr>
      </tbody>
    </table>
  </div>

  <h3>Debug Flags</h3>
  <p>Enable these on <span class="ci">BP_BST_Conductor</span> to get console output:</p>
  <div class="code-block">
    <div class="cb-head"><span class="cd r"></span><span class="cd y"></span><span class="cd g"></span><span class="cb-label">Debug Flags</span></div>
    <pre><span class="val">bDebugPrint</span>          <span class="cmt">â† state switches, track picks, bar events</span>
<span class="val">bDebugZones</span>         <span class="cmt">â† zone enter/exit, TopZone changes, overrides applied</span>
<span class="val">bDebugProfiles</span>      <span class="cmt">â† profile resolution, state config lookups</span></pre>
  </div>

  <h3>Sanity Checklist</h3>
  <ul class="cl">
    <li><div class="chk"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Exactly one Conductor exists in the level.</li>
    <li><div class="chk"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> ActiveProfile contains an entry for the target state.</li>
    <li><div class="chk"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Each TrackEntry has BaseSound set and correct BPM / BPB.</li>
    <li><div class="chk"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Your desired layer's LayerDef sound is valid for that track.</li>
    <li><div class="chk"><svg viewBox="0 0 12 12"><polyline points="2,6 5,9 10,3"></polyline></svg></div> Zones have collision enabled and overlap events firing.</li>
  </ul>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 14 â•â•â• -->
<section class="section" id="s14">
  <h2><a class="anchor" href="#s14">#</a> 14. Not Included in Current Build</h2>
  <div class="callout warning">
    <div class="callout-title">âš ï¸ Clarity Note</div>
    <p>Some items below are planned â€” see Section 16 (Roadmap) for details. They are listed here explicitly to avoid confusion about current capabilities.</p>
  </div>
  <ul class="fl" style="margin-top:14px">
    <li><strong style="color:var(--text-primary)">Intensity system</strong> â€” continuous 0..1 mixing or threshold-based layer logic.</li>
    <li><strong style="color:var(--text-primary)">Manual looping</strong> â€” looping an arbitrary chosen track via event/zone, beyond the single-track playlist loop option (<span class="ci">bLoopIfSingleTrack</span>).</li>
    <li><strong style="color:var(--text-primary)">State pause/resume</strong> â€” returning to a previous state at the exact playback position.</li>
    <li><strong style="color:var(--text-primary)">Multi-base processing</strong> â€” additional base processing beyond the current A/B crossfade.</li>
  </ul>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 15 â•â•â• -->
<section class="section" id="s15">
  <h2><a class="anchor" href="#s15">#</a> 15. Advanced Reference: Conductor Function Map</h2>
  <p>For power users who want to understand internal responsibilities. Most games only need the BFL nodes and profile / zone setup.</p>
  <div class="tw">
    <table>
      <thead><tr><th>Category</th><th>Functions</th></tr></thead>
      <tbody>
        <tr><td><span class="ci">Profile</span></td><td><span class="ci">BST_GetStateConfig</span>, <span class="ci">BST_GetStateConfig_FromProfile</span>, <span class="ci">BST_PickTrackForState</span></td></tr>
        <tr><td><span class="ci">Clock</span></td><td><span class="ci">BST_StartBeatClock</span>, <span class="ci">BST_OnBeatTick</span>, <span class="ci">BST_OnBar</span></td></tr>
        <tr><td><span class="ci">Runtime</span></td><td><span class="ci">BST_SwitchStateNow</span>, <span class="ci">BST_CrossfadeBaseTo</span></td></tr>
        <tr><td><span class="ci">Public</span></td><td><span class="ci">BST_RequestState</span>, <span class="ci">BST_RequestState_ForceWhileInZone</span></td></tr>
        <tr><td><span class="ci">State (Internal)</span></td><td><span class="ci">BST_RequestState_Internal</span></td></tr>
        <tr><td><span class="ci">Layers</span></td><td><span class="ci">BST_EnsureLayerComponentsPlayingMuted</span>, <span class="ci">BST_ApplyEventLayersNow</span>, <span class="ci">BST_CurrentTrackHasLayerSound</span>, <span class="ci">BST_AddEventLayer</span></td></tr>
        <tr><td><span class="ci">Layers (Quantize)</span></td><td><span class="ci">BST_QueueAddLayer</span>, <span class="ci">BST_QueueRemoveLayer</span>, <span class="ci">BST_QueueClearLayers</span>, <span class="ci">BST_ApplyPendingLayerOps_OnBar</span></td></tr>
        <tr><td><span class="ci">Playlist</span></td><td><span class="ci">BST_PlayNextTrack_SameState</span>, <span class="ci">BST_SetAdvanceLock</span>, <span class="ci">BST_ClearAdvanceLock</span></td></tr>
        <tr><td><span class="ci">Zones</span></td><td><span class="ci">BST_NotifyZoneEntered</span>, <span class="ci">BST_NotifyZoneExited</span>, <span class="ci">BST_RecomputeTopZone</span>, <span class="ci">BST_ResolveProfileInUse</span>, <span class="ci">BST_ApplyZoneOverrideNow</span></td></tr>
        <tr><td><span class="ci">Zones (Queued)</span></td><td><span class="ci">BST_RequestRecomputeTopZone</span>, <span class="ci">BST_RecomputeTopZone_Queued</span>, <span class="ci">BST_ApplyPendingZoneLayers_OnBar</span></td></tr>
        <tr><td><span class="ci">Track Lock</span></td><td><span class="ci">BST_UpdateTrackLockActive</span>, <span class="ci">BST_RestartCurrentTrackLocked</span></td></tr>
      </tbody>
    </table>
  </div>
</section>

<div class="section-divider"></div>

<!-- â•â•â• 16 â•â•â• -->
<section class="section" id="s16">
  <h2><a class="anchor" href="#s16">#</a> 16. Roadmap</h2>
  <p>BeatSyncToolkit is designed to be expandable. Upcoming systems are toggles â€” they will not break the current workflow.</p>

  <div class="rcard">
    <div class="rcard-head">
      <h4>ğŸšï¸ Intensity System</h4>
      <span class="rbadge up">v1.x â€” Upcoming</span>
    </div>
    <p>A simple 0..1 Intensity input that maps to layer combinations and/or per-layer target volumes. Optional bar-quantization. Designed for stem-based tracks â€” won't arm missing layers. Will respect the same arbitration philosophy as Zones + Events: no surprises.</p>
  </div>

  <div class="rcard">
    <div class="rcard-head">
      <h4>ğŸµ Track Selection by Index</h4>
      <span class="rbadge up">v1.x â€” Upcoming</span>
    </div>
    <p>Optionally start a specific track inside a State playlist by index. Planned for both Event-based requests and Zone overrides (and also StartMusic), while keeping the current workflow unchanged when no index is provided.</p>
  </div>

  <div class="rcard">
    <div class="rcard-head">
      <h4>ğŸ”Š Playback & Base Processing</h4>
      <span class="rbadge lt">v1.x+ â€” Later</span>
    </div>
    <p>Multi-base support beyond the current A/B crossfade. Optional base processing without stems (filtering / ducking / volume shaping on a single WAV). Optional "pause & resume per state" â€” switch away, then return continuing from the same position. Optional "pin / loop a specific track" inside a state playlist.</p>
  </div>

  <div class="rcard">
    <div class="rcard-head">
      <h4>ğŸ“š Polish & Examples</h4>
      <span class="rbadge ct">Continuous</span>
    </div>
    <p>More sample maps, presets, and troubleshooting docs for faster onboarding.</p>
  </div>
</section>

<!-- â”€â”€â”€ FOOTER â”€â”€â”€ -->
<div class="footer">
  <p>BeatSyncToolkit v1.1 Â· Blueprint-First Adaptive Music for Unreal Engine 5.5.x Â· End of Documentation</p>
</div>

</main><!-- end .main -->

<!-- Back to Top -->
<a href="#top" class="b2t" id="b2t">
  <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="2.2"><path d="M3 11l5-5 5 5"/></svg>
</a>

<!-- â•â•â•â•â•â•â•â•â•â•â• SCRIPTS â•â•â•â•â•â•â•â•â•â•â• -->
<script>
(function(){
  const navItems = document.querySelectorAll('.nav-item[data-id]');
  const b2t = document.getElementById('b2t');
  const progBar = document.getElementById('progressBar');
  const docEl = document.documentElement;

  // Build ordered section list (topâ†’bottom by DOM position)
  const sectionIds = Array.from(navItems).map(n => n.dataset.id);
  const sectionEls = sectionIds.map(id => document.getElementById(id)).filter(Boolean);

  function getScrollPct(){
    const h = docEl.scrollHeight - docEl.clientHeight;
    return h > 0 ? (window.scrollY / h) * 100 : 0;
  }

  // Sort sectionEls by actual document position (topâ†’bottom) â€” defensive
  sectionEls.sort(function(a, b){ return a.compareDocumentPosition(b) & 4 ? -1 : 1; });

  window.addEventListener('scroll', function(){
    // Progress bar
    progBar.style.width = getScrollPct() + '%';

    // Back to top
    b2t.classList.toggle('vis', window.scrollY > 500);

    // Active nav â€” use getBoundingClientRect for reliable viewport-relative position
    var current = null;
    for(var i = 0; i < sectionEls.length; i++){
      if(sectionEls[i].getBoundingClientRect().top <= 72){
        current = sectionEls[i].id;
      }
    }

    navItems.forEach(function(item){
      item.classList.toggle('active', item.dataset.id === current);
    });
  }, {passive:true});

  // Smooth scroll for nav clicks â€” manual offset so heading stays visible
  document.querySelectorAll('a[href^="#"]').forEach(function(a){
    a.addEventListener('click', function(e){
      var target = document.querySelector(this.getAttribute('href'));
      if(target){
        e.preventDefault();
        var y = target.getBoundingClientRect().top + window.scrollY - 56;
        window.scrollTo({top: y, behavior:'smooth'});
      }
    });
  });

  // â”€â”€ Scroll Reveal (Intersection Observer) â”€â”€
  // Only top-level .section elements get reveal â€” children inherit visibility from parent.
  const revealEls = document.querySelectorAll('.section');
  revealEls.forEach(el => el.classList.add('reveal'));

  const revealObserver = new IntersectionObserver(function(entries){
    entries.forEach(entry => {
      if(entry.isIntersecting){
        entry.target.classList.add('visible');

        // Stagger .file-pill cards inside this section (if any)
        const pills = entry.target.querySelectorAll('.file-pill');
        if(pills.length){
          pills.forEach((pill, i) => {
            pill.style.opacity = '0';
            pill.style.transform = 'translateY(14px)';
            pill.style.transition = `opacity 0.4s cubic-bezier(.22,.68,0,1.2) ${i*0.07 + 0.3}s, transform 0.4s cubic-bezier(.22,.68,0,1.2) ${i*0.07 + 0.3}s`;
            requestAnimationFrame(() => {
              requestAnimationFrame(() => {
                pill.style.opacity = '1';
                pill.style.transform = 'translateY(0)';
              });
            });
          });
        }

        revealObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.08, rootMargin: '0px 0px -30px 0px' });

  revealEls.forEach(el => revealObserver.observe(el));
})();
</script>
</body>
</html>
